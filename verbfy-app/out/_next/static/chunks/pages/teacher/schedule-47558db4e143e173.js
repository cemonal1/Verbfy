(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3390],{39833:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/teacher/schedule",function(){return a(45503)}])},45503:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var l=a(85893),i=a(67294),d=a(11088),n=a(32798),s=a(36197),r=a(54310);function c(){let{user:e}=(0,s.aC)(),{t}=(0,r.Q)(),[a,c]=(0,i.useState)([]),[u,o]=(0,i.useState)(!0),[m,x]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),[g,b]=(0,i.useState)(60),[v,y]=(0,i.useState)(null),N=async()=>{if(null==e?void 0:e._id)try{var t,a,l;let i=await n.CM.getAvailability(e._id);c(null!==(l=null!==(a=null===(t=i.data)||void 0===t?void 0:t.data)&&void 0!==a?a:i.data)&&void 0!==l?l:[])}finally{o(!1)}};(0,i.useEffect)(()=>{N()},[null==e?void 0:e._id]);let j=async e=>{if(e.preventDefault(),!m||!h)return;let t=new Date("".concat(m,"T").concat(h,":00"));try{await n.CM.setAvailability({start:t,duration:g}),x(""),p(""),await N()}catch(e){}},f=async e=>{if(e)try{await n.CM.deleteAvailability(e),c(t=>t.filter(t=>(t._id||t.id)!==e))}catch(e){}},w=e=>({date:e.toISOString().slice(0,10),time:e.toTimeString().slice(0,5)}),_=(e,t)=>new Date("".concat(e,"T").concat(t,":00")),C=e=>{let t=w(new Date(e.start||e.date||e));y({id:e._id||e.id,date:t.date,time:t.time,duration:e.duration||60})},S=async e=>{if(e.preventDefault(),v)try{await n.CM.updateAvailability(v.id,{start:_(v.date,v.time),duration:v.duration}),y(null),await N()}catch(e){}};return(0,l.jsx)(d.Z,{allowedRoles:["teacher"],title:t("tschedule.title","My Schedule"),children:(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"lg:col-span-1 rounded-lg border p-4 bg-white",children:[(0,l.jsx)("div",{className:"text-lg font-semibold mb-3",children:t("tschedule.add","Add available slot")}),(0,l.jsxs)("form",{onSubmit:j,className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:t("tschedule.date","Date")}),(0,l.jsx)("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:"w-full border rounded-md px-3 py-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:t("tschedule.time","Time")}),(0,l.jsx)("input",{type:"time",value:h,onChange:e=>p(e.target.value),className:"w-full border rounded-md px-3 py-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:t("tschedule.duration","Duration (min)")}),(0,l.jsx)("input",{type:"number",min:15,step:15,value:g,onChange:e=>b(parseInt(e.target.value||"60")),className:"w-full border rounded-md px-3 py-2"})]}),(0,l.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:t("tschedule.addBtn","Add Slot")})]})]}),(0,l.jsxs)("div",{className:"lg:col-span-2 rounded-lg border p-4 bg-white",children:[(0,l.jsx)("div",{className:"text-lg font-semibold mb-3",children:t("tschedule.list","Upcoming availability")}),u?(0,l.jsx)("div",{className:"p-6 text-center text-gray-500",children:t("common.loading","Loading...")}):0===a.length?(0,l.jsx)("div",{className:"p-6 text-center text-gray-500",children:t("tschedule.empty","No availability yet")}):(0,l.jsx)("ul",{className:"divide-y divide-gray-200",children:a.map((e,a)=>{var i,d,n;let s=new Date(e.start||e.date||e),r="".concat(s.toLocaleDateString()," ").concat(s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),c=!!v&&v.id===(e._id||e.id);return(0,l.jsxs)("li",{className:"py-3 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-gray-800",children:c?(0,l.jsxs)("form",{onSubmit:S,className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"date",value:null!==(i=null==v?void 0:v.date)&&void 0!==i?i:"",onChange:e=>y(t=>t?{...t,date:e.target.value}:t),className:"border rounded px-2 py-1 text-sm",required:!0}),(0,l.jsx)("input",{type:"time",value:null!==(d=null==v?void 0:v.time)&&void 0!==d?d:"",onChange:e=>y(t=>t?{...t,time:e.target.value}:t),className:"border rounded px-2 py-1 text-sm",required:!0}),(0,l.jsx)("input",{type:"number",min:15,step:15,value:null!==(n=null==v?void 0:v.duration)&&void 0!==n?n:60,onChange:e=>y(t=>t?{...t,duration:parseInt(e.target.value||"60")}:t),className:"w-24 border rounded px-2 py-1 text-sm"}),(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 rounded-md text-xs bg-blue-600 text-white hover:bg-blue-700",children:t("common.save","Save")}),(0,l.jsx)("button",{type:"button",onClick:()=>y(null),className:"px-3 py-1 rounded-md text-xs bg-gray-200 text-gray-800 hover:bg-gray-300",children:t("common.cancel","Cancel")})]}):r}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>C(e),className:"px-3 py-1 rounded-md text-xs bg-gray-100 text-gray-800 hover:bg-gray-200",children:t("common.edit","Edit")}),(0,l.jsx)("button",{onClick:()=>f(e._id||e.id),className:"px-3 py-1 rounded-md text-xs bg-red-600 text-white hover:bg-red-700",children:t("common.delete","Delete")})]})]},e._id||a)})})]})]})})}}},function(e){e.O(0,[2138,9226,9496,8484,437,1883,7,747,3365,8638,9806,7093,8510,8424,8639,7855,7446,2169,8308,1408,6259,4657,8212,1088,5522,1493,2888,5514,179],function(){return e(e.s=39833)}),_N_E=e.O()}]);