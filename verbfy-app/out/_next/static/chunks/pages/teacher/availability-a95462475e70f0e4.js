(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1954],{55963:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/teacher/availability",function(){return a(29005)}])},29005:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(85893),r=a(67294),l=a(9008),o=a.n(l),n=a(11088),i=a(36197),d=a(32798),c=a(6642);let m=[{name:"Sunday",value:0,short:"Sun"},{name:"Monday",value:1,short:"Mon"},{name:"Tuesday",value:2,short:"Tue"},{name:"Wednesday",value:3,short:"Wed"},{name:"Thursday",value:4,short:"Thu"},{name:"Friday",value:5,short:"Fri"},{name:"Saturday",value:6,short:"Sat"}],u=(()=>{let e=[];for(let t=0;t<24;t++)e.push("".concat(t.toString().padStart(2,"0"),":00")),e.push("".concat(t.toString().padStart(2,"0"),":30"));return e})();var x=()=>{let{user:e}=(0,i.Eu)(),[t,a]=(0,r.useState)(new Set),[l,o]=(0,r.useState)([]),[n,x]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!1),[g,y]=(0,r.useState)(new Date),[f,v]=(0,r.useState)({timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,offset:new Date().getTimezoneOffset(),currentTime:new Date().toLocaleTimeString()});(0,r.useEffect)(()=>{let e=setInterval(()=>{let e=new Date;y(e),v(t=>({...t,currentTime:e.toLocaleTimeString()}))},6e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{p()},[]);let p=async()=>{if(e){x(!0);try{let e=(await d.ZP.get("/api/availability/my-availability")).data;o(e);let t=new Set;e.forEach(e=>{t.add("".concat(e.dayOfWeek,"-").concat(e.startTime))}),a(t)}catch(e){console.error("Error loading availability:",e),(0,c._N)("Failed to load availability")}finally{x(!1)}}},j=(0,r.useCallback)((e,t)=>{let s="".concat(e,"-").concat(t);a(e=>{let t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},[]),N=async()=>{if(e){b(!0);try{let e=[];t.forEach(t=>{let[a,s]=t.split("-"),r=u.indexOf(s),l=u[r+1]||"23:30",o={dayOfWeek:parseInt(a),startTime:s,endTime:l};if(isNaN(o.dayOfWeek)||o.dayOfWeek<0||o.dayOfWeek>6){console.error("Invalid dayOfWeek:",o.dayOfWeek,"from slotKey:",t);return}if(!o.startTime||!o.endTime){console.error("Invalid time format:",o,"from slotKey:",t);return}e.push(o)});let a={availabilitySlots:e,teacherTimezone:f.timezone};if(console.log("Saving availability:",{slotsCount:e.length,timezone:f.timezone}),E(e),0===e.length){(0,c._N)("No time slots selected. Please select at least one time slot.");return}await d.ZP.post("/api/availability/set",a),await p(),(0,c.x9)("Availability saved successfully!")}catch(t){var a,s,r,l;console.error("=== ERROR DEBUG ==="),console.error("Error object:",t),console.error("Error response:",t.response),console.error("Error response data:",null===(a=t.response)||void 0===a?void 0:a.data),console.error("Error response status:",null===(s=t.response)||void 0===s?void 0:s.status),console.error("=== END ERROR DEBUG ===");let e=(null===(l=t.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||"Failed to save availability";(0,c._N)(e)}finally{b(!1)}}},w=(e,a)=>t.has("".concat(e,"-").concat(a)),T=g.getDay(),k=g.toTimeString().slice(0,5),S=(e,t)=>e<T||e===T&&t<k,E=e=>{console.log("=== TESTING DATA STRUCTURE ==="),e.forEach((e,t)=>{console.log("Slot ".concat(t,":"),{dayOfWeek:e.dayOfWeek,startTime:e.startTime,endTime:e.endTime,dayOfWeekType:typeof e.dayOfWeek,startTimeType:typeof e.startTime,endTimeType:typeof e.endTime,dayOfWeekValid:"number"==typeof e.dayOfWeek&&!isNaN(e.dayOfWeek),startTimeValid:"string"==typeof e.startTime&&e.startTime.length>0,endTimeValid:"string"==typeof e.endTime&&e.endTime.length>0})}),console.log("=== END TESTING ===")};return n?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Manage Your Availability"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Select your available time slots for the week. Students will be able to book lessons during these times."})]}),(0,s.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:(0,s.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,s.jsxs)("div",{className:"font-medium",children:["Your Timezone: ",f.timezone]}),(0,s.jsxs)("div",{className:"text-xs mt-1",children:["Current Time: ",f.currentTime]}),(0,s.jsxs)("div",{className:"text-xs",children:["Today: ",g.toLocaleDateString()]})]})})]})}),(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden shadow-sm max-w-4xl mx-auto",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("div",{className:"min-w-[800px]",children:[(0,s.jsxs)("div",{className:"grid grid-cols-8 gap-0 bg-gray-50 border-b border-gray-200 sticky top-0 z-10",children:[(0,s.jsx)("div",{className:"p-3 font-semibold text-gray-700 text-sm bg-white border-r border-gray-200",children:"Time"}),m.map(e=>(0,s.jsxs)("div",{className:"p-3 font-semibold text-gray-700 text-sm text-center border-r border-gray-200 last:border-r-0",children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:e.short}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.name})]},e.value))]}),(0,s.jsx)("div",{className:"max-h-[500px] overflow-y-auto",children:u.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-8 gap-0 border-b border-gray-100 last:border-b-0 ".concat(t%2==0?"bg-white":"bg-gray-50"),children:[(0,s.jsx)("div",{className:"p-2 text-sm text-gray-600 font-medium bg-gray-50 border-r border-gray-200 flex items-center justify-center","data-time":e,children:e}),m.map(t=>{let a=S(t.value,e),r=w(t.value,e),l=t.value===T,o=l&&e===k;return(0,s.jsxs)("button",{"data-time":e,onClick:()=>!a&&j(t.value,e),disabled:a,className:"\n                          p-2 text-xs rounded-md transition-all duration-200 relative border-r border-gray-200 last:border-r-0 min-h-[40px] flex items-center justify-center\n                          ".concat(a?"bg-gray-100 text-gray-400 cursor-not-allowed opacity-50":r?"bg-blue-500 text-white shadow-sm hover:bg-blue-600 border border-blue-400":"bg-white text-gray-700 hover:bg-blue-50 border border-gray-200 hover:border-blue-300","\n                          ").concat(l?"ring-1 ring-blue-300":"","\n                          ").concat(o?"ring-2 ring-red-400":"","\n                        "),title:a?"This time has passed":"Select ".concat(t.name," at ").concat(e),children:[r&&(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-sm font-semibold",children:"✓"})}),o&&(0,s.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"})]},"".concat(t.value,"-").concat(e))})]},e))})]})})}),(0,s.jsx)("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Selected: ",(0,s.jsx)("span",{className:"font-semibold text-blue-600 text-base",children:t.size})," time slots"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-600 mt-0.5",children:["Each slot represents 30 minutes • 24-hour format • Timezone: ",f.timezone]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>a(new Set),className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors shadow-sm",children:"Clear All"}),(0,s.jsx)("button",{onClick:()=>{let e=document.querySelector('[data-time="'.concat(k,'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"center"})},className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors shadow-sm",children:"Current Time"}),(0,s.jsx)("button",{onClick:N,disabled:h,className:"\n                px-4 py-1.5 text-sm font-medium text-white rounded-md transition-colors shadow-sm\n                ".concat(h?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-md","\n              "),children:h?(0,s.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Saving..."]}):"Save Availability"})]})]})}),(0,s.jsxs)("div",{className:"mt-4 max-w-4xl mx-auto",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:"Quick Selection"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:[(0,s.jsx)("button",{onClick:()=>{let e=new Set;m.forEach(t=>{u.slice(12,24).forEach(a=>{e.add("".concat(t.value,"-").concat(a))})}),a(e)},className:"px-2.5 py-1 text-xs bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors border border-green-200",children:"Morning (6 AM - 12 PM)"}),(0,s.jsx)("button",{onClick:()=>{let e=new Set;m.forEach(t=>{u.slice(24,36).forEach(a=>{e.add("".concat(t.value,"-").concat(a))})}),a(e)},className:"px-2.5 py-1 text-xs bg-yellow-100 text-yellow-700 rounded-md hover:bg-yellow-200 transition-colors border border-yellow-200",children:"Afternoon (12 PM - 6 PM)"}),(0,s.jsx)("button",{onClick:()=>{let e=new Set;m.forEach(t=>{u.slice(36,44).forEach(a=>{e.add("".concat(t.value,"-").concat(a))})}),a(e)},className:"px-2.5 py-1 text-xs bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 transition-colors border border-purple-200",children:"Evening (6 PM - 10 PM)"}),(0,s.jsx)("button",{onClick:()=>{let e=new Set;m.slice(1,6).forEach(t=>{u.slice(12,44).forEach(a=>{e.add("".concat(t.value,"-").concat(a))})}),a(e)},className:"px-2.5 py-1 text-xs bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors border border-blue-200",children:"Weekdays (6 AM - 10 PM)"}),(0,s.jsx)("button",{onClick:()=>{let e=new Set;[m[0],m[6]].forEach(t=>{u.slice(12,44).forEach(a=>{e.add("".concat(t.value,"-").concat(a))})}),a(e)},className:"px-2.5 py-1 text-xs bg-orange-100 text-orange-700 rounded-md hover:bg-orange-200 transition-colors border border-orange-200",children:"Weekends (6 AM - 10 PM)"})]})]}),(0,s.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200 max-w-4xl mx-auto",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-blue-800 mb-1",children:"⏰ Timezone Information"}),(0,s.jsxs)("div",{className:"text-xs text-blue-700 space-y-0.5",children:[(0,s.jsxs)("p",{children:["• Your availability is saved in your local timezone: ",(0,s.jsx)("strong",{children:f.timezone})]}),(0,s.jsx)("p",{children:"• Students will see your availability converted to their local timezone"}),(0,s.jsx)("p",{children:"• Past time slots are automatically disabled and cannot be selected"}),(0,s.jsx)("p",{children:"• Current time is highlighted with a red dot indicator"})]})]})]})},h=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o(),{children:[(0,s.jsx)("title",{children:"Manage Availability - Verbfy"}),(0,s.jsx)("meta",{name:"description",content:"Manage your teaching availability and schedule"})]}),(0,s.jsx)(n.Z,{allowedRoles:["teacher"],children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Manage Availability"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Set your weekly teaching schedule and let students know when you're available for lessons."})]}),(0,s.jsxs)("div",{className:"hidden sm:flex items-center space-x-2 text-sm text-gray-500",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),(0,s.jsx)("span",{children:"Available"}),(0,s.jsx)("div",{className:"w-3 h-3 bg-gray-200 rounded-full ml-4"}),(0,s.jsx)("span",{children:"Unavailable"})]})]})}),(0,s.jsx)(x,{}),(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"How it works"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-blue-800",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Setting Your Schedule"}),(0,s.jsxs)("ul",{className:"space-y-1",children:[(0,s.jsx)("li",{children:"• Click on time slots to mark them as available"}),(0,s.jsx)("li",{children:"• Each slot represents 30 minutes"}),(0,s.jsx)("li",{children:"• Use quick selection buttons for common patterns"}),(0,s.jsx)("li",{children:"• Your schedule repeats weekly"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Student Booking"}),(0,s.jsxs)("ul",{className:"space-y-1",children:[(0,s.jsx)("li",{children:"• Students can only book during your available slots"}),(0,s.jsx)("li",{children:"• You'll receive notifications for new bookings"}),(0,s.jsx)("li",{children:"• You can modify your schedule anytime"}),(0,s.jsx)("li",{children:"• Changes apply to future weeks only"})]})]})]})]})]})})]})},6642:function(e,t,a){"use strict";a.d(t,{_N:function(){return r},x9:function(){return l}});var s=a(56158);let r=e=>{s.Am.error(e)},l=e=>{s.Am.success(e)}}},function(e){e.O(0,[1216,1088,2888,179],function(){return e(e.s=55963)}),_N_E=e.O()}]);
//# sourceMappingURL=availability-a95462475e70f0e4.js.map