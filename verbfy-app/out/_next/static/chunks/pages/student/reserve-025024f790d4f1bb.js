(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3950],{43651:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/student/reserve",function(){return t(87946)}])},87946:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var l=t(85893),a=t(67294),r=t(9008),n=t.n(r),i=t(11163),o=t(11088),d=t(32798),c=t(6642),m=t(36197);let u=[{name:"Sunday",value:0,short:"Sun"},{name:"Monday",value:1,short:"Mon"},{name:"Tuesday",value:2,short:"Tue"},{name:"Wednesday",value:3,short:"Wed"},{name:"Thursday",value:4,short:"Thu"},{name:"Friday",value:5,short:"Fri"},{name:"Saturday",value:6,short:"Sat"}],x=[{value:"VerbfySpeak",label:"VerbfySpeak",description:"Conversation & Speaking Practice"},{value:"VerbfyListen",label:"VerbfyListen",description:"Listening Comprehension"},{value:"VerbfyRead",label:"VerbfyRead",description:"Reading & Comprehension"},{value:"VerbfyWrite",label:"VerbfyWrite",description:"Writing & Composition"},{value:"VerbfyGrammar",label:"VerbfyGrammar",description:"Grammar & Structure"},{value:"VerbfyExam",label:"VerbfyExam",description:"Exam Preparation"}],h=[{value:"Beginner",label:"Beginner",description:"Basic English skills"},{value:"Intermediate",label:"Intermediate",description:"Intermediate English skills"},{value:"Advanced",label:"Advanced",description:"Advanced English skills"}];var g=e=>{var s,t,r;let{teacherId:n,teacherName:i,onBookingComplete:o}=e,{user:g}=(0,m.Eu)(),[b,v]=(0,a.useState)([]),[p,j]=(0,a.useState)(!0),[y,f]=(0,a.useState)(null),[N,k]=(0,a.useState)(""),[w,S]=(0,a.useState)(""),[T,_]=(0,a.useState)("VerbfySpeak"),[C,E]=(0,a.useState)("Intermediate"),[B,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=Intl.DateTimeFormat().resolvedOptions().timeZone;S(e),V(e)},[n]);let V=async e=>{j(!0);try{let s=await d.ZP.get("/api/availability/".concat(n,"/available"),{params:{studentTimezone:e}});v(s.data)}catch(e){console.error("Error loading teacher availability:",e),(0,c._N)("Failed to load teacher availability")}finally{j(!1)}},D=e=>{f(e),k(I(e.dayOfWeek,e.startTime).toISOString().split("T")[0])},I=(e,s)=>{let t=new Date,[l,a]=s.split(":").map(Number),r=(e-t.getDay()+7)%7;0===r&&(t.getHours()>l||t.getHours()===l&&t.getMinutes()>=a)&&(r=7);let n=new Date(t);return n.setDate(t.getDate()+r),n.setHours(l,a,0,0),n},A=async()=>{if(!y||!N){(0,c._N)("Please select a time slot and date");return}L(!0);try{console.log("Booking lesson:",{teacherId:n,slotId:y._id,actualDate:N,studentTimezone:w,lessonType:T,lessonLevel:C});let e=await d.ZP.post("/api/reservations/reserve",{teacherId:n,slotId:y._id,actualDate:N,studentTimezone:w,lessonType:T,lessonLevel:C});console.log("Booking successful:",e.data),(0,c.x9)("Lesson booked successfully!"),o&&o(e.data.reservation),f(null),k(""),_("VerbfySpeak"),E("Intermediate"),await V(w)}catch(n){var e,s,t,l,a,r,i,m,u,x,h;if(console.error("Error booking lesson:",n),(null===(e=n.response)||void 0===e?void 0:e.status)===409){let e=(null===(a=n.response)||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.message)||"This time slot is no longer available";(0,c._N)(e),await V(w)}else if((null===(s=n.response)||void 0===s?void 0:s.status)===400){let e=(null===(i=n.response)||void 0===i?void 0:null===(r=i.data)||void 0===r?void 0:r.message)||"Invalid booking request";(0,c._N)(e)}else if((null===(t=n.response)||void 0===t?void 0:t.status)===403){let e=(null===(u=n.response)||void 0===u?void 0:null===(m=u.data)||void 0===m?void 0:m.message)||"You are not authorized to book this lesson";(0,c._N)(e)}else{let e=(null===(h=n.response)||void 0===h?void 0:null===(x=h.data)||void 0===x?void 0:x.message)||"Failed to book lesson. Please try again.";(0,c._N)(e)}}finally{L(!1)}},P=e=>{let[s,t]=e.split(":"),l=parseInt(s);return"".concat(l%12||12,":").concat(t," ").concat(l>=12?"PM":"AM")},z=b.reduce((e,s)=>{let t=s.dayOfWeek;return e[t]||(e[t]=[]),e[t].push(s),e},{});return p?(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===b.length?(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)("div",{className:"text-gray-500 text-lg mb-2",children:"No available time slots"}),(0,l.jsxs)("p",{className:"text-gray-400 text-sm",children:[i," hasn't set their availability yet."]})]})}):(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Available Time Slots"}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,l.jsxs)("p",{className:"text-gray-600 text-sm",children:["All times are shown in your local timezone: ",(0,l.jsx)("strong",{children:w})]}),b.length>0&&(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:[b.length," available slot",1!==b.length?"s":""]})]})]}),b.some(e=>e.teacherTimezone!==w)&&(0,l.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,l.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,l.jsx)("div",{className:"font-medium mb-1",children:"⏰ Timezone Conversion"}),(0,l.jsxs)("div",{className:"text-xs",children:["Times have been converted from teacher's timezone (",null===(s=b[0])||void 0===s?void 0:s.teacherTimezone,") to your timezone (",w,")"]})]})}),(0,l.jsx)("div",{className:"space-y-4",children:u.map(e=>{let s=z[e.value]||[];return 0===s.length?null:(0,l.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,l.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.name})}),(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map(e=>(0,l.jsxs)("button",{onClick:()=>D(e),className:"\n                        p-3 text-left rounded-lg border transition-all duration-200\n                        ".concat((null==y?void 0:y._id)===e._id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50","\n                      "),children:[(0,l.jsxs)("div",{className:"font-medium",children:[P(e.startTime)," - ",P(e.endTime)]}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.originalStartTime&&e.originalEndTime&&(0,l.jsxs)("span",{children:["Teacher's time: ",P(e.originalStartTime)," - ",P(e.originalEndTime)]})})]},e._id))})})]},e.value)})}),y&&(0,l.jsx)("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium text-green-800",children:"Selected Time Slot"}),(0,l.jsxs)("div",{className:"text-sm text-green-700",children:[(t=y.dayOfWeek,(null===(r=u.find(e=>e.value===t))||void 0===r?void 0:r.name)||"Unknown")," at ",P(y.startTime)," - ",P(y.endTime)]}),(0,l.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:["Next occurrence: ",N?new Date(N).toLocaleDateString():"Calculating..."]})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lesson Type"}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:x.map(e=>(0,l.jsxs)("button",{onClick:()=>_(e.value),className:"\n                      p-3 text-left rounded-lg border transition-all duration-200\n                      ".concat(T===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50","\n                    "),children:[(0,l.jsx)("div",{className:"font-medium text-sm",children:e.label}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lesson Level"}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:h.map(e=>(0,l.jsxs)("button",{onClick:()=>E(e.value),className:"\n                      p-3 text-center rounded-lg border transition-all duration-200\n                      ".concat(C===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50","\n                    "),children:[(0,l.jsx)("div",{className:"font-medium text-sm",children:e.label}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.value))})]}),(0,l.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,l.jsx)("button",{onClick:()=>{f(null),k(""),_("VerbfySpeak"),E("Intermediate")},className:"px-3 py-1.5 text-sm text-green-600 hover:text-green-800 border border-green-300 rounded-md hover:bg-green-100 transition-colors",children:"Clear Selection"}),(0,l.jsx)("button",{onClick:A,disabled:B||!N,className:"\n                  px-4 py-1.5 text-sm font-medium text-white rounded-md transition-colors\n                  ".concat(B||!N?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700","\n                "),children:B?(0,l.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Booking..."]}):"Book Lesson"})]})]})}),(0,l.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"How to Book"}),(0,l.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,l.jsx)("p",{children:"• Click on any available time slot to select it"}),(0,l.jsx)("p",{children:"• The selected slot will be highlighted in blue"}),(0,l.jsx)("p",{children:'• Click "Book Lesson" to confirm your booking'}),(0,l.jsx)("p",{children:"• All times are shown in your local timezone"})]})]})]})},b=()=>{let{user:e}=(0,m.Eu)(),s=(0,i.useRouter)(),[t,r]=(0,a.useState)([]),[u,x]=(0,a.useState)(null),[h,b]=(0,a.useState)(!0),[v,p]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(e&&"student"!==e.role){s.replace("/dashboard");return}f()},[e,s]);let f=async()=>{b(!0);try{let e=await d.ZP.get("/users/teachers");r(e.data)}catch(e){console.error("Error loading teachers:",e),(0,c._N)("Failed to load teachers")}finally{b(!1)}},N=e=>{x(e),p(!1),y(null)};return h?(0,l.jsx)(o.Z,{allowedRoles:["student"],children:(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n(),{children:[(0,l.jsx)("title",{children:"Book a Lesson - Verbfy"}),(0,l.jsx)("meta",{name:"description",content:"Book a lesson with one of our expert teachers"})]}),(0,l.jsx)(o.Z,{allowedRoles:["student"],children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Book a Lesson"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Choose a teacher and select an available time slot to book your lesson."})]}),v&&j&&(0,l.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-green-600 text-lg",children:"✓"})})}),(0,l.jsxs)("div",{className:"ml-3 flex-1",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-green-800",children:"Booking Confirmed!"}),(0,l.jsxs)("div",{className:"mt-2 text-sm text-green-700",children:[(0,l.jsxs)("p",{children:["Your lesson with ",(0,l.jsx)("strong",{children:j.teacher.name})," has been booked successfully."]}),(0,l.jsxs)("p",{className:"mt-1",children:[(0,l.jsx)("strong",{children:"Date:"})," ",new Date(j.date).toLocaleDateString()," at ",j.startTime]})]}),(0,l.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>{s.push("/student/bookings")},className:"px-4 py-2 text-sm font-medium text-green-700 bg-green-100 border border-green-300 rounded-md hover:bg-green-200 transition-colors",children:"View My Bookings"}),(0,l.jsx)("button",{onClick:()=>{p(!1),y(null),x(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Book Another Lesson"})]})]})]})}),!v&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Select a Teacher"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,l.jsx)("button",{onClick:()=>N(e),className:"\n                      p-4 rounded-lg border-2 transition-all duration-200 text-left\n                      ".concat((null==u?void 0:u._id)===e._id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50","\n                    "),children:(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white font-semibold",children:e.name.charAt(0).toUpperCase()})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.specialty||"General English"}),e.rating&&(0,l.jsxs)("div",{className:"flex items-center mt-1",children:[(0,l.jsx)("span",{className:"text-yellow-400",children:"★"}),(0,l.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:e.rating})]})]})]})},e._id))})]}),u&&!v&&(0,l.jsx)(g,{teacherId:u._id,teacherName:u.name,onBookingComplete:e=>{p(!0),y(e),(0,c.x9)("Lesson booked successfully with ".concat(e.teacher.name,"!"))}}),!u&&!v&&(0,l.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"How to Book a Lesson"}),(0,l.jsxs)("div",{className:"text-sm text-blue-700 space-y-2",children:[(0,l.jsxs)("p",{children:["1. ",(0,l.jsx)("strong",{children:"Select a Teacher:"})," Choose from our qualified English teachers above"]}),(0,l.jsxs)("p",{children:["2. ",(0,l.jsx)("strong",{children:"View Availability:"})," See the teacher's available time slots"]}),(0,l.jsxs)("p",{children:["3. ",(0,l.jsx)("strong",{children:"Choose a Time:"})," Click on an available slot that works for you"]}),(0,l.jsxs)("p",{children:["4. ",(0,l.jsx)("strong",{children:"Confirm Booking:"})," Review and confirm your lesson booking"]}),(0,l.jsxs)("p",{children:["5. ",(0,l.jsx)("strong",{children:"Get Ready:"})," You'll receive confirmation and can join your lesson at the scheduled time"]})]})]})]})})]})}},6642:function(e,s,t){"use strict";t.d(s,{_N:function(){return a},x9:function(){return r}});var l=t(56158);let a=e=>{l.Am.error(e)},r=e=>{l.Am.success(e)}}},function(e){e.O(0,[1216,1088,2888,179],function(){return e(e.s=43651)}),_N_E=e.O()}]);
//# sourceMappingURL=reserve-025024f790d4f1bb.js.map