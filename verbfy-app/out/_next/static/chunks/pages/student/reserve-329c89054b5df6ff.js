(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3950],{43651:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/student/reserve",function(){return a(74237)}])},74237:function(e,s,a){"use strict";a.r(s);var t=a(85893),r=a(67294),l=a(9008),n=a.n(l),d=a(11163),i=a(10571),c=a(36197),o=a(32798),m=a(6642);let x=["VerbfySpeak","VerbfyListen","VerbfyRead","VerbfyWrite","VerbfyGrammar","VerbfyExam"],u=["Beginner","Intermediate","Advanced"],h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];s.default=()=>{let{user:e}=(0,c.Eu)(),s=(0,d.useRouter)(),[a,l]=(0,r.useState)([]),[b,g]=(0,r.useState)(null),[y,f]=(0,r.useState)([]),[j,N]=(0,r.useState)(null),[p,v]=(0,r.useState)(""),[k,w]=(0,r.useState)({teacherId:"",slotId:"",actualDate:"",studentTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,lessonType:"VerbfySpeak",lessonLevel:"Intermediate",notes:""}),[T,S]=(0,r.useState)(!1),[_,C]=(0,r.useState)(null),[L,D]=(0,r.useState)(null),[E,A]=(0,r.useState)(1);(0,r.useEffect)(()=>{if(e&&"student"!==e.role){s.replace("/dashboard");return}B()},[e,s]);let B=async()=>{try{S(!0);let e=await o.ZP.get("/api/users/teachers");e.data&&e.data.success&&Array.isArray(e.data.teachers)?l(e.data.teachers):Array.isArray(e.data)?l(e.data):l([])}catch(e){C("Failed to load teachers"),(0,m._N)("Failed to load teachers")}finally{S(!1)}},I=async e=>{try{S(!0);let s=await o.ZP.get("/api/availability/teacher/".concat(e));f(s.data.availability||[])}catch(e){C("Failed to load teacher availability"),(0,m._N)("Failed to load teacher availability")}finally{S(!1)}},F=async e=>{g(e),w(s=>({...s,teacherId:e._id})),await I(e._id),A(2)},V=(e,s)=>{N(e),v(s),w(a=>({...a,slotId:e._id,actualDate:s})),A(3)},P=async()=>{try{S(!0),C(null),(await o.ZP.post("/api/reservations/book",k)).data.success&&(D("Lesson booked successfully!"),(0,m.x9)("Lesson booked successfully!"),setTimeout(()=>{s.push("/student/dashboard")},2e3))}catch(t){var e,a;let s=(null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Failed to book lesson";C(s),(0,m._N)(s)}finally{S(!1)}},Z=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,a=[],t=new Date;for(let r=0;r<30;r++){let l=new Date(t);if(l.setDate(t.getDate()+r),l.getDay()===e&&l>=t&&(a.push(l.toISOString().split("T")[0]),a.length>=s))break}return a},O=e=>{let[s,a]=e.split(":"),t=parseInt(s);return"".concat(t%12||12,":").concat(a," ").concat(t>=12?"PM":"AM")};return e?"student"!==e.role?(0,t.jsx)(i.Z,{allowedRoles:["student"],children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-gray-600",children:"This page is only accessible to students."})]})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n(),{children:[(0,t.jsx)("title",{children:"Book a Lesson - Verbfy"}),(0,t.jsx)("meta",{name:"description",content:"Book a lesson with one of our qualified English teachers"})]}),(0,t.jsx)(i.Z,{allowedRoles:["student"],children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Book a Lesson"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Choose your teacher and schedule your 30-minute English lesson"})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"flex items-center justify-center space-x-4",children:[1,2,3].map(e=>(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(E>=e?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:e}),e<3&&(0,t.jsx)("div",{className:"w-16 h-1 mx-2 ".concat(E>e?"bg-blue-600":"bg-gray-200")})]},e))}),(0,t.jsxs)("div",{className:"flex justify-center mt-2 space-x-8 text-sm text-gray-600",children:[(0,t.jsx)("span",{className:E>=1?"text-blue-600 font-medium":"",children:"Select Teacher"}),(0,t.jsx)("span",{className:E>=2?"text-blue-600 font-medium":"",children:"Choose Time"}),(0,t.jsx)("span",{className:E>=3?"text-blue-600 font-medium":"",children:"Confirm Booking"})]})]}),_&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-red-600",children:_})}),L&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-green-600",children:L})}),1===E&&(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-6 text-gray-900 dark:text-white",children:"Choose Your Teacher"}),T?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading teachers..."})]}):0===a.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("i",{className:"fas fa-user-times text-4xl text-gray-300 mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"No teachers available"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>F(e),children:[(0,t.jsxs)("div",{className:"flex items-center mb-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,t.jsx)("i",{className:"fas fa-user text-blue-600"})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.specialty||"English Teacher"})]})]}),e.bio&&(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:e.bio}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-gray-500",children:[e.totalLessons||0," lessons"]}),(0,t.jsx)("span",{className:"text-blue-600 font-medium",children:"Select →"})]})]},e._id))})]}),2===E&&b&&(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Choose Time with ",b.name]}),(0,t.jsx)("button",{onClick:()=>A(1),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"← Change Teacher"})]}),T?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading availability..."})]}):y.length>0?(0,t.jsx)("div",{className:"space-y-6",children:h.map((e,s)=>{let a=y.filter(e=>e.dayOfWeek===s&&!e.isBooked);return 0===a.length?null:(0,t.jsxs)("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:e}),a.map(e=>{let a=Z(s);return(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("div",{className:"flex items-center mb-2",children:(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[O(e.startTime)," - ",O(e.endTime)]})}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2",children:a.map(s=>(0,t.jsx)("button",{onClick:()=>V(e,s),className:"p-2 text-sm border border-gray-200 dark:border-gray-600 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 transition-colors",children:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})},s))})]},e._id)})]},s)})}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("i",{className:"fas fa-calendar-times text-4xl text-gray-300 mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"No available time slots"})]})]}),3===E&&b&&j&&(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Confirm Your Booking"}),(0,t.jsx)("button",{onClick:()=>A(2),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"← Change Time"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Lesson Details"}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Teacher:"}),(0,t.jsx)("span",{className:"font-medium",children:b.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Date:"}),(0,t.jsx)("span",{className:"font-medium",children:new Date(p).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Time:"}),(0,t.jsxs)("span",{className:"font-medium",children:[O(j.startTime)," - ",O(j.endTime)]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Duration:"}),(0,t.jsx)("span",{className:"font-medium",children:"30 minutes"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Lesson Preferences"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Lesson Type"}),(0,t.jsx)("select",{value:k.lessonType,onChange:e=>w(s=>({...s,lessonType:e.target.value})),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700",children:x.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Level"}),(0,t.jsx)("select",{value:k.lessonLevel,onChange:e=>w(s=>({...s,lessonLevel:e.target.value})),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700",children:u.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (Optional)"}),(0,t.jsx)("textarea",{value:k.notes,onChange:e=>w(s=>({...s,notes:e.target.value})),placeholder:"Any specific topics or goals for this lesson?",rows:3,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700"})]})]})]})]}),(0,t.jsx)("div",{className:"mt-8 flex justify-end",children:(0,t.jsx)("button",{onClick:P,disabled:T,className:"bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:T?"Booking...":"Confirm Booking"})})]})]})})]}):(0,t.jsx)(i.Z,{allowedRoles:["student"],children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})})})}},6642:function(e,s,a){"use strict";a.d(s,{_N:function(){return r},x9:function(){return l}});var t=a(56158);let r=e=>{t.Am.error(e)},l=e=>{t.Am.success(e)}}},function(e){e.O(0,[2138,9226,9496,8484,437,5823,2244,6235,5323,747,3365,8638,9806,7093,8510,8424,8639,7855,7446,2169,8308,1408,6259,4657,8212,571,5522,1493,2888,5514,179],function(){return e(e.s=43651)}),_N_E=e.O()}]);