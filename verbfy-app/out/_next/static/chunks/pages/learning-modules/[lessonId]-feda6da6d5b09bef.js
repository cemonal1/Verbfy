(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6581],{48773:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/learning-modules/[lessonId]",function(){return t(40045)}])},40045:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return u}});var n=t(85893),l=t(67294),i=t(9008),r=t.n(i),a=t(11163),o=t(32798),c=t(36197);let d=e=>{var s,t,i;let{lessonId:r,onComplete:d}=e,u=(0,a.useRouter)(),{user:m}=(0,c.Eu)(),[x,h]=(0,l.useState)(null),[v,g]=(0,l.useState)(0),[f,b]=(0,l.useState)(0),[p,j]=(0,l.useState)({}),[y,N]=(0,l.useState)(0),[w,S]=(0,l.useState)(!0),[_,E]=(0,l.useState)(!1),[L,I]=(0,l.useState)(null),[k,C]=(0,l.useState)(!0);(0,l.useEffect)(()=>{r&&J()},[r]),(0,l.useEffect)(()=>{let e=setInterval(()=>{N(e=>e+1)},1e3);return()=>clearInterval(e)},[]);let J=async()=>{try{var e,s;S(!0);let t=await (null===(e=o.J0.getLesson)||void 0===e?void 0:e.call(o.J0,r));if(t){let e=t.lesson?{_id:t.lesson.id||r,title:t.lesson.title,description:t.lesson.description||"",lessonType:t.lesson.type||"VerbfyGrammar",cefrLevel:t.lesson.cefrLevel||"A1",difficulty:t.lesson.difficulty||"Beginner",category:"",estimatedDuration:t.lesson.estimatedDuration||0,content:{instructions:t.lesson.instructions||"",materials:t.lesson.materials||[],exercises:t.lesson.exercises||[]},learningObjectives:[],tags:[],isActive:!0,isPremium:!1,createdBy:{_id:"",name:""},averageRating:0,totalRatings:0,completionRate:0,averageCompletionTime:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}:t;h(e)}let n=await (null===(s=o.J0.startLesson)||void 0===s?void 0:s.call(o.J0,r));I((null==n?void 0:n.attemptId)||r)}catch(e){console.error("Error fetching lesson:",e)}finally{S(!1)}},O=async()=>{if(L&&x)try{var e;E(!0);let s=Object.entries(p).map(e=>{let[s,t]=e;return{questionIndex:parseInt(s),studentAnswer:t,timeSpent:0}}),t=await (null===(e=o.J0.submitLesson)||void 0===e?void 0:e.call(o.J0,L,{answers:s,timeSpent:y}));d?d(t):u.push("/verbfy-lessons/".concat(r,"/results"))}catch(e){console.error("Error submitting lesson:",e)}finally{E(!1)}};return w?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading lesson..."})]})}):x?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:x.title}),(0,n.jsx)("p",{className:"text-gray-600 mt-1",children:"Follow the instructions and complete the exercises"})]}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:(0,n.jsxs)("span",{children:["Time spent: ","".concat(Math.floor(y/60),":").concat((y%60).toString().padStart(2,"0"))]})})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:k?(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Instructions"}),(0,n.jsx)("p",{className:"text-gray-700 mb-4",children:(null===(s=x.content)||void 0===s?void 0:s.instructions)||"Read the instructions carefully."}),(0,n.jsx)("button",{onClick:()=>C(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Start Lesson"})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:x.title}),(0,n.jsxs)("div",{className:"mt-6 flex justify-between",children:[(0,n.jsx)("button",{onClick:()=>{f>0&&b(f-1)},disabled:0===f,className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 disabled:opacity-50",children:"Previous"}),(0,n.jsx)("button",{onClick:()=>{var e,s;f<((null==x?void 0:null===(s=x.content)||void 0===s?void 0:null===(e=s.exercises)||void 0===e?void 0:e.length)||0)-1?b(f+1):O()},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:f<((null===(i=x.content)||void 0===i?void 0:null===(t=i.exercises)||void 0===t?void 0:t.length)||0)-1?"Next":"Submit"})]})]})})]})}):(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("p",{className:"text-red-600",children:"Lesson not found"})})})};function u(){let{user:e,loading:s}=(0,c.Eu)(),t=(0,a.useRouter)(),{lessonId:i}=t.query;return((0,l.useEffect)(()=>{s||e||t.push("/login")},[e,s,t]),s)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e&&"string"==typeof i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r(),{children:[(0,n.jsx)("title",{children:"Take Lesson - Verbfy"}),(0,n.jsx)("meta",{name:"description",content:"Start your Verbfy learning lesson"})]}),(0,n.jsx)(d,{lessonId:i,onComplete:e=>{console.log("Lesson completed:",e)}})]}):null}}},function(e){e.O(0,[1216,2888,179],function(){return e(e.s=48773)}),_N_E=e.O()}]);