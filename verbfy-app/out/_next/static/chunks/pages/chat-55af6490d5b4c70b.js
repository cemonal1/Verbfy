(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8180,4536],{99937:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(90398)}])},90398:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(85893),r=s(67294),n=s(9008),l=s.n(n),d=s(36197),i=s(95109),c=s(10571),x=s(44451);function o(e){let{onConversationSelect:t,selectedConversationId:s}=e,{state:r}=(0,i.R)(),{conversations:n,loading:l,error:d}=r;return l?(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading conversations..."})]}):d?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-red-500 mb-2",children:"⚠️"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:d})]}):0===n.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCAC"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No conversations yet"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Start a conversation with a teacher or student to begin chatting."})]}):(0,a.jsx)("div",{className:"space-y-1",children:n.map(e=>(0,a.jsx)(m,{conversation:e,isSelected:e._id===s,onClick:()=>t(e)},e._id))})}function m(e){let{conversation:t,isSelected:s,onClick:r}=e,{otherParticipant:n,lastMessage:l,unreadCount:d,updatedAt:i}=t;return(0,a.jsxs)("div",{onClick:r,className:"\n        flex items-center space-x-3 p-4 rounded-lg cursor-pointer transition-colors\n        ".concat(s?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":"hover:bg-gray-50 dark:hover:bg-gray-800","\n      "),children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-blue-50 dark:bg-blue-900",children:(0,a.jsx)("img",{src:n.avatar||"/images/default-avatar.png",alt:n.name,className:"w-12 h-12 object-cover"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:n.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:(0,x.z1)(i)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"font-medium",children:[l.sender===n._id?n.name:"You",":"]})," ",(0,x.IC)(l.content,30)]}):"No messages yet"}),d>0&&(0,a.jsx)("div",{className:"flex-shrink-0 ml-2",children:(0,a.jsx)("span",{className:"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full",children:d>99?"99+":d})})]}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("span",{className:"\n            inline-flex items-center px-2 py-1 rounded-full text-xs font-medium\n            ".concat("teacher"===n.role?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200","\n          "),children:"teacher"===n.role?"\uD83D\uDC68‍\uD83C\uDFEB Teacher":"\uD83D\uDC68‍\uD83C\uDF93 Student"})})]})]})}var h=s(64536);function g(){let{hasAccess:e,isLoading:t}=(0,d.eB)(["student","teacher"]),{state:s}=(0,i.R)(),[n,x]=(0,r.useState)(null);return t?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})}):e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l(),{children:[(0,a.jsx)("title",{children:"Chat - Verbfy"}),(0,a.jsx)("meta",{name:"description",content:"Real-time messaging with teachers and students"})]}),(0,a.jsx)(c.Z,{allowedRoles:["student","teacher"],title:"Chat",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Messages"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Connect with teachers and students through real-time messaging"})]}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 h-[600px]",children:(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"w-1/3 border-r border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Conversations"})}),(0,a.jsx)("div",{className:"h-[calc(600px-80px)] overflow-y-auto",children:(0,a.jsx)(o,{onConversationSelect:e=>{x(e)},selectedConversationId:null==n?void 0:n._id})})]}),(0,a.jsx)("div",{className:"flex-1",children:n?(0,a.jsx)(h.default,{conversationId:n._id,otherParticipant:n.otherParticipant}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCAC"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Select a conversation"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Choose a conversation from the list to start messaging."})]})})})]})}),(0,a.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6",children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:"⚡"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Real-time Messaging"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Send and receive messages instantly with live updates and typing indicators."})]}),(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-6",children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:"\uD83D\uDD12"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Secure Communication"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"All messages are encrypted and only visible to conversation participants."})]}),(0,a.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-6",children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:"\uD83D\uDCF1"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Cross-platform"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Access your conversations from any device with automatic synchronization."})]})]})]})})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Only students and teachers can access the chat system."})]})})}},64536:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(85893),r=s(67294),n=s(95109),l=s(36197),d=s(44451);function i(e){let{conversationId:t,otherParticipant:s}=e,{state:d,actions:i}=(0,n.R)(),{user:x}=(0,l.aC)(),[o,m]=(0,r.useState)(""),[h,g]=(0,r.useState)(!1),u=(0,r.useRef)(null),b=(0,r.useRef)(null),{messages:y,loading:j,error:f,typingUsers:v}=d;(0,r.useEffect)(()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[y]),(0,r.useEffect)(()=>(i.joinConversation(t),i.loadMessages(t),i.markAsRead(t),()=>{i.leaveConversation(t)}),[t]),(0,r.useEffect)(()=>{h?i.setTyping(t,!0):i.setTyping(t,!1)},[h,t]);let N=async e=>{var s;if(e.preventDefault(),!o.trim())return;let a={conversationId:t,content:o.trim(),messageType:"text"};await i.sendMessage(a),m(""),g(!1),null===(s=b.current)||void 0===s||s.focus()};return j?(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading messages..."})]}):f?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-red-500 mb-2",children:"⚠️"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:f})]}):(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-blue-50 dark:bg-blue-900",children:(0,a.jsx)("img",{src:s.avatar||"/images/default-avatar.png",alt:s.name,className:"w-10 h-10 object-cover"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:s.role})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===y.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCAC"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Start a conversation"}),(0,a.jsxs)("p",{className:"text-gray-500 dark:text-gray-400",children:["Send a message to begin chatting with ",s.name,"."]})]}):y.map(e=>(0,a.jsx)(c,{message:e,isOwnMessage:e.sender._id===(null==x?void 0:x._id)},e._id)),v.has(s._id)&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsxs)("span",{className:"text-sm",children:[s.name," is typing..."]})]}),(0,a.jsx)("div",{ref:u})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("form",{onSubmit:N,className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{ref:b,value:o,onChange:e=>{m(e.target.value),!h&&e.target.value.length>0?g(!0):h&&0===e.target.value.length&&g(!1)},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N(e))},placeholder:"Type your message...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none",rows:1,maxLength:1e3})}),(0,a.jsx)("button",{type:"submit",disabled:!o.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right",children:[o.length,"/1000"]})]})]})}function c(e){let{message:t,isOwnMessage:s}=e;return(0,a.jsxs)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:[(0,a.jsx)("div",{className:"max-w-xs lg:max-w-md ".concat(s?"order-2":"order-1"),children:(0,a.jsxs)("div",{className:"\n            px-4 py-2 rounded-lg shadow-sm\n            ".concat(s?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white","\n          "),children:[(0,a.jsx)("p",{className:"text-sm",children:t.content}),(0,a.jsxs)("div",{className:"text-xs mt-1 ".concat(s?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:[(0,d.B_)(t.createdAt),s&&(0,a.jsx)("span",{className:"ml-2",children:t.isRead?"✓✓":"✓"})]})]})}),(0,a.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden ".concat(s?"order-1 ml-2":"order-2 mr-2"),children:(0,a.jsx)("img",{src:t.sender.avatar||"/images/default-avatar.png",alt:t.sender.name,className:"w-8 h-8 object-cover"})})]})}},44451:function(e,t,s){"use strict";s.d(t,{B_:function(){return a},IC:function(){return n},z1:function(){return r}});let a=e=>{let t=new Date(e),s=(new Date().getTime()-t.getTime())/36e5;return s<24?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):s<48?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},r=e=>{let t=new Date(e),s=(new Date().getTime()-t.getTime())/36e5;if(s<1){let e=Math.floor(60*s);return 0===e?"Just now":"".concat(e,"m ago")}return s<24?"".concat(Math.floor(s),"h ago"):s<48?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.length<=t?e:e.substring(0,t)+"..."}}},function(e){e.O(0,[2138,9226,9496,8484,437,5823,2244,6235,5323,747,3365,8638,9806,7093,8510,8424,8639,7855,7446,2169,8308,1408,6259,4657,8212,571,1493,2888,5514,179],function(){return e(e.s=99937)}),_N_E=e.O()}]);