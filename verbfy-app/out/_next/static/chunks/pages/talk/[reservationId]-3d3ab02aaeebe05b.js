(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3910],{40578:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/talk/[reservationId]",function(){return n(4135)}])},4135:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n(85893),s=n(67294),l=n(11163),c=n(9008),i=n.n(c),o=n(60201),a=n(98019),d=n(49486),u=n(95591),h=n(32798);let m=(0,s.createContext)(void 0),x=()=>{let e=(0,s.useContext)(m);if(!e)throw Error("useLiveKit must be used within a LiveKitProvider");return e},f=e=>{let{children:t}=e,[n,l]=(0,s.useState)(null),[c,i]=(0,s.useState)(!1),[o,a]=(0,s.useState)(null),d=(0,s.useCallback)(async e=>{try{i(!0),a(null);let{token:t,url:n}=(await h.ZP.post("/api/livekit/token/".concat(e))).data,r=new u.du({adaptiveStream:!0,dynacast:!0,stopLocalTrackOnUnpublish:!0});await r.connect(n,t),l(r)}catch(e){throw console.error("Failed to connect to LiveKit room:",e),a(e),e}finally{i(!1)}},[]),x=(0,s.useCallback)(()=>{n&&(n.disconnect(),l(null))},[n]);return(0,r.jsx)(m.Provider,{value:{room:n,isConnecting:c,error:o,connect:d,disconnect:x},children:t})};n(13618);let j=e=>{let{roomName:t,onError:n,onConnected:l,onDisconnected:c}=e,{room:i,isConnecting:u,error:h,connect:m,disconnect:f}=x();return((0,s.useEffect)(()=>(t&&m(t).then(()=>{console.log("✅ Connected to LiveKit room:",t),null==l||l()}).catch(e=>{console.error("❌ Failed to connect to LiveKit room:",e),null==n||n(e)}),()=>{f(),null==c||c()}),[t,m,f,l,c,n]),u)?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),(0,r.jsx)("p",{className:"mt-4",children:"Connecting to room..."})]})}):h?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-red-500",children:[(0,r.jsxs)("p",{children:["Failed to connect: ",h.message]}),(0,r.jsx)("button",{onClick:()=>m(t),className:"mt-4 px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark",children:"Try Again"})]})}):i?(0,r.jsx)("div",{className:"h-full",children:(0,r.jsxs)(o.zc,{children:[(0,r.jsx)(a.G,{tracks:(0,d.t)(),children:(0,r.jsx)(a.P,{})}),(0,r.jsx)(a.R,{}),(0,r.jsx)(o.VS,{})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("p",{children:"Room not connected"})})};function v(){let e=(0,l.useRouter)(),{reservationId:t}=e.query,[n,c]=(0,s.useState)(null);return e.isReady&&t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Verbfy - Video Lesson"})}),(0,r.jsx)("div",{className:"h-screen bg-white",children:(0,r.jsx)(f,{children:n?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-red-500",children:[(0,r.jsx)("p",{className:"text-xl font-semibold",children:"Connection Error"}),(0,r.jsx)("p",{className:"mt-2",children:n.message})]})}):(0,r.jsx)(j,{roomName:t,onError:e=>{console.error("Room error:",e),c(e)},onDisconnected:()=>{console.log("Disconnected from room")}})})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}}},function(e){e.O(0,[1216,2888,179],function(){return e(e.s=40578)}),_N_E=e.O()}]);
//# sourceMappingURL=[reservationId]-3d3ab02aaeebe05b.js.map