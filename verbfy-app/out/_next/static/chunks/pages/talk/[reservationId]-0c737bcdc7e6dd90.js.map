{"version":3,"file":"static/chunks/pages/talk/[reservationId]-0c737bcdc7e6dd90.js","mappings":"0FACA,CAAAA,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAC,IAAA,EACA,wBACA,WACA,OAAeC,EAAQ,KACvB,EACA,gKCCe,SAASC,IACtB,IAAMC,EAASC,CAAAA,EAAAA,EAAAA,SAAAA,IACT,CAAEC,cAAAA,CAAa,CAAE,CAAGF,EAAOG,KAAK,CAChC,CAACC,EAAOC,EAAS,CAAGC,CAAAA,EAAAA,EAAAA,QAAAA,EAAuB,aAGjD,EAAYC,OAAO,EAAKL,EAkBtB,GAAAM,EAAAC,IAAA,EAAAD,EAAAE,QAAA,YACE,GAAAF,EAAAG,GAAA,EAACC,IAAIA,UACH,GAAAJ,EAAAG,GAAA,EAACE,QAAAA,UAAM,4BAGT,GAAAL,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,6BACb,GAAAP,EAAAG,GAAA,EAACK,EAAAA,CAAeA,CAAAA,UACbZ,EACC,GAAAI,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,mDACb,GAAAP,EAAAC,IAAA,EAACK,MAAAA,CAAIC,UAAU,qCACb,GAAAP,EAAAG,GAAA,EAACM,IAAAA,CAAEF,UAAU,iCAAwB,qBACrC,GAAAP,EAAAG,GAAA,EAACM,IAAAA,CAAEF,UAAU,gBAAQX,EAAMc,OAAO,QAItC,GAAAV,EAAAG,GAAA,EAACQ,EAAAA,WAAWA,CAAAA,CACVC,SAAUlB,EACVmB,QA3BQ,IAClBC,QAAQlB,KAAK,CAAC,cAAeA,GAC7BC,EAASD,EACX,EAyBYmB,eAvBe,KACzBD,QAAQE,GAAG,CAAC,yBACd,WAbI,GAAAhB,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,qDACb,GAAAP,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,mEAwCvB,sKCpCO,IAAMI,EAA0C,OAAC,CACtDC,SAAAA,CAAQ,CACRC,QAAAA,CAAO,CACPI,YAAAA,CAAW,CACXF,eAAAA,CAAc,CACf,CAAAG,EACO,CAAEC,KAAAA,CAAI,CAAEC,aAAAA,CAAY,CAAExB,MAAAA,CAAK,CAAEyB,QAAAA,CAAO,CAAEC,WAAAA,CAAU,CAAE,CAAGC,CAAAA,EAAAA,EAAAA,CAAAA,UAqB3D,CAnBAC,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACJZ,GACFS,EAAQT,GACLa,IAAI,CAAC,KACJX,QAAQE,GAAG,CAAC,+BAAgCJ,GAC5CK,MAAAA,GAAAA,GACF,GACCS,KAAK,CAAC,IACLZ,QAAQlB,KAAK,CAAC,uCAAwC+B,GACtDd,MAAAA,GAAAA,EAAUc,EACZ,GAGG,KACLL,IACAP,MAAAA,GAAAA,GACF,GACC,CAACH,EAAUS,EAASC,EAAYL,EAAaF,EAAgBF,EAAQ,EAEpEO,GAEA,GAAApB,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,mDACb,GAAAP,EAAAC,IAAA,EAACK,MAAAA,CAAIC,UAAU,wBACb,GAAAP,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,kEACf,GAAAP,EAAAG,GAAA,EAACM,IAAAA,CAAEF,UAAU,gBAAO,+BAMxBX,EAEA,GAAAI,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,mDACb,GAAAP,EAAAC,IAAA,EAACK,MAAAA,CAAIC,UAAU,qCACb,GAAAP,EAAAC,IAAA,EAACQ,IAAAA,WAAE,sBAAoBb,EAAMc,OAAO,IACpC,GAAAV,EAAAG,GAAA,EAACyB,SAAAA,CACCC,QAAS,IAAMR,EAAQT,GACvBL,UAAU,8EACX,mBAQJY,EASH,GAAAnB,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,kBACb,GAAAP,EAAAC,IAAA,EAAC6B,EAAAA,EAAeA,CAAAA,WACd,GAAA9B,EAAAG,GAAA,EAAC4B,EAAAA,CAAUA,CAAAA,CAACC,OAAQC,CAAAA,EAAAA,EAAAA,CAAAA,aAClB,GAAAjC,EAAAG,GAAA,EAAC+B,EAAAA,CAAeA,CAAAA,CAAAA,KAElB,GAAAlC,EAAAG,GAAA,EAACgC,EAAAA,CAAiBA,CAAAA,CAAAA,GAClB,GAAAnC,EAAAG,GAAA,EAACiC,EAAAA,EAAUA,CAAAA,CAAAA,QAbb,GAAApC,EAAAG,GAAA,EAACG,MAAAA,CAAIC,UAAU,mDACb,GAAAP,EAAAG,GAAA,EAACM,IAAAA,UAAE,wBAgBX,6ICjFA,IAAM4B,EAAiBC,CAAAA,EAAAA,EAAAA,aAAAA,EAA8CC,KAAAA,GAExDhB,EAAa,KACxB,IAAMiB,EAAUC,CAAAA,EAAAA,EAAAA,UAAAA,EAAWJ,GAC3B,GAAI,CAACG,EACH,MAAM,MAAU,oDAElB,OAAOA,CACT,EAMahC,EAAkD,OAAC,CAAEkC,SAAAA,CAAQ,CAAE,CAAAxB,EACpE,CAACC,EAAMwB,EAAQ,CAAG7C,CAAAA,EAAAA,EAAAA,QAAAA,EAAsB,MACxC,CAACsB,EAAcwB,EAAgB,CAAG9C,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IAC3C,CAACF,EAAOC,EAAS,CAAGC,CAAAA,EAAAA,EAAAA,QAAAA,EAAuB,MAE3CuB,EAAUwB,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,MAAOjC,IACjC,GAAI,CACFgC,EAAgB,IAChB/C,EAAS,MAIT,GAAM,CAAEiD,MAAAA,CAAK,CAAEC,IAAAA,CAAG,CAAE,CAAGC,CADN,MAAMC,EAAAA,EAAGA,CAACC,IAAI,CAAC,sBAA+BC,MAAA,CAATvC,GAAAA,EACtBwC,IAAI,CAU9BC,EAAU,IAAIC,EAAAA,EAAIA,CAPS,CAC/BC,eAAgB,GAChBC,SAAU,GACVC,0BAA2B,EAC7B,EAIA,OAAMJ,EAAQhC,OAAO,CAAC0B,EAAKD,GAE3BH,EAAQU,EACV,CAAE,MAAO1B,EAAK,CAGZ,MAFAb,QAAQlB,KAAK,CAAC,qCAAsC+B,GACpD9B,EAAS8B,GACHA,CACR,QAAU,CACRiB,EAAgB,GAClB,CACF,EAAG,EAAE,EAECtB,EAAauB,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,KACzB1B,IACFA,EAAKG,UAAU,GACfqB,EAAQ,MAEZ,EAAG,CAACxB,EAAK,EAET,MACE,GAAAnB,EAAAG,GAAA,EAACkC,EAAeqB,QAAQ,EACtBC,MAAO,CACLxC,KAAAA,EACAC,aAAAA,EACAxB,MAAAA,EACAyB,QAAAA,EACAC,WAAAA,CACF,WAECoB,GAGP","sources":["webpack://_N_E/?eeac","webpack://_N_E/./pages/talk/[reservationId].tsx","webpack://_N_E/./src/components/livekit/LiveKitRoom.tsx","webpack://_N_E/./src/context/LiveKitContext.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/talk/[reservationId]\",\n      function () {\n        return require(\"private-next-pages/talk/[reservationId].tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/talk/[reservationId]\"])\n      });\n    }\n  ","import React, { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport Head from 'next/head';\r\nimport { useAuthContext } from '@/context/AuthContext';\r\nimport { LiveKitRoom } from '@/components/livekit/LiveKitRoom';\r\nimport { LiveKitProvider } from '@/context/LiveKitContext';\r\n\r\nexport default function TalkPage() {\r\n  const router = useRouter();\r\n  const { reservationId } = router.query;\r\n  const [error, setError] = useState<Error | null>(null);\r\n\r\n  // Wait for router to be ready\r\n  if (!router.isReady || !reservationId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleError = (error: Error) => {\r\n    console.error('Room error:', error);\r\n    setError(error);\r\n  };\r\n\r\n  const handleDisconnected = () => {\r\n    console.log('Disconnected from room');\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>Verbfy - Video Lesson</title>\r\n      </Head>\r\n\r\n      <div className=\"h-screen bg-white\">\r\n        <LiveKitProvider>\r\n          {error ? (\r\n            <div className=\"flex items-center justify-center h-full\">\r\n              <div className=\"text-center text-red-500\">\r\n                <p className=\"text-xl font-semibold\">Connection Error</p>\r\n                <p className=\"mt-2\">{error.message}</p>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <LiveKitRoom\r\n              roomName={reservationId as string}\r\n              onError={handleError}\r\n              onDisconnected={handleDisconnected}\r\n            />\r\n          )}\r\n        </LiveKitProvider>\r\n      </div>\r\n    </>\r\n  );\r\n} ","import React, { useEffect } from 'react';\r\nimport {\r\n  VideoConference,\r\n  GridLayout,\r\n  ParticipantTile,\r\n  ControlBar,\r\n  useTracks,\r\n  RoomAudioRenderer\r\n} from '@livekit/components-react';\r\nimport { Track } from 'livekit-client';\r\nimport { useLiveKit } from '../../context/LiveKitContext';\r\nimport '@livekit/components-styles';\r\n\r\ninterface LiveKitRoomProps {\r\n  roomName: string;\r\n  onError?: (error: Error) => void;\r\n  onConnected?: () => void;\r\n  onDisconnected?: () => void;\r\n}\r\n\r\nexport const LiveKitRoom: React.FC<LiveKitRoomProps> = ({\r\n  roomName,\r\n  onError,\r\n  onConnected,\r\n  onDisconnected\r\n}) => {\r\n  const { room, isConnecting, error, connect, disconnect } = useLiveKit();\r\n\r\n  useEffect(() => {\r\n    if (roomName) {\r\n      connect(roomName)\r\n        .then(() => {\r\n          console.log('✅ Connected to LiveKit room:', roomName);\r\n          onConnected?.();\r\n        })\r\n        .catch((err) => {\r\n          console.error('❌ Failed to connect to LiveKit room:', err);\r\n          onError?.(err);\r\n        });\r\n    }\r\n\r\n    return () => {\r\n      disconnect();\r\n      onDisconnected?.();\r\n    };\r\n  }, [roomName, connect, disconnect, onConnected, onDisconnected, onError]);\r\n\r\n  if (isConnecting) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\r\n          <p className=\"mt-4\">Connecting to room...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-center text-red-500\">\r\n          <p>Failed to connect: {error.message}</p>\r\n          <button\r\n            onClick={() => connect(roomName)}\r\n            className=\"mt-4 px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark\"\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!room) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <p>Room not connected</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-full\">\r\n      <VideoConference>\r\n        <GridLayout tracks={useTracks()}>\r\n          <ParticipantTile />\r\n        </GridLayout>\r\n        <RoomAudioRenderer />\r\n        <ControlBar />\r\n      </VideoConference>\r\n    </div>\r\n  );\r\n}; ","import React, { createContext, useContext, useState, useCallback } from 'react';\r\nimport { Room, RoomOptions } from 'livekit-client';\r\nimport api from '../lib/api';\r\n\r\ninterface LiveKitContextType {\r\n  room: Room | null;\r\n  isConnecting: boolean;\r\n  error: Error | null;\r\n  connect: (roomName: string) => Promise<void>;\r\n  disconnect: () => void;\r\n}\r\n\r\nconst LiveKitContext = createContext<LiveKitContextType | undefined>(undefined);\r\n\r\nexport const useLiveKit = () => {\r\n  const context = useContext(LiveKitContext);\r\n  if (!context) {\r\n    throw new Error('useLiveKit must be used within a LiveKitProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface LiveKitProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const LiveKitProvider: React.FC<LiveKitProviderProps> = ({ children }) => {\r\n  const [room, setRoom] = useState<Room | null>(null);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const [error, setError] = useState<Error | null>(null);\r\n\r\n  const connect = useCallback(async (roomName: string) => {\r\n    try {\r\n      setIsConnecting(true);\r\n      setError(null);\r\n\r\n      // Get token from backend\r\n      const response = await api.post(`/api/livekit/token/${roomName}`);\r\n      const { token, url } = response.data;\r\n\r\n      // Initialize room options\r\n      const roomOptions: RoomOptions = {\r\n        adaptiveStream: true,\r\n        dynacast: true,\r\n        stopLocalTrackOnUnpublish: true\r\n      };\r\n\r\n      // Create and connect room\r\n      const newRoom = new Room(roomOptions);\r\n      await newRoom.connect(url, token);\r\n\r\n      setRoom(newRoom);\r\n    } catch (err) {\r\n      console.error('Failed to connect to LiveKit room:', err);\r\n      setError(err as Error);\r\n      throw err;\r\n    } finally {\r\n      setIsConnecting(false);\r\n    }\r\n  }, []);\r\n\r\n  const disconnect = useCallback(() => {\r\n    if (room) {\r\n      room.disconnect();\r\n      setRoom(null);\r\n    }\r\n  }, [room]);\r\n\r\n  return (\r\n    <LiveKitContext.Provider\r\n      value={{\r\n        room,\r\n        isConnecting,\r\n        error,\r\n        connect,\r\n        disconnect\r\n      }}\r\n    >\r\n      {children}\r\n    </LiveKitContext.Provider>\r\n  );\r\n}; "],"names":["window","__NEXT_P","push","__webpack_require__","TalkPage","router","useRouter","reservationId","query","error","setError","useState","isReady","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","Fragment","jsx","Head","title","div","className","LiveKitProvider","p","message","LiveKitRoom","roomName","onError","console","onDisconnected","log","onConnected","param","room","isConnecting","connect","disconnect","useLiveKit","useEffect","then","catch","err","button","onClick","VideoConference","GridLayout","tracks","useTracks","ParticipantTile","RoomAudioRenderer","ControlBar","LiveKitContext","createContext","undefined","context","useContext","children","setRoom","setIsConnecting","useCallback","token","url","response","api","post","concat","data","newRoom","Room","adaptiveStream","dynacast","stopLocalTrackOnUnpublish","Provider","value"],"sourceRoot":""}