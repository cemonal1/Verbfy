(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9469],{35342:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ai-tutoring",function(){return t(8696)}])},8696:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return u}});var n=t(85893),a=t(67294),r=t(9008),i=t.n(r),l=t(11163),c=t(32798),d=t(36197);let o=e=>{let{sessionType:s="conversation",onComplete:t}=e,r=(0,l.useRouter)(),{user:i}=(0,d.Eu)(),[o,u]=(0,a.useState)(null),[x,m]=(0,a.useState)([]),[g,h]=(0,a.useState)(""),[p,f]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!0),[y,v]=(0,a.useState)(!1),[N,w]=(0,a.useState)(!0),D=(0,a.useRef)(null),S=(0,a.useRef)(!0),_=(0,a.useRef)(null),T=(0,a.useRef)(null);(0,a.useEffect)(()=>(S.current=!0,k(),()=>{S.current=!1,_.current&&(clearTimeout(_.current),_.current=null),T.current&&(clearTimeout(T.current),T.current=null)}),[s]),(0,a.useEffect)(()=>{E()},[x]);let E=()=>{var e;null===(e=D.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},k=async()=>{try{var e;j(!0);let t=await (null===(e=c.qV.startTutoringSession)||void 0===e?void 0:e.call(c.qV,{sessionType:s,cefrLevel:(null==i?void 0:i.cefrLevel)||"A1"}));t&&(_.current=window.setTimeout(()=>{S.current&&(u(t),m(t.messages||[]))},0))}catch(e){}finally{S.current&&j(!1)}},C=async()=>{if(!g.trim()||!o)return;let e={_id:Date.now().toString(),role:"student",content:g,timestamp:new Date().toISOString(),messageType:"text"};m(s=>[...s,e]),h(""),f(!0);try{var s;let e=await (null===(s=c.qV.sendTutoringMessage)||void 0===s?void 0:s.call(c.qV,o._id,{content:g,messageType:"text"}));S.current&&((null==e?void 0:e.message)&&m(s=>[...s,e.message]),(null==e?void 0:e.session)&&u(e.session))}catch(s){let e={_id:Date.now().toString(),role:"ai",content:"Sorry, I encountered an error. Please try again.",timestamp:new Date().toISOString(),messageType:"text"};S.current&&m(s=>[...s,e])}finally{S.current&&f(!1)}},I=async()=>{try{v(!0),T.current=window.setTimeout(()=>{if(!S.current)return;v(!1);let e={_id:Date.now().toString(),role:"student",content:"[Audio message]",timestamp:new Date().toISOString(),messageType:"audio",audioUrl:"/sample-audio.mp3"};m(s=>[...s,e])},3e3)}catch(e){S.current&&v(!1)}},A=async()=>{if(o)try{let e=await c.qV.endTutoringSession(o._id);u(e),t?t(e):r.push("/ai-tutoring/session/".concat(o._id,"/results"))}catch(e){}};return b?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Initializing AI tutor..."})]})}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,n.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("div",{className:"text-2xl",children:{conversation:"\uD83D\uDCAC",grammar:"\uD83D\uDCDD",pronunciation:"\uD83D\uDDE3️",writing:"✍️",reading:"\uD83D\uDCD6",listening:"\uD83D\uDC42"}[s]||"\uD83E\uDD16"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"AI Tutor"}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 capitalize",children:[s," Session"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("span",{className:"px-3 py-1 text-sm font-medium rounded-full ".concat({conversation:"bg-blue-100 text-blue-800",grammar:"bg-green-100 text-green-800",pronunciation:"bg-purple-100 text-purple-800",writing:"bg-yellow-100 text-yellow-800",reading:"bg-indigo-100 text-indigo-800",listening:"bg-pink-100 text-pink-800"}[s]||"bg-gray-100 text-gray-800"),children:s}),(0,n.jsx)("button",{onClick:A,className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition-colors",children:"End Session"})]})]})})}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col max-w-4xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6",children:[(0,n.jsxs)("div",{className:"flex-1 bg-white rounded-lg shadow-md flex flex-col",children:[(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[x.map(e=>(0,n.jsx)("div",{className:"flex ".concat("student"===e.role?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("student"===e.role?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,n.jsx)("div",{className:"text-sm",children:e.content}),e.corrections&&N&&e.corrections.length>0&&(0,n.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Corrections:"}),e.corrections.map((e,s)=>(0,n.jsxs)("div",{className:"text-xs",children:[(0,n.jsx)("span",{className:"line-through text-red-400",children:e.original}),(0,n.jsx)("span",{className:"mx-1",children:"→"}),(0,n.jsx)("span",{className:"text-green-600 font-medium",children:e.corrected}),(0,n.jsx)("div",{className:"text-gray-500 mt-1",children:e.explanation})]},s))]}),e.suggestions&&e.suggestions.length>0&&(0,n.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Suggestions:"}),e.suggestions.map((e,s)=>(0,n.jsxs)("div",{className:"text-xs",children:[(0,n.jsx)("span",{className:"font-medium",children:e.suggestion}),(0,n.jsx)("div",{className:"text-gray-500 mt-1",children:e.explanation})]},s))]}),e.audioUrl&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,n.jsx)("source",{src:e.audioUrl,type:"audio/mpeg"}),"Your browser does not support the audio element."]})}),(0,n.jsx)("div",{className:"text-xs opacity-70 mt-1",children:new Date(e.timestamp).toLocaleTimeString()})]})},e._id)),p&&(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsx)("div",{className:"bg-gray-100 text-gray-900 max-w-xs lg:max-w-md px-4 py-2 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"animate-pulse",children:"\uD83E\uDD16"}),(0,n.jsxs)("div",{className:"flex space-x-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,n.jsx)("div",{ref:D})]}),(0,n.jsxs)("div",{className:"border-t p-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)("textarea",{value:g,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},placeholder:"Type your message...",rows:1,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",disabled:p})}),(0,n.jsx)("button",{onClick:C,disabled:!g.trim()||p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Send"}),(0,n.jsx)("button",{onClick:y?()=>{v(!1)}:I,disabled:p,className:"px-4 py-2 rounded-lg transition-colors ".concat(y?"bg-red-600 text-white hover:bg-red-700":"bg-gray-600 text-white hover:bg-gray-700"," disabled:opacity-50 disabled:cursor-not-allowed"),children:y?"⏹️":"\uD83C\uDFA4"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,n.jsx)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",checked:N,onChange:e=>w(e.target.checked),className:"mr-2"}),"Show corrections"]})}),o&&(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:["Session time: ",Math.floor((Date.now()-new Date(o.startedAt).getTime())/1e3/60),"m"]})]})]})]}),o&&(0,n.jsxs)("div",{className:"mt-6 bg-white rounded-lg shadow-md p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Skills Progress"}),(0,n.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:Object.entries(o.skills).map(e=>{let[s,t]=e;return(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[t,"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 capitalize",children:s}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(t,"%")}})})]},s)})})]})]})]})};function u(){let{user:e,loading:s}=(0,d.Eu)(),t=(0,l.useRouter)();return((0,a.useEffect)(()=>{s||e||t.push("/login")},[e,s,t]),s)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i(),{children:[(0,n.jsx)("title",{children:"AI Tutoring - Verbfy"}),(0,n.jsx)("meta",{name:"description",content:"Start your AI-powered English tutoring session"})]}),(0,n.jsx)(o,{sessionType:"conversation",onComplete:e=>{t.push("/ai-tutoring/session/".concat(e._id,"/results"))}})]}):null}}},function(e){e.O(0,[2138,9226,9496,8484,437,5823,2244,6235,5323,747,3365,8638,9806,7093,8510,8424,8639,7855,7446,2169,8308,1408,6259,4657,8212,1493,2888,5514,179],function(){return e(e.s=35342)}),_N_E=e.O()}]);