{"version":3,"file":"static/chunks/pages/chat/[id]-494103ee25337a52.js","mappings":"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","sources":["webpack://_N_E/?c49e","webpack://_N_E/./pages/chat/[id].tsx","webpack://_N_E/./src/components/chat/ChatInterface.tsx","webpack://_N_E/./src/types/chat.ts"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/chat/[id]\",\n      function () {\n        return require(\"private-next-pages/chat/[id].tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/chat/[id]\"])\n      });\n    }\n  ","import React, { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport Head from 'next/head';\r\nimport { useAuth, useRoleGuard } from '../../src/context/AuthContext';\r\nimport { useChat } from '../../src/context/ChatContext';\r\nimport DashboardLayout from '../../src/components/layout/DashboardLayout';\r\nimport ChatInterface from '../../src/components/chat/ChatInterface';\r\nimport { Conversation } from '../../src/types/chat';\r\nimport api from '../../src/lib/api';\r\n\r\nexport default function ChatConversationPage() {\r\n  const router = useRouter();\r\n  const { id: conversationId } = router.query;\r\n  const { hasAccess, isLoading } = useRoleGuard(['student', 'teacher']);\r\n  const { state, actions } = useChat();\r\n  const [conversation, setConversation] = useState<Conversation | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Load conversation data when ID changes\r\n  useEffect(() => {\r\n    if (conversationId && typeof conversationId === 'string') {\r\n      loadConversation(conversationId);\r\n    }\r\n  }, [conversationId]);\r\n\r\n  const loadConversation = async (convId: string) => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const response = await api.get(`/api/chat/conversations/${convId}`);\r\n      \r\n      if (response.data.success) {\r\n        setConversation(response.data.data);\r\n      } else {\r\n        setError('Conversation not found');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error loading conversation:', error);\r\n      const errorMessage = error.response?.data?.message || 'Failed to load conversation';\r\n      setError(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Show loading state while checking authentication\r\n  if (isLoading || loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600 dark:text-gray-400\">Loading conversation...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show access denied if user doesn't have permission\r\n  if (!hasAccess) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-4\">\r\n            Access Denied\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\r\n            Only students and teachers can access the chat system.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show error if conversation not found\r\n  if (error) {\r\n    return (\r\n      <DashboardLayout allowedRoles={['student', 'teacher']} title=\"Chat\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n          <div className=\"text-center py-12\">\r\n            <div className=\"text-red-500 mb-4\">⚠️</div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-4\">\r\n              Conversation Not Found\r\n            </h1>\r\n            <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\r\n              {error}\r\n            </p>\r\n            <button\r\n              onClick={() => router.push('/chat')}\r\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\r\n            >\r\n              Back to Chat\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  // Show loading if conversation not loaded yet\r\n  if (!conversation) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600 dark:text-gray-400\">Loading conversation...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>Chat with {conversation.otherParticipant.name} - Verbfy</title>\r\n        <meta name=\"description\" content={`Chat with ${conversation.otherParticipant.name}`} />\r\n      </Head>\r\n\r\n      <DashboardLayout \r\n        allowedRoles={['student', 'teacher']}\r\n        title={`Chat with ${conversation.otherParticipant.name}`}\r\n      >\r\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n          {/* Header */}\r\n          <div className=\"mb-8\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                  Chat with {conversation.otherParticipant.name}\r\n                </h1>\r\n                <p className=\"text-gray-600 dark:text-gray-400\">\r\n                  {conversation.otherParticipant.role === 'teacher' ? '👨‍🏫 Teacher' : '👨‍🎓 Student'}\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={() => router.push('/chat')}\r\n                className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors\"\r\n              >\r\n                ← Back to Conversations\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Chat Interface */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 h-[600px]\">\r\n            <ChatInterface\r\n              conversationId={conversation._id}\r\n              otherParticipant={conversation.otherParticipant}\r\n            />\r\n          </div>\r\n\r\n          {/* Conversation Info */}\r\n          <div className=\"mt-8 bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\r\n              Conversation Information\r\n            </h3>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">Participant</p>\r\n                <p className=\"text-gray-900 dark:text-white font-medium\">\r\n                  {conversation.otherParticipant.name}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">Role</p>\r\n                <p className=\"text-gray-900 dark:text-white font-medium capitalize\">\r\n                  {conversation.otherParticipant.role}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">Email</p>\r\n                <p className=\"text-gray-900 dark:text-white font-medium\">\r\n                  {conversation.otherParticipant.email}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">Started</p>\r\n                <p className=\"text-gray-900 dark:text-white font-medium\">\r\n                  {new Date(conversation.createdAt).toLocaleDateString()}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    </>\r\n  );\r\n} ","import React, { useState, useEffect, useRef } from 'react';\r\nimport { useChat } from '../../context/ChatContext';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { Message, formatMessageTime } from '../../types/chat';\r\n\r\ninterface ChatInterfaceProps {\r\n  conversationId: string;\r\n  otherParticipant: {\r\n    _id: string;\r\n    name: string;\r\n    role: string;\r\n    avatar?: string;\r\n  };\r\n}\r\n\r\nexport default function ChatInterface({ conversationId, otherParticipant }: ChatInterfaceProps) {\r\n  const { state, actions } = useChat();\r\n  const { user } = useAuth();\r\n  const [message, setMessage] = useState('');\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const { messages, loading, error, typingUsers } = state;\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Join conversation room when component mounts\r\n  useEffect(() => {\r\n    actions.joinConversation(conversationId);\r\n    actions.loadMessages(conversationId);\r\n    actions.markAsRead(conversationId);\r\n\r\n    return () => {\r\n      actions.leaveConversation(conversationId);\r\n    };\r\n  }, [conversationId]);\r\n\r\n  // Handle typing indicator\r\n  useEffect(() => {\r\n    if (isTyping) {\r\n      actions.setTyping(conversationId, true);\r\n    } else {\r\n      actions.setTyping(conversationId, false);\r\n    }\r\n  }, [isTyping, conversationId]);\r\n\r\n  const handleSendMessage = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!message.trim()) return;\r\n\r\n    const messageData = {\r\n      conversationId,\r\n      content: message.trim(),\r\n      messageType: 'text' as const\r\n    };\r\n\r\n    await actions.sendMessage(messageData);\r\n    setMessage('');\r\n    setIsTyping(false);\r\n    \r\n    // Focus back to input\r\n    inputRef.current?.focus();\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n    setMessage(e.target.value);\r\n    \r\n    // Set typing indicator\r\n    if (!isTyping && e.target.value.length > 0) {\r\n      setIsTyping(true);\r\n    } else if (isTyping && e.target.value.length === 0) {\r\n      setIsTyping(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSendMessage(e);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        <span className=\"ml-2 text-gray-600 dark:text-gray-400\">Loading messages...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"text-center py-8\">\r\n        <div className=\"text-red-500 mb-2\">⚠️</div>\r\n        <p className=\"text-gray-600 dark:text-gray-400\">{error}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center space-x-3 p-4 border-b border-gray-200 dark:border-gray-700\">\r\n        <div className=\"w-10 h-10 rounded-full overflow-hidden bg-blue-50 dark:bg-blue-900\">\r\n          {/* eslint-disable-next-line @next/next/no-img-element */}\r\n          <img\r\n            src={otherParticipant.avatar || '/images/default-avatar.png'}\r\n            alt={otherParticipant.name}\r\n            className=\"w-10 h-10 object-cover\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\r\n            {otherParticipant.name}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 capitalize\">\r\n            {otherParticipant.role}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 ? (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"text-4xl mb-4\">💬</div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n              Start a conversation\r\n            </h3>\r\n            <p className=\"text-gray-500 dark:text-gray-400\">\r\n              Send a message to begin chatting with {otherParticipant.name}.\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          messages.map((msg) => (\r\n            <MessageItem\r\n              key={msg._id}\r\n              message={msg}\r\n              isOwnMessage={msg.sender._id === user?._id}\r\n            />\r\n          ))\r\n        )}\r\n        \r\n        {/* Typing indicator */}\r\n        {typingUsers.has(otherParticipant._id) && (\r\n          <div className=\"flex items-center space-x-2 text-gray-500 dark:text-gray-400\">\r\n            <div className=\"flex space-x-1\">\r\n              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\r\n              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\r\n              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\r\n            </div>\r\n            <span className=\"text-sm\">{otherParticipant.name} is typing...</span>\r\n          </div>\r\n        )}\r\n        \r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Message Input */}\r\n      <div className=\"p-4 border-t border-gray-200 dark:border-gray-700\">\r\n        <form onSubmit={handleSendMessage} className=\"flex space-x-3\">\r\n          <div className=\"flex-1\">\r\n            <textarea\r\n              ref={inputRef}\r\n              value={message}\r\n              onChange={handleInputChange}\r\n              onKeyPress={handleKeyPress}\r\n              placeholder=\"Type your message...\"\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none\"\r\n              rows={1}\r\n              maxLength={1000}\r\n            />\r\n          </div>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={!message.trim()}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            Send\r\n          </button>\r\n        </form>\r\n        \r\n        {/* Character count */}\r\n        <div className=\"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right\">\r\n          {message.length}/1000\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MessageItemProps {\r\n  message: Message;\r\n  isOwnMessage: boolean;\r\n}\r\n\r\nfunction MessageItem({ message, isOwnMessage }: MessageItemProps) {\r\n  return (\r\n    <div className={`flex ${isOwnMessage ? 'justify-end' : 'justify-start'}`}>\r\n      <div className={`max-w-xs lg:max-w-md ${isOwnMessage ? 'order-2' : 'order-1'}`}>\r\n        <div\r\n          className={`\r\n            px-4 py-2 rounded-lg shadow-sm\r\n            ${isOwnMessage\r\n              ? 'bg-blue-600 text-white'\r\n              : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white'\r\n            }\r\n          `}\r\n        >\r\n          <p className=\"text-sm\">{message.content}</p>\r\n          <div className={`text-xs mt-1 ${isOwnMessage ? 'text-blue-100' : 'text-gray-500 dark:text-gray-400'}`}>\r\n            {formatMessageTime(message.createdAt)}\r\n            {isOwnMessage && (\r\n              <span className=\"ml-2\">\r\n                {message.isRead ? '✓✓' : '✓'}\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Avatar */}\r\n      <div className={`w-8 h-8 rounded-full overflow-hidden ${isOwnMessage ? 'order-1 ml-2' : 'order-2 mr-2'}`}>\r\n        {/* eslint-disable-next-line @next/next/no-img-element */}\r\n        <img\r\n          src={message.sender.avatar || '/images/default-avatar.png'}\r\n          alt={message.sender.name}\r\n          className=\"w-8 h-8 object-cover\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n} ","// User interface for chat participants\r\nexport interface ChatUser {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  role: 'student' | 'teacher' | 'admin';\r\n  avatar?: string;\r\n}\r\n\r\n// Message interface\r\nexport interface Message {\r\n  _id: string;\r\n  conversationId: string;\r\n  sender: ChatUser;\r\n  content: string;\r\n  messageType: 'text' | 'image' | 'file' | 'system';\r\n  isRead: boolean;\r\n  readAt?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// Conversation interface\r\nexport interface Conversation {\r\n  _id: string;\r\n  otherParticipant: ChatUser;\r\n  lastMessage?: {\r\n    content: string;\r\n    sender: string;\r\n    timestamp: string;\r\n  };\r\n  unreadCount: number;\r\n  updatedAt: string;\r\n  createdAt: string;\r\n}\r\n\r\n// API Response interfaces\r\nexport interface ConversationsResponse {\r\n  success: boolean;\r\n  data: Conversation[];\r\n  message: string;\r\n}\r\n\r\nexport interface ConversationResponse {\r\n  success: boolean;\r\n  data: Conversation;\r\n  message: string;\r\n}\r\n\r\nexport interface MessagesResponse {\r\n  success: boolean;\r\n  data: {\r\n    messages: Message[];\r\n    pagination: {\r\n      page: number;\r\n      limit: number;\r\n      total: number;\r\n      pages: number;\r\n    };\r\n  };\r\n  message: string;\r\n}\r\n\r\nexport interface MessageResponse {\r\n  success: boolean;\r\n  data: Message;\r\n  message: string;\r\n}\r\n\r\nexport interface SendMessageData {\r\n  conversationId: string;\r\n  content: string;\r\n  messageType?: 'text' | 'image' | 'file' | 'system';\r\n}\r\n\r\nexport interface UnreadCountResponse {\r\n  success: boolean;\r\n  data: { unreadCount: number };\r\n  message: string;\r\n}\r\n\r\n// Socket.IO event interfaces\r\nexport interface SocketMessage {\r\n  conversationId: string;\r\n  message: Message;\r\n}\r\n\r\nexport interface TypingData {\r\n  conversationId: string;\r\n  userId: string;\r\n  isTyping: boolean;\r\n}\r\n\r\nexport interface UserTypingData {\r\n  userId: string;\r\n  isTyping: boolean;\r\n}\r\n\r\n// Chat state interface\r\nexport interface ChatState {\r\n  conversations: Conversation[];\r\n  currentConversation: Conversation | null;\r\n  messages: Message[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  unreadCount: number;\r\n  typingUsers: Set<string>;\r\n}\r\n\r\n// Chat context interface\r\nexport interface ChatContextType {\r\n  state: ChatState;\r\n  actions: {\r\n    loadConversations: () => Promise<void>;\r\n    loadMessages: (conversationId: string, page?: number) => Promise<void>;\r\n    sendMessage: (data: SendMessageData) => Promise<void>;\r\n    markAsRead: (conversationId: string) => Promise<void>;\r\n    joinConversation: (conversationId: string) => void;\r\n    leaveConversation: (conversationId: string) => void;\r\n    setTyping: (conversationId: string, isTyping: boolean) => void;\r\n    loadUnreadCount: () => Promise<void>;\r\n  };\r\n}\r\n\r\n// Utility functions\r\nexport const formatMessageTime = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\r\n\r\n  if (diffInHours < 24) {\r\n    return date.toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  } else if (diffInHours < 48) {\r\n    return 'Yesterday';\r\n  } else {\r\n    return date.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  }\r\n};\r\n\r\nexport const formatConversationTime = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\r\n\r\n  if (diffInHours < 1) {\r\n    const diffInMinutes = Math.floor(diffInHours * 60);\r\n    return diffInMinutes === 0 ? 'Just now' : `${diffInMinutes}m ago`;\r\n  } else if (diffInHours < 24) {\r\n    return `${Math.floor(diffInHours)}h ago`;\r\n  } else if (diffInHours < 48) {\r\n    return 'Yesterday';\r\n  } else {\r\n    return date.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  }\r\n};\r\n\r\nexport const truncateMessage = (content: string, maxLength: number = 50): string => {\r\n  if (content.length <= maxLength) return content;\r\n  return content.substring(0, maxLength) + '...';\r\n}; "],"names":["window","__NEXT_P","push","__webpack_require__","ChatConversationPage","router","useRouter","id","conversationId","query","hasAccess","isLoading","useRoleGuard","state","actions","useChat","conversation","setConversation","useState","loading","setLoading","error","setError","useEffect","loadConversation","convId","response","api","get","concat","data","success","console","message","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsx","div","className","jsxs","p","DashboardLayout","allowedRoles","title","h1","button","onClick","Fragment","Head","otherParticipant","name","meta","content","role","ChatInterface","_id","h3","email","Date","createdAt","toLocaleDateString","param","user","useAuth","setMessage","isTyping","setIsTyping","messagesEndRef","useRef","inputRef","messages","typingUsers","current","scrollIntoView","behavior","joinConversation","loadMessages","markAsRead","leaveConversation","setTyping","handleSendMessage","e","preventDefault","trim","messageData","messageType","sendMessage","focus","span","img","src","avatar","alt","length","map","MessageItem","msg","isOwnMessage","sender","has","style","animationDelay","ref","form","onSubmit","textarea","value","onChange","target","onKeyPress","key","shiftKey","placeholder","rows","maxLength","type","disabled","formatMessageTime","isRead","date","dateString","diffInHours","now","getTime","toLocaleTimeString","hour","minute","month","day","formatConversationTime","diffInMinutes","Math","floor","truncateMessage","substring"],"sourceRoot":""}