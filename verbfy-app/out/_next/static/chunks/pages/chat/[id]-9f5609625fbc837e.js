(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6934,4536],{97189:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[id]",function(){return a(23978)}])},23978:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(85893),r=a(67294),n=a(11163),i=a(9008),l=a.n(i),d=a(36197),c=a(95109),o=a(11088),x=a(64536),m=a(32798);function h(){let e=(0,n.useRouter)(),{id:t}=e.query,{hasAccess:a,isLoading:i}=(0,d.eB)(["student","teacher"]),{state:h,actions:u}=(0,c.R)(),[g,y]=(0,r.useState)(null),[f,j]=(0,r.useState)(!0),[b,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&"string"==typeof t&&p(t)},[t]);let p=async e=>{try{j(!0),v(null);let t=await m.ZP.get("/api/chat/conversations/".concat(e));t.data.success?y(t.data.data):v("Conversation not found")}catch(e){var t,a;v((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Failed to load conversation")}finally{j(!1)}};return i||f?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading conversation..."})]})}):a?b?(0,s.jsx)(o.Z,{allowedRoles:["student","teacher"],title:"Chat",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-red-500 mb-4",children:"⚠️"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Conversation Not Found"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:b}),(0,s.jsx)("button",{onClick:()=>e.push("/chat"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Back to Chat"})]})})}):g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l(),{children:[(0,s.jsxs)("title",{children:["Chat with ",g.otherParticipant.name," - Verbfy"]}),(0,s.jsx)("meta",{name:"description",content:"Chat with ".concat(g.otherParticipant.name)})]}),(0,s.jsx)(o.Z,{allowedRoles:["student","teacher"],title:"Chat with ".concat(g.otherParticipant.name),children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:["Chat with ",g.otherParticipant.name]}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"teacher"===g.otherParticipant.role?"\uD83D\uDC68‍\uD83C\uDFEB Teacher":"\uD83D\uDC68‍\uD83C\uDF93 Student"})]}),(0,s.jsx)("button",{onClick:()=>e.push("/chat"),className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:"← Back to Conversations"})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 h-[600px]",children:(0,s.jsx)(x.default,{conversationId:g._id,otherParticipant:g.otherParticipant})}),(0,s.jsxs)("div",{className:"mt-8 bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Conversation Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Participant"}),(0,s.jsx)("p",{className:"text-gray-900 dark:text-white font-medium",children:g.otherParticipant.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Role"}),(0,s.jsx)("p",{className:"text-gray-900 dark:text-white font-medium capitalize",children:g.otherParticipant.role})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Email"}),(0,s.jsx)("p",{className:"text-gray-900 dark:text-white font-medium",children:g.otherParticipant.email})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Started"}),(0,s.jsx)("p",{className:"text-gray-900 dark:text-white font-medium",children:new Date(g.createdAt).toLocaleDateString()})]})]})]})]})})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading conversation..."})]})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Access Denied"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Only students and teachers can access the chat system."})]})})}},64536:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var s=a(85893),r=a(67294),n=a(95109),i=a(36197),l=a(44451);function d(e){let{conversationId:t,otherParticipant:a}=e,{state:l,actions:d}=(0,n.R)(),{user:o}=(0,i.aC)(),[x,m]=(0,r.useState)(""),[h,u]=(0,r.useState)(!1),g=(0,r.useRef)(null),y=(0,r.useRef)(null),{messages:f,loading:j,error:b,typingUsers:v}=l;(0,r.useEffect)(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[f]),(0,r.useEffect)(()=>(d.joinConversation(t),d.loadMessages(t),d.markAsRead(t),()=>{d.leaveConversation(t)}),[t]),(0,r.useEffect)(()=>{h?d.setTyping(t,!0):d.setTyping(t,!1)},[h,t]);let p=async e=>{var a;if(e.preventDefault(),!x.trim())return;let s={conversationId:t,content:x.trim(),messageType:"text"};await d.sendMessage(s),m(""),u(!1),null===(a=y.current)||void 0===a||a.focus()};return j?(0,s.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading messages..."})]}):b?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-red-500 mb-2",children:"⚠️"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:b})]}):(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-blue-50 dark:bg-blue-900",children:(0,s.jsx)("img",{src:a.avatar||"/images/default-avatar.png",alt:a.name,className:"w-10 h-10 object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:a.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:a.role})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===f.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCAC"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Start a conversation"}),(0,s.jsxs)("p",{className:"text-gray-500 dark:text-gray-400",children:["Send a message to begin chatting with ",a.name,"."]})]}):f.map(e=>(0,s.jsx)(c,{message:e,isOwnMessage:e.sender._id===(null==o?void 0:o._id)},e._id)),v.has(a._id)&&(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,s.jsxs)("span",{className:"text-sm",children:[a.name," is typing..."]})]}),(0,s.jsx)("div",{ref:g})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("form",{onSubmit:p,className:"flex space-x-3",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("textarea",{ref:y,value:x,onChange:e=>{m(e.target.value),!h&&e.target.value.length>0?u(!0):h&&0===e.target.value.length&&u(!1)},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p(e))},placeholder:"Type your message...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none",rows:1,maxLength:1e3})}),(0,s.jsx)("button",{type:"submit",disabled:!x.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right",children:[x.length,"/1000"]})]})]})}function c(e){let{message:t,isOwnMessage:a}=e;return(0,s.jsxs)("div",{className:"flex ".concat(a?"justify-end":"justify-start"),children:[(0,s.jsx)("div",{className:"max-w-xs lg:max-w-md ".concat(a?"order-2":"order-1"),children:(0,s.jsxs)("div",{className:"\n            px-4 py-2 rounded-lg shadow-sm\n            ".concat(a?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white","\n          "),children:[(0,s.jsx)("p",{className:"text-sm",children:t.content}),(0,s.jsxs)("div",{className:"text-xs mt-1 ".concat(a?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:[(0,l.B_)(t.createdAt),a&&(0,s.jsx)("span",{className:"ml-2",children:t.isRead?"✓✓":"✓"})]})]})}),(0,s.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden ".concat(a?"order-1 ml-2":"order-2 mr-2"),children:(0,s.jsx)("img",{src:t.sender.avatar||"/images/default-avatar.png",alt:t.sender.name,className:"w-8 h-8 object-cover"})})]})}},44451:function(e,t,a){"use strict";a.d(t,{B_:function(){return s},IC:function(){return n},z1:function(){return r}});let s=e=>{let t=new Date(e),a=(new Date().getTime()-t.getTime())/36e5;return a<24?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):a<48?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},r=e=>{let t=new Date(e),a=(new Date().getTime()-t.getTime())/36e5;if(a<1){let e=Math.floor(60*a);return 0===e?"Just now":"".concat(e,"m ago")}return a<24?"".concat(Math.floor(a),"h ago"):a<48?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.length<=t?e:e.substring(0,t)+"..."}}},function(e){e.O(0,[2138,9226,9496,8484,437,1883,7,747,3365,8638,9806,7093,8510,8424,8639,7855,7446,2169,8308,1408,6259,4657,8212,1088,5522,1493,2888,5514,179],function(){return e(e.s=97189)}),_N_E=e.O()}]);