(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3198],{55353:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/rooms/[roomId]",function(){return t(45649)}])},45649:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return u}});var a=t(85893),r=t(67294),n=t(11163),o=t(65705),l=t(67642),c=t(83454),i=t(36197),d=e=>{let{messages:s,sendMessage:t}=e,[n,o]=(0,r.useState)("");return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:s.map(e=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"font-bold",children:[e.username,":"]})," ",e.text]},e.id))}),(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&(t(n),o(""))},className:"p-2 border-t",children:(0,a.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),placeholder:"Type a message...",className:"w-full p-2 border rounded"})})]})},u=function(){let e=(0,n.useRouter)(),{user:s}=(0,i.Eu)(),{roomId:t}=e.query,{currentRoom:u,getRoomDetails:m,leaveRoom:h,loading:x,participants:g}=(0,o.J)(),[f,b]=(0,r.useState)(50),[v,p]=(0,r.useState)(!1),[j,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&"string"==typeof t&&m(t)},[t,m]);let w=s&&t?{self:"".concat(s.id,"-room-").concat(t),remote:void 0}:{self:"",remote:void 0},{localStream:N,remoteStreams:y,isMicOn:C,isCameraOn:D,toggleMic:L,toggleCamera:R,reconnect:E,status:S,error:I,muteStates:M,videoStates:T,toggleRemoteMute:A,toggleRemoteVideo:z,isInitialized:_}=function(e,s,t){let[a,n]=(0,r.useState)(null),[o,i]=(0,r.useState)({}),[d,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(!0),[x,g]=(0,r.useState)("disconnected"),[f,b]=(0,r.useState)(null),[v,p]=(0,r.useState)({}),[j,k]=(0,r.useState)({}),[w,N]=(0,r.useState)(!1),y=(0,r.useRef)(null),C=(0,r.useRef)({}),D=(0,r.useRef)(null),L={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]},R=(0,r.useCallback)(async()=>{try{var e,s;if(console.log("\uD83C\uDFA4 Requesting microphone and camera access..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("getUserMedia is not supported in this browser");let t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100},video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}}});if(console.log("✅ Media stream obtained:",{audioTracks:t.getAudioTracks().length,videoTracks:t.getVideoTracks().length,audioTrack:null===(e=t.getAudioTracks()[0])||void 0===e?void 0:e.label,videoTrack:null===(s=t.getVideoTracks()[0])||void 0===s?void 0:s.label}),0===t.getAudioTracks().length)throw Error("No audio tracks found in stream");return n(t),D.current=t,b(null),t}catch(e){throw console.error("❌ Failed to get media stream:",e),b("Media access failed: ".concat(e instanceof Error?e.message:"Unknown error")),e}},[]),E=(0,r.useCallback)(s=>{console.log("\uD83D\uDD17 Creating peer connection for ".concat(s));let t=new RTCPeerConnection(L);return D.current&&D.current.getTracks().forEach(e=>{t.addTrack(e,D.current),console.log("\uD83D\uDCE1 Added ".concat(e.kind," track to peer connection"))}),t.ontrack=e=>{console.log("\uD83D\uDCFA Received remote stream from ".concat(s,":"),e.streams[0]),i(t=>({...t,[s]:e.streams[0]}))},t.onicecandidate=t=>{t.candidate&&y.current&&(console.log("\uD83E\uDDCA Sending ICE candidate to ".concat(s)),y.current.emit("ice-candidate",{roomId:e,candidate:t.candidate,targetUserId:s}))},t.onconnectionstatechange=()=>{console.log("\uD83D\uDD0C Connection state for ".concat(s,":"),t.connectionState),"connected"===t.connectionState?g("connected"):"disconnected"===t.connectionState&&g("disconnected")},C.current[s]=t,t},[e]),S=(0,r.useCallback)(async()=>{try{if(w)return;console.log("\uD83D\uDE80 Initializing WebRTC..."),g("connecting"),b(null),await R();let s=(0,l.io)(c.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:5000",{auth:{token:localStorage.getItem("token")}});y.current=s,s.emit("join-room",{reservationId:e}),s.on("room-info",e=>{console.log("\uD83D\uDCCB Room info received:",e),g("connected")}),s.on("offer",async t=>{console.log("\uD83D\uDCDE Received offer from:",t.userId);let a=E(t.userId);await a.setRemoteDescription(t.offer);let r=await a.createAnswer();await a.setLocalDescription(r),s.emit("answer",{roomId:e,answer:r,targetUserId:t.userId})}),s.on("answer",async e=>{console.log("\uD83D\uDCDE Received answer from:",e.userId);let s=C.current[e.userId];s&&await s.setRemoteDescription(e.answer)}),s.on("ice-candidate",async e=>{console.log("\uD83E\uDDCA Received ICE candidate from:",e.userId);let s=C.current[e.userId];s&&await s.addIceCandidate(e.candidate)}),N(!0),console.log("✅ WebRTC initialized successfully")}catch(e){console.error("❌ Failed to initialize WebRTC:",e),b("WebRTC initialization failed: ".concat(e instanceof Error?e.message:"Unknown error")),g("error")}},[e,w,R,E]),I=(0,r.useCallback)(()=>{D.current&&(D.current.getAudioTracks().forEach(e=>{e.enabled=!e.enabled}),u(!d),console.log("\uD83C\uDFA4 Microphone ".concat(d?"disabled":"enabled")))},[d]),M=(0,r.useCallback)(()=>{D.current&&(D.current.getVideoTracks().forEach(e=>{e.enabled=!e.enabled}),h(!m),console.log("\uD83D\uDCF9 Camera ".concat(m?"disabled":"enabled")))},[m]),T=(0,r.useCallback)(()=>{console.log("\uD83D\uDD04 Reconnecting to room:",e),N(!1),g("disconnected"),b(null),Object.values(C.current).forEach(e=>e.close()),C.current={},y.current&&(y.current.disconnect(),y.current=null),setTimeout(()=>{S()},1e3)},[e,S]),A=(0,r.useCallback)(e=>{p(s=>({...s,[e]:!s[e]}))},[]),z=(0,r.useCallback)(e=>{k(s=>({...s,[e]:!s[e]}))},[]);return(0,r.useEffect)(()=>(e&&s.self&&S(),()=>{y.current&&y.current.disconnect(),Object.values(C.current).forEach(e=>e.close()),D.current&&D.current.getTracks().forEach(e=>e.stop())}),[e,s.self,S]),{localStream:a,remoteStreams:o,isMicOn:d,isCameraOn:m,toggleMic:I,toggleCamera:M,reconnect:T,status:x,error:f,muteStates:v,videoStates:j,toggleRemoteMute:A,toggleRemoteVideo:z,isInitialized:w}}(t,w,g.map(e=>e.peerId)),{messages:W,sendMessage:B}=function(e){let[s,t]=(0,r.useState)([]);return{messages:s,sendMessage:(0,r.useCallback)(async s=>{console.log("Sending message:",s,"to room:",e);let a={id:Date.now().toString(),text:s,username:"You",timestamp:new Date};t(e=>[...e,a])},[e])}}(t),H=(0,r.useRef)({});(0,r.useEffect)(()=>{Object.entries(y).forEach(e=>{let[s,t]=e,a=H.current[s];a&&t&&(a.srcObject=t)})},[y]);let U=()=>{u&&(h(u.id),e.push("/dashboard"))},F=e=>{b(e)};return x||!u?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-700",children:"Loading room..."})]})}):g.length>5?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,a.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h1",{className:"text-gray-900 text-xl font-semibold mb-2",children:"Room Full"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"This room has reached its maximum capacity."}),(0,a.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors",children:"Go to Dashboard"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-3 shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-lg font-semibold text-gray-900",children:["Room: ",u.name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[g.length," participant",1!==g.length?"s":""]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Status: ",(0,a.jsx)("span",{className:"font-medium ".concat("connected"===S?"text-green-600":"connecting"===S?"text-yellow-600":"error"===S?"text-red-600":"text-gray-600"),children:S})]}),I&&(0,a.jsx)("div",{className:"text-sm text-red-600 bg-red-50 px-2 py-1 rounded",children:I}),(0,a.jsx)("button",{onClick:E,className:"bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-sm transition-colors text-white",children:"Reconnect"}),(0,a.jsx)("button",{onClick:U,className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm transition-colors text-white",children:"Leave Room"})]})]})}),(0,a.jsxs)("div",{className:"flex-1 flex",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 bg-gray-100 p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-full",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,a.jsxs)("div",{className:"relative h-full",children:[(0,a.jsx)("div",{className:"absolute top-4 left-4 z-10",children:(0,a.jsxs)("div",{className:"bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm",children:["You ",_?"✅":"⏳"]})}),N?(0,a.jsx)("video",{autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",ref:e=>{e&&(e.srcObject=N)}}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-gray-500 mb-2",children:"connecting"===S?"\uD83C\uDFA4 Requesting microphone access...":"error"===S?"❌ Media access failed":"⏳ Initializing..."}),I&&(0,a.jsx)("div",{className:"text-xs text-red-500 max-w-xs",children:I})]})}),!C&&(0,a.jsx)("div",{className:"absolute bottom-4 left-4 z-10",children:(0,a.jsx)("div",{className:"bg-red-500 text-white p-2 rounded-full",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z",clipRule:"evenodd"})})})}),!D&&(0,a.jsx)("div",{className:"absolute bottom-4 right-4 z-10",children:(0,a.jsx)("div",{className:"bg-red-500 text-white p-2 rounded-full",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]})}),g.filter(e=>e.peerId!==w.self).map(e=>(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,a.jsxs)("div",{className:"relative h-full",children:[(0,a.jsx)("div",{className:"absolute top-4 left-4 z-10",children:(0,a.jsx)("div",{className:"bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm",children:e.name})}),(0,a.jsx)("video",{autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",ref:s=>{H.current[e.peerId]=s,s&&y[e.peerId]&&(s.srcObject=y[e.peerId])}})]})},e.peerId))]})}),(0,a.jsx)("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:L,className:"p-3 rounded-full transition-colors ".concat(C?"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-red-500 text-white"),children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:C?(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}):(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>p(!v),className:"p-3 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})}),v&&(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white border border-gray-200 rounded-lg p-3 shadow-lg",children:[(0,a.jsx)("input",{type:"range",min:"0",max:"100",value:f,onChange:e=>F(parseInt(e.target.value)),className:"w-24 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-600 mt-1",children:[f,"%"]})]})]}),(0,a.jsx)("button",{onClick:R,className:"p-3 rounded-full transition-colors ".concat(D?"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-red-500 text-white"),children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:D?(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}):(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"})})}),(0,a.jsx)("button",{onClick:()=>{k(!j)},className:"p-3 rounded-full transition-colors ".concat(j?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,a.jsx)("button",{onClick:E,className:"p-3 rounded-full bg-yellow-500 text-white hover:bg-yellow-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsx)("button",{onClick:U,className:"p-3 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),(0,a.jsxs)("div",{className:"w-80 bg-white border-l border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Participants"}),(0,a.jsx)("div",{className:"space-y-1",children:g.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-gray-700",children:e.name})]},e.id))})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)(d,{messages:W,sendMessage:B})})]})]})]})}},65705:function(e,s,t){"use strict";t.d(s,{J:function(){return r}});var a=t(67294);function r(){let[e,s]=(0,a.useState)([]),[t,r]=(0,a.useState)(null),[n,o]=(0,a.useState)(!1),[l,c]=(0,a.useState)([]),i=(0,a.useCallback)(async()=>{o(!0),s([]),o(!1)},[]),d=(0,a.useCallback)(async(e,s)=>{console.log("Joining room:",e,s)},[]);return{rooms:e,currentRoom:t,loading:n,participants:l,getAvailableRooms:i,joinRoom:d,createRoom:(0,a.useCallback)(async(e,s,t,a)=>{console.log("Creating room:",{name:e,description:s,isPrivate:t,password:a})},[]),getRoomDetails:(0,a.useCallback)(async e=>{console.log("Getting room details:",e)},[]),leaveRoom:(0,a.useCallback)(async e=>{console.log("Leaving room:",e)},[])}}}},function(e){e.O(0,[1216,2888,179],function(){return e(e.s=55353)}),_N_E=e.O()}]);
//# sourceMappingURL=[roomId]-82a47bfc77d652bb.js.map