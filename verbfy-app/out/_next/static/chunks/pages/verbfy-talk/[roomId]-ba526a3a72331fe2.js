(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8939],{4333:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verbfy-talk/[roomId]",function(){return s(74501)}])},74501:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(85893),i=s(67294),r=s(11163),l=s(11088),n=s(54310),c=s(32798),d=s(64964),o=s(32201),u=s(68606),m=s(96019),x=s(35892),h=s(71263),g=s(24585),p=s(61937);function b(){var e,t;let s=(0,r.useRouter)(),{roomId:b}=s.query,{t:f}=(0,n.Q)(),[v,j]=(0,i.useState)(null),[N,y]=(0,i.useState)(!0),[w,S]=(0,i.useState)(!1),[k,A]=(0,i.useState)(!1),[C,R]=(0,i.useState)(""),[Z,_]=(0,i.useState)(!1),[E,P]=(0,i.useState)(!1),[D,F]=(0,i.useState)(!1),[M,U]=(0,i.useState)(0),[T,J]=(0,i.useState)([]),q=(0,i.useRef)(null),I=(0,i.useRef)(new Map),L=(0,i.useRef)(null),z=(0,i.useRef)(null);(0,i.useEffect)(()=>{b&&(async()=>{try{var e,t;let s=await c.bl.getRoomDetails(b);if(j(s.data||s),(null===(e=s.data)||void 0===e?void 0:e.participants)||(null==s?void 0:s.participants)){let e=((null===(t=s.data)||void 0===t?void 0:t.participants)||(null==s?void 0:s.participants)).some(e=>e.isActive);A(e)}}finally{y(!1)}})()},[b]);let B=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});q.current=e,L.current=new AudioContext;let t=L.current.createMediaStreamSource(e);z.current=L.current.createAnalyser(),t.connect(z.current);let s=new Uint8Array(z.current.frequencyBinCount),a=()=>{if(z.current){z.current.getByteFrequencyData(s);let e=s.reduce((e,t)=>e+t)/s.length;U(e),F(e>30)}requestAnimationFrame(a)};a(),console.log("\uD83C\uDFA4 Audio initialized successfully")}catch(e){console.error("❌ Failed to initialize audio:",e)}},O=async()=>{if(b){if((null==v?void 0:v.isPrivate)&&!C){_(!0);return}try{if(S(!0),(await c.bl.joinRoom(b,{password:C})).success){A(!0),R(""),_(!1),await B();let e=await c.bl.getRoomDetails(b);j(e.data||e)}}catch(s){var e,t;console.error("Failed to join room:",s),alert((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to join room")}finally{S(!1)}}},V=async()=>{if(b)try{q.current&&q.current.getTracks().forEach(e=>e.stop()),I.current.forEach(e=>e.close()),I.current.clear(),await c.bl.leaveRoom(b),A(!1),s.push("/verbfy-talk")}catch(e){console.error("Failed to leave room:",e)}},X=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return N?(0,a.jsx)(l.Z,{title:"Loading Room...",children:(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading room details..."})}):v?(0,a.jsx)(l.Z,{title:v.name||"VerbfyTalk Room",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,a.jsx)(o.Z,{className:"w-8 h-8 text-blue-600"}),v.name]}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:v.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-4 text-sm text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[v.isPrivate?(0,a.jsx)(u.Z,{className:"w-4 h-4"}):(0,a.jsx)(m.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:v.isPrivate?"Private":"Public"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"Beginner":return(0,a.jsx)(d.Z,{className:"w-4 h-4 text-green-500"});case"Intermediate":return(0,a.jsx)(d.Z,{className:"w-4 h-4 text-yellow-500"});case"Advanced":return(0,a.jsx)(d.Z,{className:"w-4 h-4 text-red-500"});default:return(0,a.jsx)(d.Z,{className:"w-4 h-4 text-blue-500"})}})(v.level),(0,a.jsx)("span",{children:v.level})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[(null===(e=v.participants)||void 0===e?void 0:e.filter(e=>e.isActive).length)||0,"/",v.maxParticipants]})]}),v.startedAt&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Started ",X(v.startedAt)]})]})]})]}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:k?(0,a.jsx)("button",{onClick:V,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Leave Room"}):(0,a.jsx)("button",{onClick:O,disabled:w,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50",children:w?"Joining...":"Join Room"})})]}),v.topic&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Discussion Topic"}),(0,a.jsx)("p",{className:"text-blue-800",children:v.topic})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5"}),"Participants (",(null===(t=v.participants)||void 0===t?void 0:t.filter(e=>e.isActive).length)||0,")"]}),k&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("h3",{className:"font-medium text-blue-900 mb-3 flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"w-5 h-5"}),"Voice Chat Controls"]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>{if(q.current){let e=q.current.getAudioTracks()[0];e&&(e.enabled=!e.enabled,P(!e.enabled))}},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat(E?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 ".concat(E?"text-red-600":"text-green-600")}),E?"Unmute":"Mute"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-20 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full transition-all duration-100 ".concat(D?"bg-green-500":"bg-blue-500"),style:{width:"".concat(Math.min(2*M,100),"%")}})}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:D?"Speaking":"Silent"})]})]})]}),v.participants&&v.participants.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.participants.filter(e=>e.isActive).map((e,t)=>{var s,i,r;return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:(null===(i=e.userId)||void 0===i?void 0:null===(s=i.name)||void 0===s?void 0:s.charAt(0))||"U"}),e.isSpeaking&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null===(r=e.userId)||void 0===r?void 0:r.name)||"Unknown User"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Joined ",X(e.joinedAt)]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 ".concat(e.isMuted?"text-red-500":"text-green-500")}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.isMuted?"Muted":"Active"})]})]})]},t)})}):(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No participants yet"})]}),Z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enter Room Password"}),(0,a.jsx)("input",{type:"password",value:C,onChange:e=>R(e.target.value),placeholder:"Enter password",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{_(!1),R("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:O,disabled:w,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:w?"Joining...":"Join"})]})]})})]})}):(0,a.jsx)(l.Z,{title:"Room Not Found",children:(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Room not found"})})}}},function(e){e.O(0,[1216,1088,2888,179],function(){return e(e.s=4333)}),_N_E=e.O()}]);
//# sourceMappingURL=[roomId]-ba526a3a72331fe2.js.map