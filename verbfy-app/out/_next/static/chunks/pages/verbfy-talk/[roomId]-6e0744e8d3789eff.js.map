{"version":3,"file":"static/chunks/pages/verbfy-talk/[roomId]-6e0744e8d3789eff.js","mappings":"qFACA,CAAAA,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAC,IAAA,EACA,wBACA,WACA,OAAeC,EAAQ,MACvB,EACA,4KC0DA,IAAMC,EAAkC,CACtCC,WAAY,CACV,CAAEC,KAAM,8BAA+B,EACvC,CAAEA,KAAM,+BAAgC,EACxC,CAAEA,KAAM,+BAAgC,EACxC,CAAEA,KAAM,+BAAgC,EACxC,CAAEA,KAAM,+BAAgC,EACzC,CACDC,qBAAsB,EACxB,EAGMC,EAAoB,CACxBC,gBAAiB,yFACjBC,cAAe,kEACfC,kBAAmB,4CACnBC,iBAAkB,uDAClBC,WAAY,iCACZC,cAAe,0DACfC,kBAAmB,qCACnBC,aAAc,oCAChB,EAEaC,EAAgB,IAC3B,GAAM,CAACC,EAAOC,EAAS,CAAGC,CAAAA,EAAAA,EAAAA,QAAAA,EAA2B,EAAE,EACjD,CAACC,EAAaC,EAAe,CAAGF,CAAAA,EAAAA,EAAAA,QAAAA,EAAgC,MAChE,CAACG,EAAcC,EAAgB,CAAGJ,CAAAA,EAAAA,EAAAA,QAAAA,EAAkC,EAAE,EACtE,CAACK,EAASC,EAAW,CAAGN,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IACjC,CAACO,EAAWC,EAAa,CAAGR,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IACrC,CAACS,EAAaC,EAAe,CAAGV,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IACzC,CAACW,EAAcC,EAAgB,CAAGZ,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IAC3C,CAACa,EAAiBC,EAAmB,CAAGd,CAAAA,EAAAA,EAAAA,QAAAA,EAAwB,MAChE,CAACe,EAAsBC,EAAwB,CAAGhB,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,GAC3D,CAACiB,EAAeC,EAAiB,CAAGlB,CAAAA,EAAAA,EAAAA,QAAAA,EAA4C,CAAC,GACjF,CAACmB,EAAQC,EAAU,CAAGpB,CAAAA,EAAAA,EAAAA,QAAAA,EAAgE,gBACtF,CAACqB,EAAUC,EAAY,CAAGtB,CAAAA,EAAAA,EAAAA,QAAAA,EAA8B,EAAE,EAG1DuB,EAAYC,CAAAA,EAAAA,EAAAA,MAAAA,EAAsB,MAClCC,EAAiBD,CAAAA,EAAAA,EAAAA,MAAAA,EAA2B,MAC5CE,EAAqBF,CAAAA,EAAAA,EAAAA,MAAAA,EAAuC,IAAIG,KAChEC,EAAkBJ,CAAAA,EAAAA,EAAAA,MAAAA,EAA4B,MAC9CK,EAAcL,CAAAA,EAAAA,EAAAA,MAAAA,EAAwB,MACtCM,EAAgBN,CAAAA,EAAAA,EAAAA,MAAAA,EAA0C,MAC1DO,EAAwBP,CAAAA,EAAAA,EAAAA,MAAAA,EAA2C,IAAIG,KACvEK,EAAiBR,CAAAA,EAAAA,EAAAA,MAAAA,EAA8B,MAC/CS,EAAmBT,CAAAA,EAAAA,EAAAA,MAAAA,EAAO,IAG1BU,EAAWC,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,KAC3B,GAAI,CAACV,EAAeW,OAAO,EAAIJ,EAAeI,OAAO,EAGjD,CADeX,EAAeW,OAAO,CAACC,cAAc,EAAE,CAAC,EAAE,CAFN,OAMvD,IAAMC,EAAe,GAAK1D,CAAAA,OAAO2D,YAAY,EAAI3D,OAAgB4D,kBAAkB,EAC7EC,EAASH,EAAaI,uBAAuB,CAACjB,EAAeW,OAAO,EACpEO,EAAWL,EAAaM,cAAc,GACtCC,EAAY,IAAIC,WAAWH,EAASI,iBAAiB,EAoB3D,OAlBAN,EAAOO,OAAO,CAACL,GACfA,EAASM,OAAO,CAAG,IAEnBjB,EAAeI,OAAO,CAAGc,YAAY,SAM/B3B,EALJoB,EAASQ,oBAAoB,CAACN,GAC9B,IAAMO,EAAUP,EAAUQ,MAAM,CAAC,CAACC,EAAKC,IAAUD,EAAMC,EAAO,GAAKV,EAAUW,MAAM,CAI/EjC,CAAAA,OAAAA,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAmBkC,SAAS,GAAIxD,GAClCsB,EAAUa,OAAO,CAACsB,IAAI,CAAC,uBAAwB,CAC7CC,OAAQ1D,EAAY2D,EAAE,CACtBC,WANeT,EAAU,EAO3B,EAEJ,EAAG,KAGI,KACDpB,EAAeI,OAAO,GACxB0B,cAAc9B,EAAeI,OAAO,EACpCJ,EAAeI,OAAO,CAAG,MAE3BK,EAAOsB,UAAU,GACjBpB,EAASoB,UAAU,GACnBzB,EAAa0B,KAAK,EACpB,CACF,EAAG,CAAC/D,EAAY,EAGVgE,EAAU9B,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,KACtBH,EAAeI,OAAO,GACxB0B,cAAc9B,EAAeI,OAAO,EACpCJ,EAAeI,OAAO,CAAG,KAE7B,EAAG,EAAE,EAGC8B,EAAmB/B,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,cACOZ,EAA1C,GAAI,IAAUU,EAAiBG,OAAO,UAAIb,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,IAAAA,EAAmBkC,SAAS,EAEtE,GAAI,CACF7C,EAAgB,IAChBQ,EAAU,cACVN,EAAmB,MACnBE,EAAwB,GAGpBO,EAAUa,OAAO,GACnBb,EAAUa,OAAO,CAAC2B,UAAU,GAC5BxC,EAAUa,OAAO,CAAG,MAGtB,IAAM+B,EAASC,CAAAA,EAAAA,EAAAA,EAAAA,EAAG,GAAmEC,MAAA,CAAhEC,EAAQC,GAAG,CAACC,uBAAuB,EAAI,yBAAyB,gBAAe,CAClGC,KAAM,aACNC,WAAY,CAAC,UAAW,YAAY,CACpCC,SAAU,GACVC,gBAAiB,GACjBC,KAAM,CAAEC,MAAAA,CAAM,EACdC,QAAS,IACThE,qBAAsB,EACtBiE,kBAAmB,IACnBC,qBAAsB,IACtBC,QAAS,GACTC,gBAAiB,EACnB,GAEahB,EAAOiB,EAAE,CAAC,UAAW,KAChC1E,EAAe,IACfE,EAAgB,IAChBQ,EAAU,aACVN,EAAmB,MACnBE,EAAwB,GACxBiB,EAAiBG,OAAO,CAAG,EAC7B,GAEa+B,EAAOiB,EAAE,CAAC,aAAc,IACnC1E,EAAe,IACfU,EAAU,gBACVlB,EAAe,MACfE,EAAgB,EAAE,EAClB6D,IAGAvC,EAAmBU,OAAO,CAACiD,OAAO,CAACC,GAAcA,EAAWtB,KAAK,IACjEtC,EAAmBU,OAAO,CAACmD,KAAK,GAChCxD,EAAsBK,OAAO,CAACmD,KAAK,EACrC,GAEapB,EAAOiB,EAAE,CAAC,gBAAiB,IACtChE,EAAU,SACVN,EAAmB,sBAAoCuD,MAAA,CAAdmB,EAAMC,OAAO,GACtD7E,EAAgB,GAClB,GAEAuD,EAAOiB,EAAE,CAAC,oBAAqB,IAC7BhE,EAAU,cACVJ,EAAwB0E,GACxB5E,EAAmB,4BAA0CuD,MAAA,CAAdqB,EAAc,OAC/D,GAEAvB,EAAOiB,EAAE,CAAC,YAAa,IACrBhE,EAAU,aACVN,EAAmB,MACnBE,EAAwB,EAC1B,GAEAmD,EAAOiB,EAAE,CAAC,mBAAoB,KAC5BhE,EAAU,SACVN,EAAmB,iDACnBF,EAAgB,GAClB,GAGAuD,EAAOiB,EAAE,CAAC,aAAc,IACtBrF,EAAS4F,EACX,GAEAxB,EAAOiB,EAAE,CAAC,cAAe,IACvBlF,EAAe0F,EACjB,GAEAzB,EAAOiB,EAAE,CAAC,YAAa,KACrBlF,EAAe,MACfE,EAAgB,EAAE,EAClB6D,GACF,GAGAE,EAAOiB,EAAE,CAAC,sBAAuB,IAC/BhF,EAAgByF,EAClB,GAEA1B,EAAOiB,EAAE,CAAC,qBAAsB,IAC9BhF,EAAgB0F,GAAQ,IAAIA,EAAMC,EAAY,CAChD,GAEA5B,EAAOiB,EAAE,CAAC,mBAAoB,IAC5BhF,EAAgB0F,GAAQA,EAAKE,MAAM,CAACC,GAAKA,EAAErC,EAAE,GAAKsC,IAGlD,IAAMC,EAAiBzE,EAAmBU,OAAO,CAACgE,GAAG,CAACF,GAClDC,IACFA,EAAenC,KAAK,GACpBtC,EAAmBU,OAAO,CAACiE,MAAM,CAACH,IAIpCnE,EAAsBK,OAAO,CAACiE,MAAM,CAACH,GAGrChF,EAAiB4E,IACf,IAAMQ,EAAa,CAAE,GAAGR,CAAI,EAE5B,OADA,OAAOQ,CAAU,CAACJ,EAAc,CACzBI,CACT,EACF,GAEAnC,EAAOiB,EAAE,CAAC,mBAAoB,IAC5BhF,EAAgB0F,GACdA,EAAKS,GAAG,CAACN,GACPA,EAAErC,EAAE,GAAK4C,EAAKN,aAAa,CACvB,CAAE,GAAGD,CAAC,CAAE5F,QAASmG,EAAKnG,OAAO,EAC7B4F,GAGV,GAEA9B,EAAOiB,EAAE,CAAC,uBAAwB,IAChChF,EAAgB0F,GACdA,EAAKS,GAAG,CAACN,GACPA,EAAErC,EAAE,GAAK4C,EAAKN,aAAa,CACvB,CAAE,GAAGD,CAAC,CAAEpC,WAAY2C,EAAK3C,UAAU,EACnCoC,GAGV,GAGA9B,EAAOiB,EAAE,CAAC,eAAgB,MAAOoB,IAC/B,GAAI,CACF,MAAMC,EAAkBD,EAAKE,IAAI,CAAEF,EAAKG,KAAK,CAC/C,CAAE,MAAOnB,EAAO,CACdoB,QAAQpB,KAAK,CAAC,kCAAmCA,GACjD1E,EAAmB,uCACrB,CACF,GAEAqD,EAAOiB,EAAE,CAAC,gBAAiB,MAAOoB,IAChC,GAAI,CACF,MAAMK,EAAmBL,EAAKE,IAAI,CAAEF,EAAKM,MAAM,CACjD,CAAE,MAAOtB,EAAO,CACdoB,QAAQpB,KAAK,CAAC,mCAAoCA,GAClD1E,EAAmB,sCACrB,CACF,GAEAqD,EAAOiB,EAAE,CAAC,uBAAwB,MAAOoB,IACvC,GAAI,CACF,MAAMO,EAAmBP,EAAKE,IAAI,CAAEF,EAAKQ,SAAS,CACpD,CAAE,MAAOxB,EAAO,CACdoB,QAAQpB,KAAK,CAAC,mCAAoCA,GAElD,IAAMyB,EAASlF,EAAsBK,OAAO,CAACgE,GAAG,CAACI,EAAKE,IAAI,GAAK,EAAE,CACjEO,EAAOnI,IAAI,CAAC0H,EAAKQ,SAAS,EAC1BjF,EAAsBK,OAAO,CAAC8E,GAAG,CAACV,EAAKE,IAAI,CAAEO,EAC/C,CACF,GAEA1F,EAAUa,OAAO,CAAG+B,EAGpBA,EAAOT,IAAI,CAAC,YAEd,CAAE,MAAO8B,EAAO,CACdoB,QAAQpB,KAAK,CAAC,qCAAsCA,GACpD1E,EAAmB0E,aAAiB2B,MAAQ3B,EAAMC,OAAO,CAAG,iBAC5D7E,EAAgB,GAClB,CACF,EAAG,CAACkE,EAAOb,EAAQ,EAGbwC,EAAoB,MAAOC,EAAcC,KAC7C,GAAI,KA6CFpF,EA5CA,IAAM4E,EAAiB,IAAIiB,kBAAkBpI,GAE7C0C,EAAmBU,OAAO,CAAC8E,GAAG,CAACR,EAAMP,GAGjC1E,EAAeW,OAAO,EACxBX,EAAeW,OAAO,CAACiF,SAAS,GAAGhC,OAAO,CAACiC,IACzCnB,EAAeoB,QAAQ,CAACD,EAAO7F,EAAeW,OAAO,CACvD,GAIF+D,EAAeqB,cAAc,CAAG,QACPjG,CAAnBkG,CAAAA,EAAMT,SAAS,UAAIzF,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAmBkC,SAAS,GACjDlC,EAAUa,OAAO,CAACsB,IAAI,CAAC,uBAAwB,CAC7CgE,GAAIhB,EACJM,UAAWS,EAAMT,SAAS,EAGhC,EAEAb,EAAewB,uBAAuB,CAAG,KACA,WAAnCxB,EAAeyB,eAAe,GAChCzB,EAAenC,KAAK,GACpBtC,EAAmBU,OAAO,CAACiE,MAAM,CAACK,GAEtC,EAEAP,EAAe0B,0BAA0B,CAAG,KAE5C,EAGA1B,EAAe2B,OAAO,CAAG,IACvB5G,EAAiB4E,GAAS,EACxB,GAAGA,CAAI,CACP,CAACY,EAAK,CAAEe,EAAMM,OAAO,CAAC,EAAE,CAC1B,EACF,EAEA,MAAM5B,EAAe6B,oBAAoB,CAACrB,GAC1C,IAAMG,EAAS,MAAMX,EAAe8B,YAAY,GAOhD,IAAK,IAAMjB,KANX,MAAMb,EAAe+B,mBAAmB,CAACpB,GAExB,OAAjBvF,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,GAAAA,EAAmBmC,IAAI,CAAC,gBAAiB,CAAEgE,GAAIhB,EAAMI,OAAAA,CAAO,GAGjC/E,EAAsBK,OAAO,CAACgE,GAAG,CAACM,IAAS,EAAE,EAEtE,GAAI,CACF,MAAMP,EAAegC,eAAe,CAACnB,EACvC,CAAE,MAAOxB,EAAO,CACdoB,QAAQwB,IAAI,CAAC,wCAAyC5C,EACxD,CAEFzD,EAAsBK,OAAO,CAACiE,MAAM,CAACK,EAEvC,CAAE,MAAOlB,EAAO,CAEd,MADAoB,QAAQpB,KAAK,CAAC,kCAAmCA,GAC3CA,CACR,CACF,EAEMqB,EAAqB,MAAOH,EAAcI,KAC9C,GAAI,CACF,IAAMX,EAAiBzE,EAAmBU,OAAO,CAACgE,GAAG,CAACM,GAClDP,GAAkBA,WAAAA,EAAekC,cAAc,EACjD,MAAMlC,EAAe6B,oBAAoB,CAAClB,EAE9C,CAAE,MAAOtB,EAAO,CAEd,MADAoB,QAAQpB,KAAK,CAAC,mCAAoCA,GAC5CA,CACR,CACF,EAEMuB,EAAqB,MAAOL,EAAcM,KAC9C,GAAI,CACF,IAAMb,EAAiBzE,EAAmBU,OAAO,CAACgE,GAAG,CAACM,GACtD,GAAIP,GAAkBA,EAAemC,iBAAiB,CACpD,MAAMnC,EAAegC,eAAe,CAACnB,OAChC,CAEL,IAAMC,EAASlF,EAAsBK,OAAO,CAACgE,GAAG,CAACM,IAAS,EAAE,CAC5DO,EAAOnI,IAAI,CAACkI,GACZjF,EAAsBK,OAAO,CAAC8E,GAAG,CAACR,EAAMO,EAC1C,CACF,CAAE,MAAOzB,EAAO,CAEd,MADAoB,QAAQpB,KAAK,CAAC,mCAAoCA,GAC5CA,CACR,CACF,EAGM+C,EAAWpG,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,MAAOwB,QAC7BpC,EAAL,GAAI,SAACA,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAmBkC,SAAS,EAE/B,OADA3C,EAAmB,2BACZ,GAGT,GAAI,CAEF,OADAS,EAAUa,OAAO,CAACsB,IAAI,CAAC,YAAa,CAAEC,OAAAA,CAAO,GACtC,EACT,CAAE,MAAO6B,EAAO,CAGd,OAFAoB,QAAQpB,KAAK,CAAC,yBAA0BA,GACxC1E,EAAmB,uBACZ,EACT,CACF,EAAG,EAAE,EAEC0H,EAAYrG,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,SACvBZ,EAAD,QAACA,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAmBkC,SAAS,GAAKxD,IAEtCsB,EAAUa,OAAO,CAACsB,IAAI,CAAC,aAAc,CAAEC,OAAQ1D,EAAY2D,EAAE,GAC7DK,IACF,EAAG,CAAChE,EAAagE,EAAQ,EAEnBwE,EAAatG,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,MAAOuG,QAC/BnH,EAAL,GAAI,SAACA,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAmBkC,SAAS,EAE/B,OADA3C,EAAmB,2BACZ,KAGT,GAAI,CACF,OAAO,IAAI6H,QAAQ,QAKjBpH,EAJA,IAAMwD,EAAU6D,WAAW,KACzBC,EAAQ,KACV,EAAG,IAEc,QAAjBtH,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,GAAAA,EAAmBmC,IAAI,CAAC,cAAe,CAAEgF,KAAAA,CAAK,EAAG,IAC/CI,aAAa/D,GACTgE,EAASC,OAAO,EAAID,EAASpF,MAAM,CACrCkF,EAAQE,EAASpF,MAAM,EAEvBkF,EAAQ,KAEZ,EACF,EACF,CAAE,MAAOrD,EAAO,CAGd,OAFAoB,QAAQpB,KAAK,CAAC,2BAA4BA,GAC1C1E,EAAmB,yBACZ,IACT,CACF,EAAG,EAAE,EAGCmI,EAAoB9G,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,UACpC,GAAI,KAEG+G,EAOCA,EAPN,GAAI,SAACA,CAAAA,EAAAA,UAAUC,YAAY,GAAtBD,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAwBE,YAAY,EACvC,MAAM,MAAU,iDAKlB,GAAI,CACF,QAAIF,CAAAA,EAAAA,UAAUG,WAAW,GAArBH,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAuBI,KAAK,GAIXC,CAHJ,MAAML,UAAUG,WAAW,CAACC,KAAK,CAAC,CAC/CZ,KAAM,YACR,IAC0Bc,KAAK,CAEjC,MAAOhE,EAAO,CAEhB,CAGA,IAAMiE,EAAS,MAAMP,UAAUC,YAAY,CAACC,YAAY,CAAC,CACvDM,MAAO,CACLC,iBAAkB,GAClBC,iBAAkB,GAClBC,gBAAiB,GACjBC,WAAY,KACd,EACAC,MAAO,EACT,EAEAtI,CAAAA,EAAeW,OAAO,CAAGqH,EAGzB,IAAMnH,EAAe,GAAK1D,CAAAA,OAAO2D,YAAY,EAAI3D,OAAgB4D,kBAAkB,EAC7EC,EAASH,EAAaI,uBAAuB,CAAC+G,GAC9CO,EAAW1H,EAAa2H,UAAU,GAcxC,OAZAxH,EAAOO,OAAO,CAACgH,GACfA,EAAShH,OAAO,CAACV,EAAa4H,WAAW,EAGzCtI,EAAgBQ,OAAO,CAAGE,EAC1BR,EAAcM,OAAO,CAAGK,EACxBZ,EAAYO,OAAO,CAAG4H,EAGtBA,EAASG,IAAI,CAAC5G,KAAK,CAAG,EACtBjD,EAAW,IAEJ,EAGT,CAAE,MAAOkF,EAAY,CAOnB,OANAoB,QAAQpB,KAAK,CAAC,sBAAuBA,GAKrC1E,EAHqB1B,CAAiB,CAACoG,EAAMkD,IAAI,CAAmC,EAChEtJ,EAAkBQ,YAAY,EAG3C,EACT,CACF,EAAG,EAAE,EAECwK,EAAajI,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,SAgB7BZ,EAfA,GAAI,CAACE,EAAeW,OAAO,EAAI,CAACP,EAAYO,OAAO,CAAE,OAErD,IAAMiI,EAAgB,CAAChK,EACvBC,EAAW+J,GAGXxI,EAAYO,OAAO,CAAC+H,IAAI,CAAC5G,KAAK,CAAG8G,EAAgB,EAAI,EAGrD,IAAMC,EAAa7I,EAAeW,OAAO,CAACC,cAAc,EAAE,CAAC,EAAE,CACzDiI,GACFA,CAAAA,EAAWC,OAAO,CAAG,CAACF,CAAAA,EAIP,OAAjB9I,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,GAAAA,EAAmBmC,IAAI,CAAC,mBAAoB,CAC1CC,OAAQ1D,MAAAA,EAAAA,KAAAA,EAAAA,EAAa2D,EAAE,CACvBvD,QAASgK,CACX,EACF,EAAG,CAAChK,EAASJ,EAAY,EAEnBuK,EAAgBrI,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,SAKhCZ,EAJA,IAAMkJ,EAAkB,CAAClK,EACzBC,EAAaiK,GAGI,OAAjBlJ,CAAAA,EAAAA,EAAUa,OAAO,GAAjBb,KAAAA,IAAAA,GAAAA,EAAmBmC,IAAI,CAAC,sBAAuB,CAC7CC,OAAQ1D,MAAAA,EAAAA,KAAAA,EAAAA,EAAa2D,EAAE,CACvBrD,UAAWkK,CACb,EACF,EAAG,CAAClK,EAAWN,EAAY,EAErByK,EAAcvI,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,IAC9B,GAAI,CAACZ,EAAUa,OAAO,EAAI,CAACnC,EAAa,OAExC,IAAMwF,EAA6B,CACjC7B,GAAI+G,KAAKC,GAAG,GAAGC,QAAQ,GACvBC,QAAAA,EACAC,OAAQ,eACRC,WAAY,MACZC,UAAWN,KAAKC,GAAG,EACrB,EAGAtJ,EAAYwE,GAAQ,IAAIA,EAAML,EAAQ,EAGtClE,EAAUa,OAAO,CAACsB,IAAI,CAAC,oBAAqB,CAC1CC,OAAQ1D,EAAY2D,EAAE,CACtBkH,QAAAA,EACAG,UAAWN,KAAKC,GAAG,EACrB,EACF,EAAG,CAAC3K,EAAY,EAGV8D,EAAa5B,CAAAA,EAAAA,EAAAA,WAAAA,EAAY,KAG7B8B,IAGIxC,EAAeW,OAAO,GACxBX,EAAeW,OAAO,CAACiF,SAAS,GAAGhC,OAAO,CAACiC,IACzCA,EAAM4D,IAAI,EACZ,GACAzJ,EAAeW,OAAO,CAAG,MAIvBR,EAAgBQ,OAAO,GACzBR,EAAgBQ,OAAO,CAAC4B,KAAK,GAC7BpC,EAAgBQ,OAAO,CAAG,MAIxBN,EAAcM,OAAO,GACvBN,EAAcM,OAAO,CAAC2B,UAAU,GAChCjC,EAAcM,OAAO,CAAG,MAE1BP,EAAYO,OAAO,CAAG,KAGtBV,EAAmBU,OAAO,CAACiD,OAAO,CAACC,IACjCA,EAAWtB,KAAK,EAClB,GACAtC,EAAmBU,OAAO,CAACmD,KAAK,GAGhCxD,EAAsBK,OAAO,CAACmD,KAAK,GAG/BhE,EAAUa,OAAO,GACnBb,EAAUa,OAAO,CAAC2B,UAAU,GAC5BxC,EAAUa,OAAO,CAAG,MAItB1B,EAAe,IACfE,EAAgB,IAChBQ,EAAU,gBACVlB,EAAe,MACfE,EAAgB,EAAE,EAClBc,EAAiB,CAAC,GAClBI,EAAY,EAAE,EACdR,EAAmB,MACnBE,EAAwB,GACxBV,EAAW,IACXE,EAAa,IACbyB,EAAiBG,OAAO,CAAG,EAC7B,EAAG,CAAC6B,EAAQ,EAqBZ,MAlBAkH,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACJrG,GAAS,CAAC7C,EAAiBG,OAAO,EACpC8B,IAGK,KACLH,GACF,GACC,CAACe,EAAOZ,EAAkBH,EAAW,EAGxCoH,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACR,GAAI1J,EAAeW,OAAO,EAAInC,GAAeQ,EAE3C,OADgByB,GAGpB,EAAG,CAACjC,EAAaQ,EAAayB,EAAS,EAEhC,CACLpC,MAAAA,EACAG,YAAAA,EACAsI,SAAAA,EACAC,UAAAA,EACAC,WAAAA,EACApI,QAAAA,EACAE,UAAAA,EACAE,YAAAA,EACA2J,WAAAA,EACAI,cAAAA,EACAvB,kBAAAA,EACAmC,YAAa3J,EAAeW,OAAO,CACnCnB,cAAAA,EACAd,aAAAA,EACAkB,SAAAA,EACAqJ,YAAAA,EACA/J,aAAAA,EACAE,gBAAAA,EACAE,qBAAAA,EACAI,OAAAA,EACAkK,cAAepJ,EAAiBG,OAAO,CACvC2B,WAAAA,CACF,CACF,8FCprBe,SAASuH,EAAcC,CAAuC,KAAvC,CAAE5H,OAAAA,CAAM,CAAE6H,QAAAA,CAAO,CAAsB,CAAvCD,EAC9B,CAAEE,KAAAA,CAAI,CAAE,CAAGC,CAAAA,EAAAA,EAAAA,EAAAA,IAGX,CAACvH,EAAQwH,EAAU,CAAG3L,CAAAA,EAAAA,EAAAA,QAAAA,EAAwB,MAG9C,CAAC4L,EAAUC,EAAY,CAAG7L,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IACnC,CAAC8L,EAAkBC,EAAoB,CAAG/L,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IACnD,CAACgM,EAAaC,EAAe,CAAGjM,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IACzC,CAACkM,EAAUC,EAAY,CAAGnM,CAAAA,EAAAA,EAAAA,QAAAA,EAAc,MACxC,CAACoM,EAAWC,EAAa,CAAGrM,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IAGrC,CACJoL,YAAAA,CAAW,CACXnK,cAAAA,CAAa,CACbZ,QAAAA,CAAO,CACPE,UAAAA,CAAS,CACT6J,WAAAA,CAAU,CACVI,cAAAA,CAAa,CACbrJ,OAAAA,CAAM,CACNN,gBAAAA,CAAe,CACfwK,cAAAA,CAAa,CACblL,aAAcmM,CAAkB,CAChCjL,SAAUkL,CAAc,CACxB7B,YAAa8B,CAAiB,CAC9BjE,SAAAA,CAAQ,CACRC,UAAWiE,CAAe,CAC3B,CAAG5M,EAAc6M,aAAaC,OAAO,CAAC,UAAY,IAG7CC,EAAgBpL,CAAAA,EAAAA,EAAAA,MAAAA,EAAyB,MACzCqL,EAAmBrL,CAAAA,EAAAA,EAAAA,MAAAA,EAAuB,MAGhD2J,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACR,GAAIM,GAAQ9H,EAAQ,CAClB,IAAMmJ,EAAO,yBAAmEC,OAAO,CAAC,MAAO,IACzFC,EAAc5I,CAAAA,EAAAA,EAAAA,EAAAA,EAAG0I,EAAM,CAC3BrI,KAAM,aACNC,WAAY,CAAC,UAAU,CACvBE,gBAAiB,GACjBC,KAAM,CACJC,MAAO4H,aAAaC,OAAO,CAAC,UAAYM,KAAAA,CAC1C,CACF,GAKA,OAHAtB,EAAUqB,GACVE,EAAeF,GAER,KACLA,EAAYjJ,UAAU,EACxB,CACF,CACF,EAAG,CAAC0H,EAAM9H,EAAO,EAGjBwH,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACJyB,EAAcxK,OAAO,EAAIgJ,GAC3BwB,CAAAA,EAAcxK,OAAO,CAAC+K,SAAS,CAAG/B,CAAAA,CAEtC,EAAG,CAACA,EAAY,EAGhBD,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACJ0B,EAAiBzK,OAAO,EAC1ByK,CAAAA,EAAiBzK,OAAO,CAACgL,SAAS,CAAGP,EAAiBzK,OAAO,CAACiL,YAAY,CAE9E,EAAG,CAACd,EAAe,EAEnB,IAAMW,EAAiB,MAAOF,IAC5B,GAAI,CACFX,EAAa,IAGb,MAAM9D,EAAS5E,GAGfqJ,EAAY5H,EAAE,CAAC,eAAgB,IAC7B+G,EAAY3F,EAAKZ,IAAI,CACvB,GAGAoH,EAAY5H,EAAE,CAAC,qBAAsB,IACnCkI,EAAAA,EAAKA,CAACtE,OAAO,CAAC,GAAoB3E,MAAA,CAAjB0B,EAAY2C,IAAI,CAAC,oBACpC,GAEAsE,EAAY5H,EAAE,CAAC,mBAAoB,IACjCkI,CAAAA,EAAAA,EAAAA,EAAAA,EAAM,8BACR,GAGAN,EAAY5H,EAAE,CAAC,eAAgB,IAE/B,EAEF,CAAE,MAAOI,EAAO,CACdoB,QAAQpB,KAAK,CAAC,6BAA8BA,GAC5C8H,EAAAA,EAAKA,CAAC9H,KAAK,CAAC,sBACd,QAAU,CACR6G,EAAa,GACf,CACF,EAYMkB,EAAkB,KACtBd,IACAjB,GACF,SAEA,EAEI,GAAAgC,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,qDACb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wBACb,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,2EACf,GAAAH,EAAAC,GAAA,EAACxH,IAAAA,CAAE0H,UAAU,8BAAqB,yBAMtC9M,EAEA,GAAA2M,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,qDACb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wBACb,GAAAH,EAAAI,IAAA,EAAC3H,IAAAA,CAAE0H,UAAU,8BAAoB,wBAAsB9M,KACvD,GAAA2M,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAASP,EACTI,UAAU,yEACX,oBASP,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,+CAEb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,8DACb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,oCACb,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAASP,EACTI,UAAU,2EAEV,GAAAH,EAAAC,GAAA,EAACM,EAAAA,CAAaA,CAAAA,CAACJ,UAAU,cAE3B,GAAAH,EAAAI,IAAA,EAACF,MAAAA,WACC,GAAAF,EAAAC,GAAA,EAACO,KAAAA,CAAGL,UAAU,4CACXzB,CAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAUxD,IAAI,GAAI,QAAerE,MAAA,CAAPV,KAE7B,GAAA6J,EAAAI,IAAA,EAAC3H,IAAAA,CAAE0H,UAAU,kCACVrB,EAAmB9I,MAAM,CAAC,yBAKjC,GAAAgK,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,oCACb,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAAS,IAAM/B,EAAoB,CAACD,GACpC6B,UAAW,kBAEVtJ,MAAA,CADCyH,EAAmB,yBAA2B,6DAGhD,GAAA0B,EAAAC,GAAA,EAACQ,EAAAA,CAASA,CAAAA,CAACN,UAAU,cAEvB,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAAS,IAAMjC,EAAY,CAACD,GAC5B+B,UAAW,kBAEVtJ,MAAA,CADCuH,EAAW,yBAA2B,6DAGxC,GAAA4B,EAAAC,GAAA,EAACS,EAAAA,CAAuBA,CAAAA,CAACP,UAAU,oBAMzC,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wBAEb,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,sBACb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wEAEb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,4DACb,GAAAH,EAAAC,GAAA,EAAC1D,QAAAA,CACCoE,IAAKvB,EACLwB,SAAQ,GACRC,MAAK,GACLC,YAAW,GACXX,UAAU,+BAEZ,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,iGACZlC,MAAAA,EAAAA,KAAAA,EAAAA,EAAM/C,IAAI,CAAC,YAEbrI,GACC,GAAAmN,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,mEACb,GAAAH,EAAAC,GAAA,EAACc,EAAAA,CAAcA,CAAAA,CAACZ,UAAU,iBAM/BrB,EAAmBtG,MAAM,CAACC,GAAKA,EAAErC,EAAE,GAAK6H,CAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAM7H,EAAE,GAAE2C,GAAG,CAAC,GACrD,GAAAiH,EAAAI,IAAA,EAACF,MAAAA,CAAyBC,UAAU,4DAClC,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,0DACb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wBACb,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,4FACb,GAAAH,EAAAC,GAAA,EAACe,OAAAA,CAAKb,UAAU,4CACb5H,EAAY2C,IAAI,CAAC+F,MAAM,CAAC,GAAGC,WAAW,OAG3C,GAAAlB,EAAAC,GAAA,EAACxH,IAAAA,CAAE0H,UAAU,8BAAsB5H,EAAY2C,IAAI,GAClD3C,EAAYlC,UAAU,EACrB,GAAA2J,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,gBACb,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,mEAKtB5H,EAAY1F,OAAO,EAClB,GAAAmN,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,mEACb,GAAAH,EAAAC,GAAA,EAACc,EAAAA,CAAcA,CAAAA,CAACZ,UAAU,gBAlBtB5H,EAAYnC,EAAE,QA2B9B,GAAA4J,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,sDAEZ7B,GACC,GAAA0B,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,yCACb,GAAAH,EAAAC,GAAA,EAACkB,KAAAA,CAAGhB,UAAU,yCAAgC,iBAC9C,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,qBACZrB,EAAmB/F,GAAG,CAAC,GACtB,GAAAiH,EAAAI,IAAA,EAACF,MAAAA,CAAyBC,UAAU,4DAClC,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,6EACb,GAAAH,EAAAC,GAAA,EAACe,OAAAA,CAAKb,UAAU,4CACb5H,EAAY2C,IAAI,CAAC+F,MAAM,CAAC,GAAGC,WAAW,OAG3C,GAAAlB,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,mBACb,GAAAH,EAAAI,IAAA,EAAC3H,IAAAA,CAAE0H,UAAU,+BACV5H,EAAY2C,IAAI,CAChB3C,EAAYnC,EAAE,GAAK6H,CAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAM7H,EAAE,GAAI,YAElC,GAAA4J,EAAAC,GAAA,EAACxH,IAAAA,CAAE0H,UAAU,iCACV5H,EAAYxF,SAAS,CAAG,UAAY,gBAGzC,GAAAiN,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,sBACb,GAAAH,EAAAC,GAAA,EAACc,EAAAA,CAAcA,CAAAA,CAACZ,UAAW,WAAoEtJ,MAAA,CAAzD,EAAahE,OAAO,CAAsB,eAAnB,wBAhBvD0F,EAAYnC,EAAE,QAyB/BgI,GACC,GAAA4B,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wCACb,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,wCACb,GAAAH,EAAAC,GAAA,EAACkB,KAAAA,CAAGhB,UAAU,oCAA2B,WAG3C,GAAAH,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,6BAA6BQ,IAAKtB,WAC/C,GAAAW,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,qBACZpB,EAAehG,GAAG,CAAC,CAACd,EAASmJ,IAC5B,GAAApB,EAAAI,IAAA,EAACF,MAAAA,CAAgBC,UAAU,uCACzB,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,yCACb,GAAAH,EAAAC,GAAA,EAACe,OAAAA,CAAKb,UAAU,+CACblI,EAAQsF,MAAM,GAAKU,CAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAM7H,EAAE,EAAG,MAAQ6B,EAAQuF,UAAU,GAE3D,GAAAwC,EAAAC,GAAA,EAACe,OAAAA,CAAKb,UAAU,iCACb,IAAIhD,KAAKlF,EAAQwF,SAAS,EAAE4D,kBAAkB,QAGnD,GAAArB,EAAAC,GAAA,EAACxH,IAAAA,CAAE0H,UAAU,8BAAsBlI,EAAQqF,OAAO,KAT1C8D,QAehB,GAAApB,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,wCACb,GAAAH,EAAAI,IAAA,EAACkB,OAAAA,CAAKC,SAjMM,IACxBC,EAAEC,cAAc,GACZjD,EAAYkD,IAAI,KAClB1C,EAAkBR,GAClBC,EAAe,IAEnB,EA2LiD0B,UAAU,uBAC3C,GAAAH,EAAAC,GAAA,EAAC0B,QAAAA,CACCC,KAAK,OACL7L,MAAOyI,EACPqD,SAAU,GAAOpD,EAAe+C,EAAEM,MAAM,CAAC/L,KAAK,EAC9CgM,YAAY,oBACZ5B,UAAU,2GAEZ,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCuB,KAAK,SACLzB,UAAU,yEACX,uBAWb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,mEACb,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAAS1D,EACTuD,UAAW,oBAEVtJ,MAAA,CADC,EAAsC,wBAA3B,yBACZ,gDAED,GAAAmJ,EAAAC,GAAA,EAACc,EAAAA,CAAcA,CAAAA,CAACZ,UAAU,cAG5B,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAAStD,EACTmD,UAAW,oBAEVtJ,MAAA,CADC9D,EAAY,yBAA2B,yBACxC,gDAEAA,EACC,GAAAiN,EAAAC,GAAA,EAAC+B,EAAAA,CAAeA,CAAAA,CAAC7B,UAAU,YAE3B,GAAAH,EAAAC,GAAA,EAACgC,EAAAA,CAAgBA,CAAAA,CAAC9B,UAAU,cAIhC,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAASP,EACTI,UAAU,qGACX,oBAMT,CC/We,SAAS+B,IACtB,IAAMC,EAASC,CAAAA,EAAAA,EAAAA,SAAAA,IACT,CAAEjM,OAAAA,CAAM,CAAE,CAAGgM,EAAOrG,KAAK,QAM/B,EAoBE,GAAAkE,EAAAI,IAAA,EAAAJ,EAAAqC,QAAA,YACE,GAAArC,EAAAI,IAAA,EAACkC,IAAIA,WACH,GAAAtC,EAAAI,IAAA,EAACmC,QAAAA,WAAM,qBAAmBpM,KAC1B,GAAA6J,EAAAC,GAAA,EAACuC,OAAAA,CAAKtH,KAAK,cAAcoC,QAAQ,2CAGnC,GAAA0C,EAAAC,GAAA,EAACwC,EAAAA,CAAeA,CAAAA,CAACF,MAAO,oBAA2B1L,MAAA,CAAPV,YAC1C,GAAA6J,EAAAC,GAAA,EAACnC,EAAaA,CAAC3H,OAAQA,EAAQ6H,QA/Bb,KACtBmE,EAAO7Q,IAAI,CAAC,eACd,SAII,GAAA0O,EAAAC,GAAA,EAACwC,EAAAA,CAAeA,CAAAA,CAACF,MAAM,sBACrB,GAAAvC,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAU,yDACb,GAAAH,EAAAI,IAAA,EAACF,MAAAA,CAAIC,UAAU,wBACb,GAAAH,EAAAC,GAAA,EAACO,KAAAA,CAAGL,UAAU,iDAAwC,mBACtD,GAAAH,EAAAC,GAAA,EAACxH,IAAAA,CAAE0H,UAAU,8BAAqB,+CAClC,GAAAH,EAAAC,GAAA,EAACI,SAAAA,CACCC,QAAS,IAAM6B,EAAO7Q,IAAI,CAAC,gBAC3B6O,UAAU,uGACX,wBAqBb","sources":["webpack://_N_E/?9c3e","webpack://_N_E/./src/hooks/useVerbfyTalk.ts","webpack://_N_E/./src/components/voiceChat/VoiceChatRoom.tsx","webpack://_N_E/./pages/verbfy-talk/[roomId].tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/verbfy-talk/[roomId]\",\n      function () {\n        return require(\"private-next-pages/verbfy-talk/[roomId].tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/verbfy-talk/[roomId]\"])\n      });\n    }\n  ","import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\n\r\ninterface VerbfyTalkRoom {\r\n  id: string;\r\n  name: string;\r\n  participants: number;\r\n  maxParticipants: number;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface VerbfyTalkParticipant {\r\n  id: string;\r\n  name: string;\r\n  isSpeaking: boolean;\r\n  isMuted: boolean;\r\n  isSpeaker: boolean;\r\n}\r\n\r\ninterface VerbfyTalkMessage {\r\n  id: string;\r\n  content: string;\r\n  sender: string;\r\n  senderName: string;\r\n  timestamp: number;\r\n}\r\n\r\ninterface UseVerbfyTalkReturn {\r\n  // Room management\r\n  rooms: VerbfyTalkRoom[];\r\n  currentRoom: VerbfyTalkRoom | null;\r\n  joinRoom: (roomId: string) => Promise<boolean>;\r\n  leaveRoom: () => void;\r\n  createRoom: (name: string) => Promise<string | null>;\r\n  \r\n  // Audio controls\r\n  isMuted: boolean;\r\n  isSpeaker: boolean;\r\n  isConnected: boolean;\r\n  toggleMute: () => void;\r\n  toggleSpeaker: () => void;\r\n  requestMicrophone: () => Promise<boolean>;\r\n  \r\n  // Media streams\r\n  localStream: MediaStream | null;\r\n  remoteStreams: { [peerId: string]: MediaStream };\r\n  \r\n  // Participants and messages\r\n  participants: VerbfyTalkParticipant[];\r\n  messages: VerbfyTalkMessage[];\r\n  sendMessage: (content: string) => void;\r\n  \r\n  // Connection status\r\n  isConnecting: boolean;\r\n  connectionError: string | null;\r\n  reconnectionAttempts: number;\r\n  status: 'disconnected' | 'connecting' | 'connected' | 'error';\r\n  isInitialized: boolean;\r\n  \r\n  // Cleanup\r\n  disconnect: () => void;\r\n}\r\n\r\n// WebRTC Configuration\r\nconst WEBRTC_CONFIG: RTCConfiguration = {\r\n  iceServers: [\r\n    { urls: 'stun:stun.l.google.com:19302' },\r\n    { urls: 'stun:stun1.l.google.com:19302' },\r\n    { urls: 'stun:stun2.l.google.com:19302' },\r\n    { urls: 'stun:stun3.l.google.com:19302' },\r\n    { urls: 'stun:stun4.l.google.com:19302' }\r\n  ],\r\n  iceCandidatePoolSize: 10\r\n};\r\n\r\n// Microphone error types\r\nconst MICROPHONE_ERRORS = {\r\n  NotAllowedError: 'Microphone permission denied. Please allow microphone access in your browser settings.',\r\n  NotFoundError: 'No microphone found. Please connect a microphone and try again.',\r\n  NotSupportedError: 'Microphone not supported in this browser.',\r\n  NotReadableError: 'Microphone is already in use by another application.',\r\n  AbortError: 'Microphone access was aborted.',\r\n  SecurityError: 'Microphone access blocked due to security restrictions.',\r\n  InvalidStateError: 'Microphone is in an invalid state.',\r\n  UnknownError: 'Unknown microphone error occurred.'\r\n} as const;\r\n\r\nexport const useVerbfyTalk = (token: string): UseVerbfyTalkReturn => {\r\n  const [rooms, setRooms] = useState<VerbfyTalkRoom[]>([]);\r\n  const [currentRoom, setCurrentRoom] = useState<VerbfyTalkRoom | null>(null);\r\n  const [participants, setParticipants] = useState<VerbfyTalkParticipant[]>([]);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  const [isSpeaker, setIsSpeaker] = useState(false);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const [connectionError, setConnectionError] = useState<string | null>(null);\r\n  const [reconnectionAttempts, setReconnectionAttempts] = useState(0);\r\n  const [remoteStreams, setRemoteStreams] = useState<{ [peerId: string]: MediaStream }>({});\r\n  const [status, setStatus] = useState<'disconnected' | 'connecting' | 'connected' | 'error'>('disconnected');\r\n  const [messages, setMessages] = useState<VerbfyTalkMessage[]>([]);\r\n  \r\n  // Refs\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const localStreamRef = useRef<MediaStream | null>(null);\r\n  const peerConnectionsRef = useRef<Map<string, RTCPeerConnection>>(new Map());\r\n  const audioContextRef = useRef<AudioContext | null>(null);\r\n  const gainNodeRef = useRef<GainNode | null>(null);\r\n  const sourceNodeRef = useRef<MediaStreamAudioSourceNode | null>(null);\r\n  const iceCandidateBufferRef = useRef<Map<string, RTCIceCandidateInit[]>>(new Map());\r\n  const vadIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isInitializedRef = useRef(false);\r\n\r\n  // Voice Activity Detection\r\n  const startVAD = useCallback(() => {\r\n    if (!localStreamRef.current || vadIntervalRef.current) return;\r\n\r\n    const audioTrack = localStreamRef.current.getAudioTracks()[0];\r\n    if (!audioTrack) return;\r\n\r\n    // Simple VAD using audio levels\r\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n    const source = audioContext.createMediaStreamSource(localStreamRef.current);\r\n    const analyser = audioContext.createAnalyser();\r\n    const dataArray = new Uint8Array(analyser.frequencyBinCount);\r\n\r\n    source.connect(analyser);\r\n    analyser.fftSize = 256;\r\n\r\n    vadIntervalRef.current = setInterval(() => {\r\n      analyser.getByteFrequencyData(dataArray);\r\n      const average = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;\r\n      const isSpeaking = average > 30; // Threshold for voice activity\r\n\r\n      // Update local speaking state\r\n      if (socketRef.current?.connected && currentRoom) {\r\n        socketRef.current.emit('participant:speaking', {\r\n          roomId: currentRoom.id,\r\n          isSpeaking\r\n        });\r\n      }\r\n    }, 100);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      if (vadIntervalRef.current) {\r\n        clearInterval(vadIntervalRef.current);\r\n        vadIntervalRef.current = null;\r\n      }\r\n      source.disconnect();\r\n      analyser.disconnect();\r\n      audioContext.close();\r\n    };\r\n  }, [currentRoom]);\r\n\r\n  // Stop VAD\r\n  const stopVAD = useCallback(() => {\r\n    if (vadIntervalRef.current) {\r\n      clearInterval(vadIntervalRef.current);\r\n      vadIntervalRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  // Initialize Socket.IO connection\r\n  const initializeSocket = useCallback(async () => {\r\n    if (!token || isInitializedRef.current || socketRef.current?.connected) return;\r\n    \r\n    try {\r\n      setIsConnecting(true);\r\n      setStatus('connecting');\r\n      setConnectionError(null);\r\n      setReconnectionAttempts(0);\r\n      \r\n      // Cleanup existing socket if any\r\n      if (socketRef.current) {\r\n        socketRef.current.disconnect();\r\n        socketRef.current = null;\r\n      }\r\n      \r\n      const socket = io(`${process.env.NEXT_PUBLIC_BACKEND_URL || 'https://api.verbfy.com'}/verbfy-talk`, {\r\n        path: '/socket.io',\r\n        transports: ['polling', 'websocket'], // Start with polling, upgrade to websocket\r\n        forceNew: true, // Force new connection for VerbfyTalk\r\n        withCredentials: true,\r\n        auth: { token },\r\n        timeout: 20000,\r\n        reconnectionAttempts: 5,\r\n        reconnectionDelay: 1000,\r\n        reconnectionDelayMax: 5000,\r\n        upgrade: true,\r\n        rememberUpgrade: true\r\n      });\r\n      \r\n                   socket.on('connect', () => {\r\n        setIsConnected(true);\r\n        setIsConnecting(false);\r\n        setStatus('connected');\r\n        setConnectionError(null);\r\n        setReconnectionAttempts(0);\r\n        isInitializedRef.current = true;\r\n      });\r\n      \r\n                   socket.on('disconnect', (reason) => {\r\n        setIsConnected(false);\r\n        setStatus('disconnected');\r\n        setCurrentRoom(null);\r\n        setParticipants([]);\r\n        stopVAD();\r\n        \r\n        // Cleanup peer connections on disconnect\r\n        peerConnectionsRef.current.forEach(connection => connection.close());\r\n        peerConnectionsRef.current.clear();\r\n        iceCandidateBufferRef.current.clear();\r\n      });\r\n      \r\n                   socket.on('connect_error', (error) => {\r\n        setStatus('error');\r\n        setConnectionError(`Connection failed: ${error.message}`);\r\n        setIsConnecting(false);\r\n      });\r\n\r\n      socket.on('reconnect_attempt', (attemptNumber) => {\r\n        setStatus('connecting');\r\n        setReconnectionAttempts(attemptNumber);\r\n        setConnectionError(`Reconnecting... (Attempt ${attemptNumber}/5)`);\r\n      });\r\n\r\n      socket.on('reconnect', (attemptNumber) => {\r\n        setStatus('connected');\r\n        setConnectionError(null);\r\n        setReconnectionAttempts(0);\r\n      });\r\n\r\n      socket.on('reconnect_failed', () => {\r\n        setStatus('error');\r\n        setConnectionError('Failed to reconnect. Please refresh the page.');\r\n        setIsConnecting(false);\r\n      });\r\n      \r\n      // Room events\r\n      socket.on('rooms:list', (roomsList: VerbfyTalkRoom[]) => {\r\n        setRooms(roomsList);\r\n      });\r\n      \r\n      socket.on('room:joined', (room: VerbfyTalkRoom) => {\r\n        setCurrentRoom(room);\r\n      });\r\n      \r\n      socket.on('room:left', () => {\r\n        setCurrentRoom(null);\r\n        setParticipants([]);\r\n        stopVAD();\r\n      });\r\n      \r\n      // Participant events with proper state management\r\n      socket.on('participants:update', (participantsList: VerbfyTalkParticipant[]) => {\r\n        setParticipants(participantsList);\r\n      });\r\n      \r\n      socket.on('participant:joined', (participant: VerbfyTalkParticipant) => {\r\n        setParticipants(prev => [...prev, participant]);\r\n      });\r\n      \r\n      socket.on('participant:left', (participantId: string) => {\r\n        setParticipants(prev => prev.filter(p => p.id !== participantId));\r\n        \r\n        // Cleanup peer connection for this participant\r\n        const peerConnection = peerConnectionsRef.current.get(participantId);\r\n        if (peerConnection) {\r\n          peerConnection.close();\r\n          peerConnectionsRef.current.delete(participantId);\r\n        }\r\n        \r\n        // Clear ICE candidate buffer for this participant\r\n        iceCandidateBufferRef.current.delete(participantId);\r\n        \r\n        // Remove remote stream for this participant\r\n        setRemoteStreams(prev => {\r\n          const newStreams = { ...prev };\r\n          delete newStreams[participantId];\r\n          return newStreams;\r\n        });\r\n      });\r\n\r\n      socket.on('participant:mute', (data: { participantId: string; isMuted: boolean }) => {\r\n        setParticipants(prev => \r\n          prev.map(p => \r\n            p.id === data.participantId \r\n              ? { ...p, isMuted: data.isMuted }\r\n              : p\r\n          )\r\n        );\r\n      });\r\n\r\n      socket.on('participant:speaking', (data: { participantId: string; isSpeaking: boolean }) => {\r\n        setParticipants(prev => \r\n          prev.map(p => \r\n            p.id === data.participantId \r\n              ? { ...p, isSpeaking: data.isSpeaking }\r\n              : p\r\n          )\r\n        );\r\n      });\r\n      \r\n      // WebRTC signaling with error handling\r\n      socket.on('webrtc:offer', async (data: { from: string; offer: RTCSessionDescriptionInit }) => {\r\n        try {\r\n          await handleWebRTCOffer(data.from, data.offer);\r\n        } catch (error) {\r\n          console.error('❌ WebRTC offer handling failed:', error);\r\n          setConnectionError('Failed to establish voice connection');\r\n        }\r\n      });\r\n      \r\n      socket.on('webrtc:answer', async (data: { from: string; answer: RTCSessionDescriptionInit }) => {\r\n        try {\r\n          await handleWebRTCAnswer(data.from, data.answer);\r\n        } catch (error) {\r\n          console.error('❌ WebRTC answer handling failed:', error);\r\n          setConnectionError('Failed to complete voice connection');\r\n        }\r\n      });\r\n      \r\n      socket.on('webrtc:ice-candidate', async (data: { from: string; candidate: RTCIceCandidateInit }) => {\r\n        try {\r\n          await handleICECandidate(data.from, data.candidate);\r\n        } catch (error) {\r\n          console.error('❌ ICE candidate handling failed:', error);\r\n          // Buffer the candidate for later if connection not ready\r\n          const buffer = iceCandidateBufferRef.current.get(data.from) || [];\r\n          buffer.push(data.candidate);\r\n          iceCandidateBufferRef.current.set(data.from, buffer);\r\n        }\r\n      });\r\n      \r\n      socketRef.current = socket;\r\n      \r\n      // Request rooms list\r\n      socket.emit('rooms:get');\r\n      \r\n    } catch (error) {\r\n      console.error('❌ Failed to initialize VerbfyTalk:', error);\r\n      setConnectionError(error instanceof Error ? error.message : 'Unknown error');\r\n      setIsConnecting(false);\r\n    }\r\n  }, [token, stopVAD]);\r\n  \r\n  // WebRTC handlers with improved error handling\r\n  const handleWebRTCOffer = async (from: string, offer: RTCSessionDescriptionInit) => {\r\n    try {\r\n      const peerConnection = new RTCPeerConnection(WEBRTC_CONFIG);\r\n      \r\n      peerConnectionsRef.current.set(from, peerConnection);\r\n      \r\n      // Add local stream if available\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach(track => {\r\n          peerConnection.addTrack(track, localStreamRef.current!);\r\n        });\r\n      }\r\n      \r\n      // Handle ICE candidates\r\n      peerConnection.onicecandidate = (event) => {\r\n        if (event.candidate && socketRef.current?.connected) {\r\n          socketRef.current.emit('webrtc:ice-candidate', {\r\n            to: from,\r\n            candidate: event.candidate\r\n          });\r\n        }\r\n      };\r\n\r\n      peerConnection.onconnectionstatechange = () => {\r\n        if (peerConnection.connectionState === 'failed') {\r\n          peerConnection.close();\r\n          peerConnectionsRef.current.delete(from);\r\n        }\r\n      };\r\n\r\n      peerConnection.oniceconnectionstatechange = () => {\r\n        // ICE connection state changed\r\n      };\r\n\r\n      // Handle incoming remote streams\r\n      peerConnection.ontrack = (event) => {\r\n        setRemoteStreams(prev => ({\r\n          ...prev,\r\n          [from]: event.streams[0]\r\n        }));\r\n      };\r\n      \r\n      await peerConnection.setRemoteDescription(offer);\r\n      const answer = await peerConnection.createAnswer();\r\n      await peerConnection.setLocalDescription(answer);\r\n      \r\n      socketRef.current?.emit('webrtc:answer', { to: from, answer });\r\n      \r\n      // Process buffered ICE candidates\r\n      const bufferedCandidates = iceCandidateBufferRef.current.get(from) || [];\r\n      for (const candidate of bufferedCandidates) {\r\n        try {\r\n          await peerConnection.addIceCandidate(candidate);\r\n        } catch (error) {\r\n          console.warn('Failed to add buffered ICE candidate:', error);\r\n        }\r\n      }\r\n      iceCandidateBufferRef.current.delete(from);\r\n      \r\n    } catch (error) {\r\n      console.error('❌ WebRTC offer handling failed:', error);\r\n      throw error;\r\n    }\r\n  };\r\n  \r\n  const handleWebRTCAnswer = async (from: string, answer: RTCSessionDescriptionInit) => {\r\n    try {\r\n      const peerConnection = peerConnectionsRef.current.get(from);\r\n      if (peerConnection && peerConnection.signalingState !== 'closed') {\r\n        await peerConnection.setRemoteDescription(answer);\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ WebRTC answer handling failed:', error);\r\n      throw error;\r\n    }\r\n  };\r\n  \r\n  const handleICECandidate = async (from: string, candidate: RTCIceCandidateInit) => {\r\n    try {\r\n      const peerConnection = peerConnectionsRef.current.get(from);\r\n      if (peerConnection && peerConnection.remoteDescription) {\r\n        await peerConnection.addIceCandidate(candidate);\r\n      } else {\r\n        // Buffer candidate if connection not ready\r\n        const buffer = iceCandidateBufferRef.current.get(from) || [];\r\n        buffer.push(candidate);\r\n        iceCandidateBufferRef.current.set(from, buffer);\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ ICE candidate handling failed:', error);\r\n      throw error;\r\n    }\r\n  };\r\n  \r\n  // Room management\r\n  const joinRoom = useCallback(async (roomId: string): Promise<boolean> => {\r\n    if (!socketRef.current?.connected) {\r\n      setConnectionError('Not connected to server');\r\n      return false;\r\n    }\r\n    \r\n    try {\r\n      socketRef.current.emit('room:join', { roomId });\r\n      return true;\r\n    } catch (error) {\r\n      console.error('❌ Failed to join room:', error);\r\n      setConnectionError('Failed to join room');\r\n      return false;\r\n    }\r\n  }, []);\r\n  \r\n  const leaveRoom = useCallback(() => {\r\n    if (!socketRef.current?.connected || !currentRoom) return;\r\n    \r\n    socketRef.current.emit('room:leave', { roomId: currentRoom.id });\r\n    stopVAD();\r\n  }, [currentRoom, stopVAD]);\r\n  \r\n  const createRoom = useCallback(async (name: string): Promise<string | null> => {\r\n    if (!socketRef.current?.connected) {\r\n      setConnectionError('Not connected to server');\r\n      return null;\r\n    }\r\n    \r\n    try {\r\n      return new Promise((resolve) => {\r\n        const timeout = setTimeout(() => {\r\n          resolve(null);\r\n        }, 10000); // 10 second timeout\r\n        \r\n        socketRef.current?.emit('room:create', { name }, (response: { success: boolean; roomId?: string }) => {\r\n          clearTimeout(timeout);\r\n          if (response.success && response.roomId) {\r\n            resolve(response.roomId);\r\n          } else {\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n    } catch (error) {\r\n      console.error('❌ Failed to create room:', error);\r\n      setConnectionError('Failed to create room');\r\n      return null;\r\n    }\r\n  }, []);\r\n  \r\n  // Audio controls with unified mute logic\r\n  const requestMicrophone = useCallback(async (): Promise<boolean> => {\r\n    try {\r\n      // Check if getUserMedia is supported\r\n      if (!navigator.mediaDevices?.getUserMedia) {\r\n        throw new Error('getUserMedia is not supported in this browser');\r\n      }\r\n\r\n      // Check permission status first\r\n      let permissionStatus = 'unknown';\r\n      try {\r\n        if (navigator.permissions?.query) {\r\n          const result = await navigator.permissions.query({ \r\n            name: 'microphone' as PermissionName \r\n          });\r\n          permissionStatus = result.state;\r\n        }\r\n      } catch (error) {\r\n        // Could not check permission status, proceeding with getUserMedia\r\n      }\r\n\r\n      // Request microphone access\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        audio: {\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true,\r\n          sampleRate: 44100\r\n        }, \r\n        video: false \r\n      });\r\n      \r\n      localStreamRef.current = stream;\r\n      \r\n      // Set up audio context for volume control\r\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      const source = audioContext.createMediaStreamSource(stream);\r\n      const gainNode = audioContext.createGain();\r\n      \r\n      source.connect(gainNode);\r\n      gainNode.connect(audioContext.destination);\r\n      \r\n      // Store references\r\n      audioContextRef.current = audioContext;\r\n      sourceNodeRef.current = source;\r\n      gainNodeRef.current = gainNode;\r\n      \r\n      // Mute initially using gain node\r\n      gainNode.gain.value = 0;\r\n      setIsMuted(true);\r\n      \r\n      return true;\r\n      \r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    } catch (error: any) {\r\n      console.error('❌ Microphone error:', error);\r\n      \r\n      const errorMessage = MICROPHONE_ERRORS[error.name as keyof typeof MICROPHONE_ERRORS] || \r\n                          MICROPHONE_ERRORS.UnknownError;\r\n      \r\n      setConnectionError(errorMessage);\r\n      return false;\r\n    }\r\n  }, []);\r\n  \r\n  const toggleMute = useCallback(() => {\r\n    if (!localStreamRef.current || !gainNodeRef.current) return;\r\n\r\n    const newMutedState = !isMuted;\r\n    setIsMuted(newMutedState);\r\n    \r\n    // Use gain node for mute/unmute (more reliable than track.enabled)\r\n    gainNodeRef.current.gain.value = newMutedState ? 0 : 1;\r\n    \r\n    // Also update track enabled state for WebRTC\r\n    const audioTrack = localStreamRef.current.getAudioTracks()[0];\r\n    if (audioTrack) {\r\n      audioTrack.enabled = !newMutedState;\r\n    }\r\n    \r\n    // Notify other participants\r\n    socketRef.current?.emit('participant:mute', { \r\n      roomId: currentRoom?.id, \r\n      isMuted: newMutedState \r\n    });\r\n  }, [isMuted, currentRoom]);\r\n  \r\n  const toggleSpeaker = useCallback(() => {\r\n    const newSpeakerState = !isSpeaker;\r\n    setIsSpeaker(newSpeakerState);\r\n    \r\n    // Notify other participants\r\n    socketRef.current?.emit('participant:speaker', { \r\n      roomId: currentRoom?.id, \r\n      isSpeaker: newSpeakerState \r\n    });\r\n  }, [isSpeaker, currentRoom]);\r\n  \r\n  const sendMessage = useCallback((content: string) => {\r\n    if (!socketRef.current || !currentRoom) return;\r\n    \r\n    const message: VerbfyTalkMessage = {\r\n      id: Date.now().toString(),\r\n      content,\r\n      sender: 'current-user', // This should be replaced with actual user ID\r\n      senderName: 'You', // This should be replaced with actual user name\r\n      timestamp: Date.now()\r\n    };\r\n    \r\n    // Add message to local state\r\n    setMessages(prev => [...prev, message]);\r\n    \r\n    // Send via socket\r\n    socketRef.current.emit('send-room-message', {\r\n      roomId: currentRoom.id,\r\n      content,\r\n      timestamp: Date.now()\r\n    });\r\n  }, [currentRoom]);\r\n  \r\n  // Comprehensive cleanup\r\n  const disconnect = useCallback(() => {\r\n    \r\n    // Stop VAD\r\n    stopVAD();\r\n    \r\n    // Stop local stream\r\n    if (localStreamRef.current) {\r\n      localStreamRef.current.getTracks().forEach(track => {\r\n        track.stop();\r\n      });\r\n      localStreamRef.current = null;\r\n    }\r\n    \r\n    // Close audio context\r\n    if (audioContextRef.current) {\r\n      audioContextRef.current.close();\r\n      audioContextRef.current = null;\r\n    }\r\n    \r\n    // Disconnect audio nodes\r\n    if (sourceNodeRef.current) {\r\n      sourceNodeRef.current.disconnect();\r\n      sourceNodeRef.current = null;\r\n    }\r\n    gainNodeRef.current = null;\r\n    \r\n    // Close peer connections\r\n    peerConnectionsRef.current.forEach(connection => {\r\n      connection.close();\r\n    });\r\n    peerConnectionsRef.current.clear();\r\n    \r\n    // Clear ICE candidate buffers\r\n    iceCandidateBufferRef.current.clear();\r\n    \r\n    // Disconnect socket\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n      socketRef.current = null;\r\n    }\r\n    \r\n             // Reset state\r\n    setIsConnected(false);\r\n    setIsConnecting(false);\r\n    setStatus('disconnected');\r\n    setCurrentRoom(null);\r\n    setParticipants([]);\r\n    setRemoteStreams({});\r\n    setMessages([]);\r\n    setConnectionError(null);\r\n    setReconnectionAttempts(0);\r\n    setIsMuted(false);\r\n    setIsSpeaker(false);\r\n    isInitializedRef.current = false;\r\n  }, [stopVAD]);\r\n  \r\n  // Initialize on mount\r\n  useEffect(() => {\r\n    if (token && !isInitializedRef.current) {\r\n      initializeSocket();\r\n    }\r\n    \r\n    return () => {\r\n      disconnect();\r\n    };\r\n  }, [token, initializeSocket, disconnect]);\r\n  \r\n  // Start VAD when microphone is available and in room\r\n  useEffect(() => {\r\n    if (localStreamRef.current && currentRoom && isConnected) {\r\n      const cleanup = startVAD();\r\n      return cleanup;\r\n    }\r\n  }, [currentRoom, isConnected, startVAD]);\r\n  \r\n  return {\r\n    rooms,\r\n    currentRoom,\r\n    joinRoom,\r\n    leaveRoom,\r\n    createRoom,\r\n    isMuted,\r\n    isSpeaker,\r\n    isConnected,\r\n    toggleMute,\r\n    toggleSpeaker,\r\n    requestMicrophone,\r\n    localStream: localStreamRef.current,\r\n    remoteStreams,\r\n    participants,\r\n    messages,\r\n    sendMessage,\r\n    isConnecting,\r\n    connectionError,\r\n    reconnectionAttempts,\r\n    status,\r\n    isInitialized: isInitializedRef.current,\r\n    disconnect\r\n  };\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { useVerbfyTalk } from '@/hooks/useVerbfyTalk';\r\nimport { useAuthContext } from '@/context/AuthContext';\r\nimport { toast } from 'react-hot-toast';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport {\r\n  MicrophoneIcon,\r\n  SpeakerWaveIcon,\r\n  SpeakerXMarkIcon,\r\n  ChatBubbleLeftRightIcon,\r\n  UsersIcon,\r\n  ArrowLeftIcon\r\n} from '@heroicons/react/24/outline';\r\n\r\ninterface VoiceChatRoomProps {\r\n  roomId: string;\r\n  onLeave: () => void;\r\n}\r\n\r\n\r\n\r\nexport default function VoiceChatRoom({ roomId, onLeave }: VoiceChatRoomProps) {\r\n  const { user } = useAuthContext();\r\n  \r\n  // Voice chat socket\r\n  const [socket, setSocket] = useState<Socket | null>(null);\r\n  \r\n  // Room state\r\n  const [showChat, setShowChat] = useState(true);\r\n  const [showParticipants, setShowParticipants] = useState(false);\r\n  const [chatMessage, setChatMessage] = useState('');\r\n  const [roomInfo, setRoomInfo] = useState<any>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // VerbfyTalk setup\r\n  const {\r\n    localStream,\r\n    remoteStreams,\r\n    isMuted,\r\n    isSpeaker,\r\n    toggleMute,\r\n    toggleSpeaker,\r\n    status,\r\n    connectionError,\r\n    isInitialized,\r\n    participants: verbfyParticipants,\r\n    messages: verbfyMessages,\r\n    sendMessage: sendVerbfyMessage,\r\n    joinRoom,\r\n    leaveRoom: leaveVerbfyRoom,\r\n  } = useVerbfyTalk(localStorage.getItem('token') || '');\r\n\r\n  // Refs\r\n  const localVideoRef = useRef<HTMLVideoElement>(null);\r\n  const chatContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Initialize socket and room\r\n  useEffect(() => {\r\n    if (user && roomId) {\r\n      const base = (process.env.NEXT_PUBLIC_API_BASE_URL || 'https://api.verbfy.com').replace(/\\/$/, '');\r\n      const voiceSocket = io(base, {\r\n        path: '/socket.io',\r\n        transports: ['polling'],\r\n        withCredentials: true,\r\n        auth: {\r\n          token: localStorage.getItem('token') || undefined\r\n        }\r\n      });\r\n      \r\n      setSocket(voiceSocket);\r\n      initializeRoom(voiceSocket);\r\n      \r\n      return () => {\r\n        voiceSocket.disconnect();\r\n      };\r\n    }\r\n  }, [user, roomId]);\r\n\r\n  // Update local video stream\r\n  useEffect(() => {\r\n    if (localVideoRef.current && localStream) {\r\n      localVideoRef.current.srcObject = localStream;\r\n    }\r\n  }, [localStream]);\r\n\r\n  // Auto-scroll chat\r\n  useEffect(() => {\r\n    if (chatContainerRef.current) {\r\n      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\r\n    }\r\n  }, [verbfyMessages]);\r\n\r\n  const initializeRoom = async (voiceSocket: Socket) => {\r\n    try {\r\n      setIsLoading(true);\r\n      \r\n      // Join room via VerbfyTalk\r\n      await joinRoom(roomId);\r\n        \r\n      // Listen for room updates\r\n      voiceSocket.on('room-updated', (data) => {\r\n        setRoomInfo(data.room);\r\n      });\r\n\r\n      // Listen for participant updates\r\n      voiceSocket.on('participant-joined', (participant) => {\r\n        toast.success(`${participant.name} joined the room`);\r\n      });\r\n\r\n      voiceSocket.on('participant-left', (participantId) => {\r\n        toast('A participant left the room');\r\n      });\r\n\r\n      // Listen for room messages\r\n      voiceSocket.on('room-message', (message) => {\r\n        // Messages are handled by useVerbfyTalk hook\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Failed to initialize room:', error);\r\n      toast.error('Failed to join room');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (chatMessage.trim()) {\r\n      sendVerbfyMessage(chatMessage);\r\n      setChatMessage('');\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleLeaveRoom = () => {\r\n    leaveVerbfyRoom();\r\n    onLeave();\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Joining room...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (connectionError) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-red-500 mb-4\">Failed to join room: {connectionError}</p>\r\n          <button\r\n            onClick={handleLeaveRoom}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg\"\r\n          >\r\n            Leave Room\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen flex flex-col bg-gray-900\">\r\n      {/* Header */}\r\n      <div className=\"bg-gray-800 p-4 flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <button\r\n            onClick={handleLeaveRoom}\r\n            className=\"text-gray-300 hover:text-white p-2 rounded-lg hover:bg-gray-700\"\r\n          >\r\n            <ArrowLeftIcon className=\"w-6 h-6\" />\r\n          </button>\r\n          <div>\r\n            <h1 className=\"text-white font-semibold text-lg\">\r\n              {roomInfo?.name || `Room ${roomId}`}\r\n            </h1>\r\n            <p className=\"text-gray-400 text-sm\">\r\n              {verbfyParticipants.length} participants\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-2\">\r\n          <button\r\n            onClick={() => setShowParticipants(!showParticipants)}\r\n            className={`p-2 rounded-lg ${\r\n              showParticipants ? 'bg-blue-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n            }`}\r\n          >\r\n            <UsersIcon className=\"w-5 h-5\" />\r\n          </button>\r\n          <button\r\n            onClick={() => setShowChat(!showChat)}\r\n            className={`p-2 rounded-lg ${\r\n              showChat ? 'bg-blue-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n            }`}\r\n          >\r\n            <ChatBubbleLeftRightIcon className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"flex-1 flex\">\r\n        {/* Video Grid */}\r\n        <div className=\"flex-1 p-4\">\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 h-full\">\r\n            {/* Local Video */}\r\n            <div className=\"relative bg-gray-800 rounded-lg overflow-hidden\">\r\n              <video\r\n                ref={localVideoRef}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n              <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded\">\r\n                {user?.name} (You)\r\n              </div>\r\n              {isMuted && (\r\n                <div className=\"absolute top-2 left-2 bg-red-500 text-white p-1 rounded\">\r\n                  <MicrophoneIcon className=\"w-4 h-4\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Remote Videos */}\r\n            {verbfyParticipants.filter(p => p.id !== user?.id).map((participant) => (\r\n              <div key={participant.id} className=\"relative bg-gray-800 rounded-lg overflow-hidden\">\r\n                <div className=\"w-full h-full flex items-center justify-center\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"w-16 h-16 bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-2\">\r\n                      <span className=\"text-white text-lg font-semibold\">\r\n                        {participant.name.charAt(0).toUpperCase()}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-white text-sm\">{participant.name}</p>\r\n                    {participant.isSpeaking && (\r\n                      <div className=\"mt-1\">\r\n                        <div className=\"w-2 h-2 bg-green-500 rounded-full mx-auto animate-pulse\"></div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {participant.isMuted && (\r\n                  <div className=\"absolute top-2 left-2 bg-red-500 text-white p-1 rounded\">\r\n                    <MicrophoneIcon className=\"w-4 h-4\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Sidebar */}\r\n        <div className=\"w-80 bg-gray-800 border-l border-gray-700\">\r\n          {/* Participants */}\r\n          {showParticipants && (\r\n            <div className=\"p-4 border-b border-gray-700\">\r\n              <h3 className=\"text-white font-semibold mb-3\">Participants</h3>\r\n              <div className=\"space-y-2\">\r\n                {verbfyParticipants.map((participant) => (\r\n                  <div key={participant.id} className=\"flex items-center gap-3 p-2 rounded bg-gray-700\">\r\n                    <div className=\"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center\">\r\n                      <span className=\"text-white text-sm font-semibold\">\r\n                        {participant.name.charAt(0).toUpperCase()}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-white text-sm\">\r\n                        {participant.name}\r\n                        {participant.id === user?.id && ' (You)'}\r\n                      </p>\r\n                      <p className=\"text-gray-400 text-xs\">\r\n                        {participant.isSpeaker ? 'Speaker' : 'Listener'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"flex gap-1\">\r\n                      <MicrophoneIcon className={`w-4 h-4 ${!participant.isMuted ? 'text-green-500' : 'text-red-500'}`} />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Chat */}\r\n          {showChat && (\r\n            <div className=\"flex-1 flex flex-col h-full\">\r\n              <div className=\"p-4 border-b border-gray-700\">\r\n                <h3 className=\"text-white font-semibold\">Chat</h3>\r\n              </div>\r\n              \r\n              <div className=\"flex-1 overflow-y-auto p-4\" ref={chatContainerRef}>\r\n                <div className=\"space-y-3\">\r\n                  {verbfyMessages.map((message, index) => (\r\n                    <div key={index} className=\"bg-gray-700 rounded-lg p-3\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <span className=\"text-blue-400 text-sm font-semibold\">\r\n                          {message.sender === user?.id ? 'You' : message.senderName}\r\n                        </span>\r\n                        <span className=\"text-gray-400 text-xs\">\r\n                          {new Date(message.timestamp).toLocaleTimeString()}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-white text-sm\">{message.content}</p>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-4 border-t border-gray-700\">\r\n                <form onSubmit={handleSendMessage} className=\"flex gap-2\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={chatMessage}\r\n                    onChange={(e) => setChatMessage(e.target.value)}\r\n                    placeholder=\"Type a message...\"\r\n                    className=\"flex-1 bg-gray-700 text-white px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  />\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg\"\r\n                  >\r\n                    Send\r\n                  </button>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Controls */}\r\n      <div className=\"bg-gray-800 p-4 flex items-center justify-center gap-4\">\r\n        <button\r\n          onClick={toggleMute}\r\n          className={`p-3 rounded-full ${\r\n            !isMuted ? 'bg-gray-600 text-white' : 'bg-red-500 text-white'\r\n          } hover:opacity-80 transition-colors`}\r\n        >\r\n          <MicrophoneIcon className=\"w-6 h-6\" />\r\n        </button>\r\n\r\n        <button\r\n          onClick={toggleSpeaker}\r\n          className={`p-3 rounded-full ${\r\n            isSpeaker ? 'bg-blue-600 text-white' : 'bg-gray-600 text-white'\r\n          } hover:opacity-80 transition-colors`}\r\n        >\r\n          {isSpeaker ? (\r\n            <SpeakerWaveIcon className=\"w-6 h-6\" />\r\n          ) : (\r\n            <SpeakerXMarkIcon className=\"w-6 h-6\" />\r\n          )}\r\n        </button>\r\n\r\n        <button\r\n          onClick={handleLeaveRoom}\r\n          className=\"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors\"\r\n        >\r\n          Leave Room\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport Head from 'next/head';\r\nimport DashboardLayout from '@/components/layout/DashboardLayout';\r\nimport VoiceChatRoom from '@/components/voiceChat/VoiceChatRoom';\r\n\r\nexport default function VerbfyTalkRoom() {\r\n  const router = useRouter();\r\n  const { roomId } = router.query as { roomId?: string };\r\n\r\n  const handleLeaveRoom = () => {\r\n    router.push('/verbfy-talk');\r\n  };\r\n\r\n  if (!roomId) {\r\n    return (\r\n      <DashboardLayout title=\"VerbfyTalk\">\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"text-center\">\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Room Not Found</h1>\r\n            <p className=\"text-gray-600 mb-6\">The room you're looking for doesn't exist.</p>\r\n            <button\r\n              onClick={() => router.push('/verbfy-talk')}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors\"\r\n            >\r\n              Back to Rooms\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>VerbfyTalk Room - {roomId}</title>\r\n        <meta name=\"description\" content=\"Join the conversation in VerbfyTalk\" />\r\n      </Head>\r\n      \r\n      <DashboardLayout title={`VerbfyTalk Room: ${roomId}`}>\r\n        <VoiceChatRoom roomId={roomId} onLeave={handleLeaveRoom} />\r\n      </DashboardLayout>\r\n    </>\r\n  );\r\n}"],"names":["window","__NEXT_P","push","__webpack_require__","WEBRTC_CONFIG","iceServers","urls","iceCandidatePoolSize","MICROPHONE_ERRORS","NotAllowedError","NotFoundError","NotSupportedError","NotReadableError","AbortError","SecurityError","InvalidStateError","UnknownError","useVerbfyTalk","rooms","setRooms","useState","currentRoom","setCurrentRoom","participants","setParticipants","isMuted","setIsMuted","isSpeaker","setIsSpeaker","isConnected","setIsConnected","isConnecting","setIsConnecting","connectionError","setConnectionError","reconnectionAttempts","setReconnectionAttempts","remoteStreams","setRemoteStreams","status","setStatus","messages","setMessages","socketRef","useRef","localStreamRef","peerConnectionsRef","Map","audioContextRef","gainNodeRef","sourceNodeRef","iceCandidateBufferRef","vadIntervalRef","isInitializedRef","startVAD","useCallback","current","getAudioTracks","audioContext","AudioContext","webkitAudioContext","source","createMediaStreamSource","analyser","createAnalyser","dataArray","Uint8Array","frequencyBinCount","connect","fftSize","setInterval","getByteFrequencyData","average","reduce","sum","value","length","connected","emit","roomId","id","isSpeaking","clearInterval","disconnect","close","stopVAD","initializeSocket","socket","io","concat","process","env","NEXT_PUBLIC_BACKEND_URL","path","transports","forceNew","withCredentials","auth","token","timeout","reconnectionDelay","reconnectionDelayMax","upgrade","rememberUpgrade","on","forEach","connection","clear","error","message","attemptNumber","roomsList","room","participantsList","prev","participant","filter","p","participantId","peerConnection","get","delete","newStreams","map","data","handleWebRTCOffer","from","offer","console","handleWebRTCAnswer","answer","handleICECandidate","candidate","buffer","set","Error","RTCPeerConnection","getTracks","track","addTrack","onicecandidate","event","to","onconnectionstatechange","connectionState","oniceconnectionstatechange","ontrack","streams","setRemoteDescription","createAnswer","setLocalDescription","addIceCandidate","warn","signalingState","remoteDescription","joinRoom","leaveRoom","createRoom","name","Promise","setTimeout","resolve","clearTimeout","response","success","requestMicrophone","navigator","mediaDevices","getUserMedia","permissions","query","result","state","stream","audio","echoCancellation","noiseSuppression","autoGainControl","sampleRate","video","gainNode","createGain","destination","gain","toggleMute","newMutedState","audioTrack","enabled","toggleSpeaker","newSpeakerState","sendMessage","Date","now","toString","content","sender","senderName","timestamp","stop","useEffect","localStream","isInitialized","VoiceChatRoom","param","onLeave","user","useAuthContext","setSocket","showChat","setShowChat","showParticipants","setShowParticipants","chatMessage","setChatMessage","roomInfo","setRoomInfo","isLoading","setIsLoading","verbfyParticipants","verbfyMessages","sendVerbfyMessage","leaveVerbfyRoom","localStorage","getItem","localVideoRef","chatContainerRef","base","replace","voiceSocket","undefined","initializeRoom","srcObject","scrollTop","scrollHeight","toast","handleLeaveRoom","jsx_runtime","jsx","div","className","jsxs","button","onClick","ArrowLeftIcon","h1","UsersIcon","ChatBubbleLeftRightIcon","ref","autoPlay","muted","playsInline","MicrophoneIcon","span","charAt","toUpperCase","h3","index","toLocaleTimeString","form","onSubmit","e","preventDefault","trim","input","type","onChange","target","placeholder","SpeakerWaveIcon","SpeakerXMarkIcon","VerbfyTalkRoom","router","useRouter","Fragment","Head","title","meta","DashboardLayout"],"sourceRoot":""}