(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8939],{4333:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verbfy-talk/[roomId]",function(){return n(74501)}])},74501:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var s=n(85893),o=n(67294),r=n(11163),c=n(9008),i=n.n(c),a=n(11088),l=n(36197),d=n(67642),u=n(83454);function m(){let e=(0,r.useRouter)(),{roomId:t}=e.query,{user:n}=(0,l.Eu)(),[c,m]=(0,o.useState)(null),[x,h]=(0,o.useState)({}),[g,p]=(0,o.useState)(!0),[b,f]=(0,o.useState)(!0),[j,y]=(0,o.useState)(null),[v,N]=(0,o.useState)(null),[w,D]=(0,o.useState)(null),k=(0,o.useRef)({}),C=(0,o.useRef)({}),R=(0,o.useRef)(null),A={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"}]};(0,o.useEffect)(()=>{(()=>{if(!w){let e=new(window.AudioContext||window.webkitAudioContext);D(e);let t=()=>{"suspended"===e.state&&e.resume()};document.addEventListener("click",t,{once:!0}),document.addEventListener("touchstart",t,{once:!0})}})()},[w]);let E=async()=>{try{if(console.log("\uD83C\uDFA4 Requesting microphone..."),!window.isSecureContext)throw Error("Microphone access requires HTTPS");if(navigator.permissions)try{let e=await navigator.permissions.query({name:"microphone"});if(console.log("\uD83D\uDD0D Microphone permission status:",e.state),"denied"===e.state)throw Error("Microphone permission permanently denied")}catch(e){console.log("⚠️ Could not check permission status, proceeding with getUserMedia")}let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100,channelCount:1}});return console.log("✅ Microphone access granted"),m(e),R.current=e,e}catch(t){console.error("❌ Mic error:",t);let e="Microphone access denied";return"NotAllowedError"===t.name?e="Microphone permission denied. Please allow microphone access and try again.":"NotFoundError"===t.name?e="No microphone found. Please connect a microphone and try again.":"NotSupportedError"===t.name?e="Microphone access not supported in this browser.":"NotReadableError"===t.name?e="Microphone is already in use by another application.":t.message.includes("secure context")?e="Microphone access requires HTTPS. Please use https://verbfy.com instead of http.":t.message.includes("permanently denied")?e="Microphone access permanently blocked. Please enable it in browser settings.":t.message.includes("permissions policy")&&(e="Permissions policy violation. Please try the User Interaction button or check browser settings."),y(e),null}},M=(e,t,n)=>{let s=new RTCPeerConnection(A);return n.getTracks().forEach(e=>{s.addTrack(e,n)}),s.ontrack=t=>{console.log("\uD83C\uDFB5 Received audio stream from ".concat(e));let n=t.streams[0],s=document.createElement("audio");s.srcObject=n,s.autoplay=!0,s.volume=.8,s.muted=!1,s.setAttribute("playsinline","true"),s.setAttribute("webkit-playsinline","true"),s.setAttribute("controls","false"),s.setAttribute("preload","none"),k.current[e]=s,document.body.appendChild(s),h(t=>({...t,[e]:{id:e,name:"User ".concat(e.slice(0,4)),isMuted:!1,isSpeaking:!1}}))},s.onicecandidate=t=>{t.candidate&&(null==v||v.emit("signal",{to:e,data:{type:"ice-candidate",candidate:t.candidate}}))},s.onconnectionstatechange=()=>{console.log("\uD83D\uDD17 Peer connection state with ".concat(e,":"),s.connectionState)},C.current[e]=s,s},T=async e=>{let{from:t,data:n}=e;if(!R.current)return;let s=C.current[t];if(s||(s=M(t,!1,R.current)),"offer"===n.type){await s.setRemoteDescription(new RTCSessionDescription(n));let e=await s.createAnswer();await s.setLocalDescription(e),null==v||v.emit("signal",{to:t,data:{type:"answer",answer:e}})}else"answer"===n.type?await s.setRemoteDescription(new RTCSessionDescription(n.answer)):"ice-candidate"===n.type&&await s.addIceCandidate(new RTCIceCandidate(n.candidate))};(0,o.useEffect)(()=>{if(!t)return;let e=(()=>{console.log("\uD83D\uDD0C Initializing socket connection...");let e=(0,d.ZP)(u.env.NEXT_PUBLIC_BACKEND_URL||"https://api.verbfy.com",{path:"/socket.io",transports:["websocket","polling"],upgrade:!0,rememberUpgrade:!0,timeout:2e4,forceNew:!0});return e.on("connect",()=>{console.log("✅ Socket connected successfully"),f(!1),y(null)}),e.on("connect_error",e=>{console.error("❌ Socket connection error:",e),y("Failed to connect to server. Please try again."),f(!1)}),e.on("disconnect",t=>{console.log("\uD83D\uDD0C Socket disconnected:",t),"io server disconnect"===t&&setTimeout(()=>{e.connect()},1e3)}),e.on("userJoined",t=>{if(console.log("\uD83D\uDC64 User joined: ".concat(t)),R.current){let n=M(t,!0,R.current);n.createOffer().then(s=>{n.setLocalDescription(s),e.emit("signal",{to:t,data:{type:"offer",offer:s}})})}}),e.on("userLeft",e=>{console.log("\uD83D\uDC64 User left: ".concat(e)),C.current[e]&&(C.current[e].close(),delete C.current[e]),k.current[e]&&(document.body.removeChild(k.current[e]),delete k.current[e]),h(t=>{let n={...t};return delete n[e],n})}),e.on("signal",T),e.on("roomFull",()=>{y("Room is full (max 5 users)")}),N(e),e})();return()=>{e&&e.disconnect(),Object.values(C.current).forEach(e=>e.close()),C.current={},Object.values(k.current).forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),k.current={},R.current&&(R.current.getTracks().forEach(e=>e.stop()),R.current=null)}},[t]);let S=async()=>{if(v&&t)try{await E()&&(v.emit("joinRoom",t),y(null))}catch(e){console.error("Failed to join room:",e),y("Failed to join room. Please try again.")}},P=()=>{v&&v.emit("leaveRoom",t),R.current&&(R.current.getTracks().forEach(e=>e.stop()),R.current=null),m(null),h({}),e.push("/verbfy-talk")};return t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i(),{children:[(0,s.jsxs)("title",{children:["VerbfyTalk Room - ",t]}),(0,s.jsx)("meta",{name:"description",content:"Join the conversation in VerbfyTalk"})]}),(0,s.jsx)(a.Z,{title:"VerbfyTalk Room: ".concat(t),children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:"\uD83C\uDFA4 VerbfyTalk Room"}),(0,s.jsxs)("p",{className:"text-gray-600 mt-1",children:["Room ID: ",t]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Maximum 5 participants • Audio only • P2P connection"})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:c?(0,s.jsx)("button",{onClick:P,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Leave Room"}):(0,s.jsx)("button",{onClick:S,disabled:b,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50",children:b?"Connecting...":"\uD83C\uDFA7 Join Room"})})]})}),j&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-red-600",children:"❌"}),(0,s.jsx)("p",{className:"text-red-800",children:j})]}),(0,s.jsx)("button",{onClick:()=>y(null),className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Dismiss"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Connection Status"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat((null==v?void 0:v.connected)?"bg-green-500":"bg-red-500")}),(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["WebSocket: ",(null==v?void 0:v.connected)?"Connected":"Disconnected"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(c?"bg-green-500":"bg-gray-400")}),(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Microphone: ",c?"Active":"Inactive"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(w?"bg-green-500":"bg-gray-400")}),(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Audio Context: ",w?"Ready":"Not Ready"]})]})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-8",children:[!c&&!b&&(0,s.jsx)("div",{className:"text-center mb-8",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("span",{className:"text-3xl",children:"\uD83C\uDFA4"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Join VerbfyTalk Room"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Click the button below to join the audio conversation. You'll need to allow microphone access."}),(0,s.jsx)("button",{onClick:S,className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-colors",children:"\uD83C\uDFA7 Join Room"})]})}),c&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-4xl w-full",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,s.jsxs)("h3",{className:"font-semibold text-gray-900 mb-2",children:[(null==n?void 0:n.name)||"You"," ",g?"\uD83C\uDFA4":"\uD83D\uDD07"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Local"}),!g&&(0,s.jsx)("div",{className:"mt-2 text-xs text-red-500 bg-red-50 px-2 py-1 rounded",children:"Microphone Off"})]}),Object.values(x).map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,s.jsxs)("h3",{className:"font-semibold text-gray-900 mb-2",children:[e.name," ",e.isMuted?"\uD83D\uDD07":"\uD83C\uDFA4"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Remote"}),e.isMuted&&(0,s.jsx)("div",{className:"mt-2 text-xs text-red-500 bg-red-50 px-2 py-1 rounded",children:"Muted"})]},e.id))]}),(0,s.jsx)("div",{className:"mt-8 text-center",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 max-w-2xl mx-auto",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Room Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Room ID:"})," ",t]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Participants:"})," ",Object.keys(x).length+(c?1:0),"/5"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Connection:"})," P2P WebRTC"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Audio Quality:"})," High"]})]})]})})]}),c&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Audio Controls"}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>{if(R.current){let e=R.current.getAudioTracks()[0];e&&(e.enabled=!e.enabled,p(e.enabled))}},className:"flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ".concat(g?"bg-green-100 text-green-700 hover:bg-green-200":"bg-red-100 text-red-700 hover:bg-red-200"),children:g?"\uD83C\uDFA4 Mute":"\uD83D\uDD07 Unmute"}),(0,s.jsx)("button",{onClick:P,className:"flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors bg-red-100 text-red-700 hover:bg-red-200",children:"\uD83D\uDEAA Leave Room"})]})]})]})})]}):(0,s.jsx)(a.Z,{title:"VerbfyTalk",children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Room Not Found"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"The room you're looking for doesn't exist."}),(0,s.jsx)("button",{onClick:()=>e.push("/verbfy-talk"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Back to Rooms"})]})})})}}},function(e){e.O(0,[1216,1088,2888,179],function(){return e(e.s=4333)}),_N_E=e.O()}]);
//# sourceMappingURL=[roomId]-0a32277b7b0e3994.js.map