(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8939],{4333:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verbfy-talk/[roomId]",function(){return t(74501)}])},74501:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var r=t(85893),i=t(67294),n=t(11163),a=t(11088),l=t(54310),o=t(32798),c=t(64964),d=t(32201),u=t(68606),m=t(96019),h=t(35892),x=t(71263),p=t(24585),g=t(61937);function b(){var e,s;let t=(0,n.useRouter)(),{roomId:b}=t.query,{t:v}=(0,l.Q)(),[f,j]=(0,i.useState)(null),[y,w]=(0,i.useState)(!0),[N,D]=(0,i.useState)(!1),[k,C]=(0,i.useState)(!1),[S,M]=(0,i.useState)(""),[A,E]=(0,i.useState)(!1),[R,P]=(0,i.useState)(!1),[T,Z]=(0,i.useState)(!1),[_,F]=(0,i.useState)(0),[U,q]=(0,i.useState)([]),[I,J]=(0,i.useState)(null),L=(0,i.useRef)(null),z=(0,i.useRef)(new Map),B=(0,i.useRef)(null),H=(0,i.useRef)(null);(0,i.useEffect)(()=>{b&&(async()=>{try{var e,s;let t=await o.bl.getRoomDetails(b);if(j(t.data||t),(null===(e=t.data)||void 0===e?void 0:e.participants)||(null==t?void 0:t.participants)){let e=((null===(s=t.data)||void 0===s?void 0:s.participants)||(null==t?void 0:t.participants)).some(e=>e.isActive);C(e)}}finally{w(!1)}})()},[b]);let V=async()=>{try{if(console.log("\uD83C\uDFA4 Requesting microphone permission..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Microphone access not supported in this browser");if(!window.isSecureContext)throw Error("Microphone access requires a secure context (HTTPS or localhost)");try{let e=await navigator.permissions.query({name:"microphone"});if(console.log("\uD83D\uDD0D Microphone permission status:",e.state),"denied"===e.state)throw Error("Microphone permission permanently denied. Please enable it in browser settings.")}catch(e){console.log("⚠️ Could not check permission status, proceeding with getUserMedia")}let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});console.log("✅ Microphone permission granted"),L.current=e,B.current=new AudioContext;let s=B.current.createMediaStreamSource(e);H.current=B.current.createAnalyser(),s.connect(H.current);let t=new Uint8Array(H.current.frequencyBinCount),r=()=>{if(H.current){H.current.getByteFrequencyData(t);let e=t.reduce((e,s)=>e+s)/t.length;F(e),Z(e>30)}requestAnimationFrame(r)};r(),console.log("\uD83C\uDFA4 Audio initialized successfully")}catch(t){console.error("❌ Failed to initialize audio:",t);let e="Failed to access microphone",s=!0;throw"NotAllowedError"===t.name?e="Microphone permission denied. Please allow microphone access and try again.":"NotFoundError"===t.name?e="No microphone found. Please connect a microphone and try again.":"NotSupportedError"===t.name?(e="Microphone access not supported in this browser.",s=!1):"NotReadableError"===t.name?e="Microphone is already in use by another application.":t.message.includes("secure context")?(e="Microphone access requires HTTPS. Please use https://verbfy.com instead of http.",s=!1):t.message.includes("permanently denied")&&(e="Microphone access permanently blocked. Please enable it in browser settings: Chrome Settings > Privacy > Site Settings > Microphone > Allow.",s=!1),J({message:e,showRetry:s}),t}},G=async()=>{if(b){if((null==f?void 0:f.isPrivate)&&!S){E(!0);return}try{if(D(!0),(await o.bl.joinRoom(b,{password:S})).success){C(!0),M(""),E(!1),await V();let e=await o.bl.getRoomDetails(b);j(e.data||e)}}catch(t){var e,s;console.error("Failed to join room:",t),alert((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to join room")}finally{D(!1)}}},O=async()=>{if(b)try{L.current&&L.current.getTracks().forEach(e=>e.stop()),z.current.forEach(e=>e.close()),z.current.clear(),await o.bl.leaveRoom(b),C(!1),t.push("/verbfy-talk")}catch(e){console.error("Failed to leave room:",e)}},X=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return y?(0,r.jsx)(a.Z,{title:"Loading Room...",children:(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading room details..."})}):f?(0,r.jsx)(a.Z,{title:f.name||"VerbfyTalk Room",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,r.jsx)(d.Z,{className:"w-8 h-8 text-blue-600"}),f.name]}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:f.description}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-4 text-sm text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[f.isPrivate?(0,r.jsx)(u.Z,{className:"w-4 h-4"}):(0,r.jsx)(m.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:f.isPrivate?"Private":"Public"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"Beginner":return(0,r.jsx)(c.Z,{className:"w-4 h-4 text-green-500"});case"Intermediate":return(0,r.jsx)(c.Z,{className:"w-4 h-4 text-yellow-500"});case"Advanced":return(0,r.jsx)(c.Z,{className:"w-4 h-4 text-red-500"});default:return(0,r.jsx)(c.Z,{className:"w-4 h-4 text-blue-500"})}})(f.level),(0,r.jsx)("span",{children:f.level})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[(null===(e=f.participants)||void 0===e?void 0:e.filter(e=>e.isActive).length)||0,"/",f.maxParticipants]})]}),f.startedAt&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:["Started ",X(f.startedAt)]})]})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:k?(0,r.jsx)("button",{onClick:O,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Leave Room"}):(0,r.jsx)("button",{onClick:G,disabled:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50",children:N?"Joining...":"Join Room"})})]}),f.topic&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Discussion Topic"}),(0,r.jsx)("p",{className:"text-blue-800",children:f.topic})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"w-5 h-5"}),"Participants (",(null===(s=f.participants)||void 0===s?void 0:s.filter(e=>e.isActive).length)||0,")"]}),k&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,r.jsxs)("h3",{className:"font-medium text-blue-900 mb-3 flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"w-5 h-5"}),"Voice Chat Controls"]}),L.current?(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>{if(L.current){let e=L.current.getAudioTracks()[0];e&&(e.enabled=!e.enabled,P(!e.enabled))}},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat(R?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:[(0,r.jsx)(g.Z,{className:"w-5 h-5 ".concat(R?"text-red-600":"text-green-600")}),R?"Unmute":"Mute"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-20 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full transition-all duration-100 ".concat(T?"bg-green-500":"bg-blue-500"),style:{width:"".concat(Math.min(2*_,100),"%")}})}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:T?"Speaking":"Silent"})]})]}):(0,r.jsxs)("div",{className:"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,r.jsx)("p",{className:"text-yellow-800 text-sm mb-2",children:"\uD83D\uDD12 Microphone access required for voice chat"}),I&&(0,r.jsxs)("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,r.jsxs)("p",{className:"text-red-800 text-sm mb-2",children:["❌ ",I.message]}),I.showRetry&&(0,r.jsx)("button",{onClick:()=>{J(null),V()},className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors",children:"\uD83D\uDD04 Try Again"})]}),(0,r.jsx)("button",{onClick:()=>{J(null),V()},className:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"\uD83C\uDFA4 Enable Microphone"}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-yellow-700",children:[(0,r.jsx)("p",{children:(0,r.jsx)("strong",{children:"\uD83D\uDCA1 Troubleshooting:"})}),(0,r.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[(0,r.jsx)("li",{children:"Make sure you're using HTTPS (https://verbfy.com)"}),(0,r.jsx)("li",{children:"Check browser microphone permissions in settings"}),(0,r.jsx)("li",{children:"Ensure no other apps are using the microphone"}),(0,r.jsx)("li",{children:"Try refreshing the page if permission was denied"})]})]})]}),(0,r.jsxs)("div",{className:"mt-3 text-xs text-blue-700",children:[(0,r.jsxs)("p",{children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Voice Chat Tips:"})]}),(0,r.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[(0,r.jsx)("li",{children:'Click "Enable Microphone" to start voice chat'}),(0,r.jsx)("li",{children:"Use Mute/Unmute to control your audio"}),(0,r.jsx)("li",{children:"Green indicator shows when you're speaking"}),(0,r.jsx)("li",{children:"Ensure your microphone is working and not blocked by other apps"})]})]})]}),f.participants&&f.participants.length>0?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.participants.filter(e=>e.isActive).filter((e,s,t)=>t.findIndex(s=>s.userId._id===e.userId._id)===s).map((e,s)=>{var t,i,n;return(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:(null===(i=e.userId)||void 0===i?void 0:null===(t=i.name)||void 0===t?void 0:t.charAt(0))||"U"}),e.isSpeaking&&(0,r.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:(null===(n=e.userId)||void 0===n?void 0:n.name)||"Unknown User"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Joined ",X(e.joinedAt)]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 ".concat(e.isMuted?"text-red-500":"text-green-500")}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:e.isMuted?"Muted":"Active"})]})]})]},"".concat(e.userId._id,"-").concat(s))})}):(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No participants yet"})]}),A&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enter Room Password"}),(0,r.jsx)("input",{type:"password",value:S,onChange:e=>M(e.target.value),placeholder:"Enter password",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{E(!1),M("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{onClick:G,disabled:N,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:N?"Joining...":"Join"})]})]})})]})}):(0,r.jsx)(a.Z,{title:"Room Not Found",children:(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Room not found"})})}}},function(e){e.O(0,[1216,1088,2888,179],function(){return e(e.s=4333)}),_N_E=e.O()}]);
//# sourceMappingURL=[roomId]-5ff4cadfca5b17ef.js.map