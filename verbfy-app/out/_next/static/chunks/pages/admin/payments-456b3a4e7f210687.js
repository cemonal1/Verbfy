(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3613],{14831:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/payments",function(){return t(64845)}])},64845:function(e,s,t){"use strict";t.r(s);var a=t(85893),l=t(67294),d=t(11163),n=t(36197),i=t(57115),r=t(10571);let c=e=>{let{isOpen:s,onClose:t,onConfirm:d,paymentId:n}=e,[i,r]=(0,l.useState)("");return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\xd6demeyi Reddet"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&(d(i),r(""),t())},children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reddetme Sebebi"}),(0,a.jsx)("textarea",{value:i,onChange:e=>r(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"\xd6demenin neden reddedildiğini a\xe7ıklayın...",required:!0})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"İptal"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reddet"})]})]})]})}):null};s.default=()=>{var e,s,t,m,x;let o=(0,d.useRouter)(),{user:u}=(0,n.aC)(),{state:p,loadPayments:h,approvePayment:g,rejectPayment:y,refundPayment:f,setPaymentFilters:b}=(0,i.A)(),[j,v]=(0,l.useState)(""),[N,w]=(0,l.useState)("all"),[D,k]=(0,l.useState)(!1),[_,C]=(0,l.useState)(null),[S,T]=(0,l.useState)(new Set);(0,l.useEffect)(()=>{if((null==u?void 0:u.role)!=="admin"){o.push("/dashboard");return}h()},[null==u?void 0:u.role]),(0,l.useEffect)(()=>{let e={};j&&(e.search=j),"all"!==N&&(e.status=N),b(e)},[j,N]);let B=async e=>{T(s=>new Set(s).add(e));try{await g(e)}finally{T(s=>{let t=new Set(s);return t.delete(e),t})}},E=e=>{C(e),k(!0)},P=async e=>{if(_){T(e=>new Set(e).add(_));try{await y(_,e)}finally{T(e=>{let s=new Set(e);return s.delete(_),s}),C(null)}}},R=async e=>{if(confirm("Bu \xf6demeyi iade etmek istediğinizden emin misiniz?")){T(s=>new Set(s).add(e));try{await f(e,{reason:"Admin tarafından iade edildi"})}finally{T(s=>{let t=new Set(s);return t.delete(e),t})}}},z=e=>{let s={pending:{color:"bg-yellow-100 text-yellow-800",text:"Beklemede"},completed:{color:"bg-green-100 text-green-800",text:"Tamamlandı"},failed:{color:"bg-red-100 text-red-800",text:"Başarısız"},refunded:{color:"bg-gray-100 text-gray-800",text:"İade Edildi"},approved:{color:"bg-blue-100 text-blue-800",text:"Onaylandı"},rejected:{color:"bg-red-100 text-red-800",text:"Reddedildi"}},t=s[e]||s.pending;return(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(t.color),children:t.text})},I=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(e),O=e=>new Date(e).toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return p.paymentsLoading?(0,a.jsx)(r.Z,{children:(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-2xl animate-spin text-blue-600",children:"\uD83D\uDD04"})})}):(0,a.jsxs)(r.Z,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"\xd6deme Y\xf6netimi"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Sistem \xf6demelerini y\xf6netin ve kontrol edin"})]}),(0,a.jsxs)("button",{onClick:()=>h(),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,a.jsx)("span",{children:"\uD83D\uDD04"}),(0,a.jsx)("span",{children:"Yenile"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)("span",{className:"text-blue-600 text-xl",children:"\uD83D\uDCB0"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Toplam \xd6deme"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null===(e=p.payments)||void 0===e?void 0:e.length)||0})]})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,a.jsx)("span",{className:"text-yellow-600 text-xl",children:"⚠️"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Bekleyen"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null===(s=p.payments)||void 0===s?void 0:s.filter(e=>"pending"===e.status).length)||0})]})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)("span",{className:"text-green-600 text-xl",children:"✅"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Tamamlanan"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null===(t=p.payments)||void 0===t?void 0:t.filter(e=>"completed"===e.status).length)||0})]})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,a.jsx)("span",{className:"text-red-600 text-xl",children:"❌"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"İptal Edildi"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null===(m=p.payments)||void 0===m?void 0:m.filter(e=>"cancelled"===e.status).length)||0})]})]})})]}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsx)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\uD83D\uDD0D"}),(0,a.jsx)("input",{type:"text",placeholder:"\xd6deme ara...",value:j,onChange:e=>v(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"⚙️"}),(0,a.jsxs)("select",{value:N,onChange:e=>w(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"all",children:"T\xfcm Durumlar"}),(0,a.jsx)("option",{value:"pending",children:"Beklemede"}),(0,a.jsx)("option",{value:"completed",children:"Tamamlandı"}),(0,a.jsx)("option",{value:"failed",children:"Başarısız"}),(0,a.jsx)("option",{value:"refunded",children:"İade Edildi"}),(0,a.jsx)("option",{value:"approved",children:"Onaylandı"}),(0,a.jsx)("option",{value:"rejected",children:"Reddedildi"})]})]})]})})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\xd6deme Bilgileri"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kullanıcı"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tutar"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durum"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tarih"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:null===(x=p.payments)||void 0===x?void 0:x.map(e=>{var s,t,l,d,n,i,r,c,m;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)("span",{className:"text-blue-600",children:"\uD83D\uDCB3"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.paymentId||e._id}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.method||"Kredi Kartı"})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,a.jsx)("span",{className:"text-gray-600",children:"\uD83D\uDC64"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(s=e.user)||void 0===s?void 0:s.name)||(null===(t=e.userId)||void 0===t?void 0:t.name)||(null===(l=e.student)||void 0===l?void 0:l.name)||(null===(d=e.user)||void 0===d?void 0:d.email)||(null===(n=e.userId)||void 0===n?void 0:n.email)||(null===(i=e.student)||void 0===i?void 0:i.email)||"Bilinmeyen"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:(null===(r=e.user)||void 0===r?void 0:r.email)||(null===(c=e.userId)||void 0===c?void 0:c.email)||(null===(m=e.student)||void 0===m?void 0:m.email)})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:I(e.amount||e.price||0)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:z(e.status)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCC5"}),O(e.createdAt)]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:["pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>B(e._id),disabled:S.has(e._id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:S.has(e._id)?(0,a.jsx)("span",{className:"animate-spin",children:"\uD83D\uDD04"}):(0,a.jsx)("span",{children:"✅"})}),(0,a.jsx)("button",{onClick:()=>E(e._id),disabled:S.has(e._id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:(0,a.jsx)("span",{children:"❌"})})]}),"completed"===e.status&&(0,a.jsx)("button",{onClick:()=>R(e._id),disabled:S.has(e._id),className:"inline-flex items-center px-3 py-1 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"İade Et"}),(0,a.jsx)("button",{className:"inline-flex items-center px-3 py-1 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:(0,a.jsx)("span",{children:"\uD83D\uDC41️"})})]})})]},e._id)})})]})}),(!p.payments||0===p.payments.length)&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"mx-auto text-4xl text-gray-400",children:"\uD83D\uDCB3"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"\xd6deme bulunamadı"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Hen\xfcz hi\xe7 \xf6deme kaydı bulunmuyor."})]})]}),p.paymentsPagination&&p.paymentsPagination.pages>1&&(0,a.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,a.jsx)("button",{disabled:1===p.paymentsPagination.page,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"\xd6nceki"}),(0,a.jsx)("button",{disabled:p.paymentsPagination.page===p.paymentsPagination.pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Sonraki"})]}),(0,a.jsx)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("span",{className:"font-medium",children:p.paymentsPagination.page})," / ",(0,a.jsx)("span",{className:"font-medium",children:p.paymentsPagination.pages})," sayfa, toplam ",(0,a.jsx)("span",{className:"font-medium",children:p.paymentsPagination.total})," \xf6deme"]})})})]})]}),(0,a.jsx)(c,{isOpen:D,onClose:()=>k(!1),onConfirm:P,paymentId:_||""})]})}}},function(e){e.O(0,[2138,9226,9496,8484,437,5823,2244,6235,5323,747,3365,8638,9806,7093,8510,8424,8639,7855,7446,2169,8308,1408,6259,4657,8212,571,5522,1493,2888,5514,179],function(){return e(e.s=14831)}),_N_E=e.O()}]);