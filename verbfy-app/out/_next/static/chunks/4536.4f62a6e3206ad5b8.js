"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4536],{64536:function(e,a,t){t.r(a),t.d(a,{default:function(){return d}});var s=t(85893),r=t(67294),n=t(95109),l=t(36197),i=t(44451);function d(e){let{conversationId:a,otherParticipant:t}=e,{state:i,actions:d}=(0,n.R)(),{user:o}=(0,l.aC)(),[u,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1),h=(0,r.useRef)(null),f=(0,r.useRef)(null),{messages:y,loading:b,error:v,typingUsers:j}=i;(0,r.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[y]),(0,r.useEffect)(()=>(d.joinConversation(a),d.loadMessages(a),d.markAsRead(a),()=>{d.leaveConversation(a)}),[a]),(0,r.useEffect)(()=>{x?d.setTyping(a,!0):d.setTyping(a,!1)},[x,a]);let p=async e=>{var t;if(e.preventDefault(),!u.trim())return;let s={conversationId:a,content:u.trim(),messageType:"text"};await d.sendMessage(s),m(""),g(!1),null===(t=f.current)||void 0===t||t.focus()};return b?(0,s.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading messages..."})]}):v?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-red-500 mb-2",children:"⚠️"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:v})]}):(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-blue-50 dark:bg-blue-900",children:(0,s.jsx)("img",{src:t.avatar||"/images/default-avatar.png",alt:t.name,className:"w-10 h-10 object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:t.role})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===y.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCAC"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Start a conversation"}),(0,s.jsxs)("p",{className:"text-gray-500 dark:text-gray-400",children:["Send a message to begin chatting with ",t.name,"."]})]}):y.map(e=>(0,s.jsx)(c,{message:e,isOwnMessage:e.sender._id===(null==o?void 0:o._id)},e._id)),j.has(t._id)&&(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,s.jsxs)("span",{className:"text-sm",children:[t.name," is typing..."]})]}),(0,s.jsx)("div",{ref:h})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("form",{onSubmit:p,className:"flex space-x-3",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("textarea",{ref:f,value:u,onChange:e=>{m(e.target.value),!x&&e.target.value.length>0?g(!0):x&&0===e.target.value.length&&g(!1)},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p(e))},placeholder:"Type your message...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none",rows:1,maxLength:1e3})}),(0,s.jsx)("button",{type:"submit",disabled:!u.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right",children:[u.length,"/1000"]})]})]})}function c(e){let{message:a,isOwnMessage:t}=e;return(0,s.jsxs)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:[(0,s.jsx)("div",{className:"max-w-xs lg:max-w-md ".concat(t?"order-2":"order-1"),children:(0,s.jsxs)("div",{className:"\n            px-4 py-2 rounded-lg shadow-sm\n            ".concat(t?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white","\n          "),children:[(0,s.jsx)("p",{className:"text-sm",children:a.content}),(0,s.jsxs)("div",{className:"text-xs mt-1 ".concat(t?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:[(0,i.B_)(a.createdAt),t&&(0,s.jsx)("span",{className:"ml-2",children:a.isRead?"✓✓":"✓"})]})]})}),(0,s.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden ".concat(t?"order-1 ml-2":"order-2 mr-2"),children:(0,s.jsx)("img",{src:a.sender.avatar||"/images/default-avatar.png",alt:a.sender.name,className:"w-8 h-8 object-cover"})})]})}},44451:function(e,a,t){t.d(a,{B_:function(){return s},IC:function(){return n},z1:function(){return r}});let s=e=>{let a=new Date(e),t=(new Date().getTime()-a.getTime())/36e5;return t<24?a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):t<48?"Yesterday":a.toLocaleDateString("en-US",{month:"short",day:"numeric"})},r=e=>{let a=new Date(e),t=(new Date().getTime()-a.getTime())/36e5;if(t<1){let e=Math.floor(60*t);return 0===e?"Just now":"".concat(e,"m ago")}return t<24?"".concat(Math.floor(t),"h ago"):t<48?"Yesterday":a.toLocaleDateString("en-US",{month:"short",day:"numeric"})},n=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.length<=a?e:e.substring(0,a)+"..."}}}]);